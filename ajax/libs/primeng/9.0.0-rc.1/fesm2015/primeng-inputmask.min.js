import{forwardRef,EventEmitter,ElementRef,Input,ViewChild,Output,Component,NgModule}from"@angular/core";import{CommonModule}from"@angular/common";import{DomHandler}from"primeng/dom";import{InputTextModule}from"primeng/inputtext";import{NG_VALUE_ACCESSOR}from"@angular/forms";var __decorate=this&&this.__decorate||function(t,e,i,s){var n,a=arguments.length,o=a<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var h=t.length-1;h>=0;h--)(n=t[h])&&(o=(a<3?n(o):a>3?n(e,i,o):n(e,i))||o);return a>3&&o&&Object.defineProperty(e,i,o),o};const INPUTMASK_VALUE_ACCESSOR={provide:NG_VALUE_ACCESSOR,useExisting:forwardRef(()=>InputMask),multi:!0};let InputMask=class{constructor(t){this.el=t,this.type="text",this.slotChar="_",this.autoClear=!0,this.characterPattern="[A-Za-z]",this.onComplete=new EventEmitter,this.onFocus=new EventEmitter,this.onBlur=new EventEmitter,this.onInput=new EventEmitter,this.onModelChange=(()=>{}),this.onModelTouched=(()=>{})}ngOnInit(){let t=DomHandler.getUserAgent();this.androidChrome=/chrome/i.test(t)&&/android/i.test(t),this.initMask()}get mask(){return this._mask}set mask(t){this._mask=t,this.initMask(),this.writeValue(""),this.onModelChange(this.value)}initMask(){this.tests=[],this.partialPosition=this.mask.length,this.len=this.mask.length,this.firstNonMaskPos=null,this.defs={9:"[0-9]",a:this.characterPattern,"*":`${this.characterPattern}|[0-9]`};let t=this.mask.split("");for(let e=0;e<t.length;e++){let i=t[e];"?"==i?(this.len--,this.partialPosition=e):this.defs[i]?(this.tests.push(new RegExp(this.defs[i])),null===this.firstNonMaskPos&&(this.firstNonMaskPos=this.tests.length-1),e<this.partialPosition&&(this.lastRequiredNonMaskPos=this.tests.length-1)):this.tests.push(null)}this.buffer=[];for(let e=0;e<t.length;e++){let i=t[e];"?"!=i&&(this.defs[i]?this.buffer.push(this.getPlaceholder(e)):this.buffer.push(i))}this.defaultBuffer=this.buffer.join("")}writeValue(t){this.value=t,this.inputViewChild&&this.inputViewChild.nativeElement&&(null==this.value||null==this.value?this.inputViewChild.nativeElement.value="":this.inputViewChild.nativeElement.value=this.value,this.checkVal(),this.focusText=this.inputViewChild.nativeElement.value,this.updateFilledState())}registerOnChange(t){this.onModelChange=t}registerOnTouched(t){this.onModelTouched=t}setDisabledState(t){this.disabled=t}caret(t,e){let i,s,n;if(this.inputViewChild.nativeElement.offsetParent&&this.inputViewChild.nativeElement===document.activeElement)return"number"!=typeof t?(this.inputViewChild.nativeElement.setSelectionRange?(s=this.inputViewChild.nativeElement.selectionStart,n=this.inputViewChild.nativeElement.selectionEnd):document.selection&&document.selection.createRange&&(n=(s=0-(i=document.selection.createRange()).duplicate().moveStart("character",-1e5))+i.text.length),{begin:s,end:n}):(s=t,n="number"==typeof e?e:s,void(this.inputViewChild.nativeElement.setSelectionRange?this.inputViewChild.nativeElement.setSelectionRange(s,n):this.inputViewChild.nativeElement.createTextRange&&((i=this.inputViewChild.nativeElement.createTextRange()).collapse(!0),i.moveEnd("character",n),i.moveStart("character",s),i.select())))}isCompleted(){for(let t=this.firstNonMaskPos;t<=this.lastRequiredNonMaskPos;t++)if(this.tests[t]&&this.buffer[t]===this.getPlaceholder(t))return!1;return!0}getPlaceholder(t){return t<this.slotChar.length?this.slotChar.charAt(t):this.slotChar.charAt(0)}seekNext(t){for(;++t<this.len&&!this.tests[t];);return t}seekPrev(t){for(;--t>=0&&!this.tests[t];);return t}shiftL(t,e){let i,s;if(!(t<0)){for(i=t,s=this.seekNext(e);i<this.len;i++)if(this.tests[i]){if(!(s<this.len&&this.tests[i].test(this.buffer[s])))break;this.buffer[i]=this.buffer[s],this.buffer[s]=this.getPlaceholder(s),s=this.seekNext(s)}this.writeBuffer(),this.caret(Math.max(this.firstNonMaskPos,t))}}shiftR(t){let e,i,s,n;for(e=t,i=this.getPlaceholder(t);e<this.len;e++)if(this.tests[e]){if(s=this.seekNext(e),n=this.buffer[e],this.buffer[e]=i,!(s<this.len&&this.tests[s].test(n)))break;i=n}}handleAndroidInput(t){var e=this.inputViewChild.nativeElement.value,i=this.caret();if(this.oldVal&&this.oldVal.length&&this.oldVal.length>e.length){for(this.checkVal(!0);i.begin>0&&!this.tests[i.begin-1];)i.begin--;if(0===i.begin)for(;i.begin<this.firstNonMaskPos&&!this.tests[i.begin];)i.begin++;setTimeout(()=>{this.caret(i.begin,i.begin),this.updateModel(t),this.isCompleted()&&this.onComplete.emit()},0)}else{for(this.checkVal(!0);i.begin<this.len&&!this.tests[i.begin];)i.begin++;setTimeout(()=>{this.caret(i.begin,i.begin),this.updateModel(t),this.isCompleted()&&this.onComplete.emit()},0)}}onInputBlur(t){if(this.focused=!1,this.onModelTouched(),this.checkVal(),this.updateFilledState(),this.onBlur.emit(t),this.inputViewChild.nativeElement.value!=this.focusText||this.inputViewChild.nativeElement.value!=this.value){this.updateModel(t);let e=document.createEvent("HTMLEvents");e.initEvent("change",!0,!1),this.inputViewChild.nativeElement.dispatchEvent(e)}}onKeyDown(t){if(this.readonly)return;let e,i,s,n=t.which||t.keyCode,a=/iphone/i.test(DomHandler.getUserAgent());this.oldVal=this.inputViewChild.nativeElement.value,8===n||46===n||a&&127===n?(i=(e=this.caret()).begin,(s=e.end)-i==0&&(i=46!==n?this.seekPrev(i):s=this.seekNext(i-1),s=46===n?this.seekNext(s):s),this.clearBuffer(i,s),this.shiftL(i,s-1),this.updateModel(t),t.preventDefault()):13===n?(this.onInputBlur(t),this.updateModel(t)):27===n&&(this.inputViewChild.nativeElement.value=this.focusText,this.caret(0,this.checkVal()),this.updateModel(t),t.preventDefault())}onKeyPress(t){if(!this.readonly){var e,i,s,n,a=t.which||t.keyCode,o=this.caret();if(!(t.ctrlKey||t.altKey||t.metaKey||a<32||a>34&&a<41)){if(a&&13!==a){if(o.end-o.begin!=0&&(this.clearBuffer(o.begin,o.end),this.shiftL(o.begin,o.end-1)),(e=this.seekNext(o.begin-1))<this.len&&(i=String.fromCharCode(a),this.tests[e].test(i))){if(this.shiftR(e),this.buffer[e]=i,this.writeBuffer(),s=this.seekNext(e),/android/i.test(DomHandler.getUserAgent())){setTimeout(()=>{this.caret(s)},0)}else this.caret(s);o.begin<=this.lastRequiredNonMaskPos&&(n=this.isCompleted())}t.preventDefault()}this.updateModel(t),this.updateFilledState(),n&&this.onComplete.emit()}}}clearBuffer(t,e){let i;for(i=t;i<e&&i<this.len;i++)this.tests[i]&&(this.buffer[i]=this.getPlaceholder(i))}writeBuffer(){this.inputViewChild.nativeElement.value=this.buffer.join("")}checkVal(t){let e,i,s,n=this.inputViewChild.nativeElement.value,a=-1;for(e=0,s=0;e<this.len;e++)if(this.tests[e]){for(this.buffer[e]=this.getPlaceholder(e);s++<n.length;)if(i=n.charAt(s-1),this.tests[e].test(i)){this.buffer[e]=i,a=e;break}if(s>n.length){this.clearBuffer(e+1,this.len);break}}else this.buffer[e]===n.charAt(s)&&s++,e<this.partialPosition&&(a=e);return t?this.writeBuffer():a+1<this.partialPosition?this.autoClear||this.buffer.join("")===this.defaultBuffer?(this.inputViewChild.nativeElement.value&&(this.inputViewChild.nativeElement.value=""),this.clearBuffer(0,this.len)):this.writeBuffer():(this.writeBuffer(),this.inputViewChild.nativeElement.value=this.inputViewChild.nativeElement.value.substring(0,a+1)),this.partialPosition?e:this.firstNonMaskPos}onInputFocus(t){if(this.readonly)return;let e;this.focused=!0,clearTimeout(this.caretTimeoutId),this.focusText=this.inputViewChild.nativeElement.value,e=this.checkVal(),this.caretTimeoutId=setTimeout(()=>{this.inputViewChild.nativeElement===document.activeElement&&(this.writeBuffer(),e==this.mask.replace("?","").length?this.caret(0,e):this.caret(e))},10),this.onFocus.emit(t)}onInputChange(t){this.androidChrome?this.handleAndroidInput(t):this.handleInputChange(t),this.onInput.emit(t)}handleInputChange(t){this.readonly||setTimeout(()=>{var e=this.checkVal(!0);this.caret(e),this.updateModel(t),this.isCompleted()&&this.onComplete.emit()},0)}getUnmaskedValue(){let t=[];for(let e=0;e<this.buffer.length;e++){let i=this.buffer[e];this.tests[e]&&i!=this.getPlaceholder(e)&&t.push(i)}return t.join("")}updateModel(t){const e=this.unmask?this.getUnmaskedValue():t.target.value;null===e&&void 0===e||(this.value=e,this.onModelChange(this.value))}updateFilledState(){this.filled=this.inputViewChild.nativeElement&&""!=this.inputViewChild.nativeElement.value}focus(){this.inputViewChild.nativeElement.focus()}ngOnDestroy(){}};InputMask.ctorParameters=(()=>[{type:ElementRef}]),__decorate([Input()],InputMask.prototype,"type",void 0),__decorate([Input()],InputMask.prototype,"slotChar",void 0),__decorate([Input()],InputMask.prototype,"autoClear",void 0),__decorate([Input()],InputMask.prototype,"style",void 0),__decorate([Input()],InputMask.prototype,"inputId",void 0),__decorate([Input()],InputMask.prototype,"styleClass",void 0),__decorate([Input()],InputMask.prototype,"placeholder",void 0),__decorate([Input()],InputMask.prototype,"size",void 0),__decorate([Input()],InputMask.prototype,"maxlength",void 0),__decorate([Input()],InputMask.prototype,"tabindex",void 0),__decorate([Input()],InputMask.prototype,"title",void 0),__decorate([Input()],InputMask.prototype,"ariaLabel",void 0),__decorate([Input()],InputMask.prototype,"ariaRequired",void 0),__decorate([Input()],InputMask.prototype,"disabled",void 0),__decorate([Input()],InputMask.prototype,"readonly",void 0),__decorate([Input()],InputMask.prototype,"unmask",void 0),__decorate([Input()],InputMask.prototype,"name",void 0),__decorate([Input()],InputMask.prototype,"required",void 0),__decorate([Input()],InputMask.prototype,"characterPattern",void 0),__decorate([Input()],InputMask.prototype,"autoFocus",void 0),__decorate([Input()],InputMask.prototype,"autocomplete",void 0),__decorate([ViewChild("input",{static:!0})],InputMask.prototype,"inputViewChild",void 0),__decorate([Output()],InputMask.prototype,"onComplete",void 0),__decorate([Output()],InputMask.prototype,"onFocus",void 0),__decorate([Output()],InputMask.prototype,"onBlur",void 0),__decorate([Output()],InputMask.prototype,"onInput",void 0),__decorate([Input()],InputMask.prototype,"mask",null);let InputMaskModule=class{};InputMaskModule=__decorate([NgModule({imports:[CommonModule,InputTextModule],exports:[InputMask=__decorate([Component({selector:"p-inputMask",template:'<input #input pInputText [attr.id]="inputId" [attr.type]="type" [attr.name]="name" [ngStyle]="style" [ngClass]="styleClass" [attr.placeholder]="placeholder" [attr.title]="title"\n        [attr.size]="size" [attr.autocomplete]="autocomplete" [attr.maxlength]="maxlength" [attr.tabindex]="tabindex" [attr.aria-label]="ariaLabel" [attr.aria-required]="ariaRequired" [disabled]="disabled" [readonly]="readonly" [attr.required]="required"\n        (focus)="onInputFocus($event)" (blur)="onInputBlur($event)" (keydown)="onKeyDown($event)" (keypress)="onKeyPress($event)" [attr.autofocus]="autoFocus"\n        (input)="onInputChange($event)" (paste)="handleInputChange($event)">',host:{"[class.ui-inputwrapper-filled]":"filled","[class.ui-inputwrapper-focus]":"focus"},providers:[INPUTMASK_VALUE_ACCESSOR]})],InputMask)],declarations:[InputMask]})],InputMaskModule);export{INPUTMASK_VALUE_ACCESSOR,InputMask,InputMaskModule};