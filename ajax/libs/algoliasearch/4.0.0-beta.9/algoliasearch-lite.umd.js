/*! algoliasearch-lite.umd.js | 4.0.0-beta.9 | Â© Algolia, inc. | https://github.com/algolia/algoliasearch-client-javascript */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).algoliasearch=t()}(this,(function(){"use strict";var e={Debug:1,Info:2,Error:3};function t(e){var t=e.storage||window.localStorage,r=e.logger||{debug:function(e,t){return Promise.resolve()},info:function(e,t){return Promise.resolve()},error:function(e,t){return Promise.resolve()}},n="algoliasearch-client-js-".concat(e.version),o="LocalStorage is not available or json could not be decoded.",a=function(){return JSON.parse(t.getItem(n)||"{}")};return{get:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{miss:function(){return Promise.resolve()}};try{var u=JSON.stringify(e),s=a()[u];if(void 0!==s)return Promise.resolve(s)}catch(e){r.debug(o)}var i=t();return i.then((function(e){return n.miss(e)})).then((function(){return i}))},set:function(e,u){try{var s=a();s[JSON.stringify(e)]=u,t.setItem(n,JSON.stringify(s))}catch(e){r.debug(o)}return Promise.resolve(u)},delete:function(e){try{var u=a();delete u[JSON.stringify(e)],t.setItem(n,JSON.stringify(u))}catch(e){r.debug(o)}return Promise.resolve()},clear:function(){try{t.removeItem(n)}catch(e){r.debug(o)}return Promise.resolve()}}}function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{serializable:!0},t={};return{get:function(r,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{miss:function(){return Promise.resolve()}},a=JSON.stringify(r);if(a in t)return Promise.resolve(e.serializable?JSON.parse(t[a]):t[a]);var u=n(),s=o&&o.miss||function(){return Promise.resolve()};return u.then((function(e){return s(e)})).then((function(){return u}))},set:function(r,n){return t[JSON.stringify(r)]=e.serializable?JSON.stringify(n):n,Promise.resolve(n)},delete:function(e){return delete t[JSON.stringify(e)],Promise.resolve()},clear:function(){return t={},Promise.resolve()}}}function n(e,t){return Object.keys(void 0!==t?t:{}).forEach((function(r){e[r]=t[r](e)})),e}function o(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var o=0;return e.replace(/%s/g,(function(){return encodeURIComponent(r[o++])}))}var a="4.0.0-beta.9",u={WithinQueryParameters:0,WithinHeaders:1};function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var f=3e5;var d=function(e,t,r){return function(e){var t=e.status;return e.isTimedOut||function(e){var t=e.isTimedOut,r=e.status;return!t&&0==~~r}(e)||2!=~~(t/100)&&4!=~~(t/100)}(t)?(t.isTimedOut||e.setAsDown(),r.onRetry(t)):2==~~(t.status/100)?r.onSucess(t):r.onFail(t)};function m(e,t,r,n){var o=[],a=0,u=function(e,t){var r=Array.isArray(e.data)?e.data:c({},e.data,{},t.data);if(r.constructor===Object&&0===Object.entries(r).length)return"";return JSON.stringify(r)}(r,n),s=c({},e.headers,{},n.headers),i=r.method,l=function t(l){var f=l.pop();if(void 0===f)throw function(e){return{name:"RetryError",message:"Unreachable hosts - your application id may be incorrect. If the error persists, contact support@algolia.com.",stackTrace:e}}(o);var m=a+1,h={data:u,headers:s,method:i,url:v(f,r.path,c({},e.queryParameters,{},n.queryParameters,{"x-algolia-agent":e.userAgent.value})),connectTimeout:m*e.timeouts.connect,socketTimeout:m*(n.timeout||0)},p={onSucess:function(e){return function(e){try{return JSON.parse(e.content)}catch(t){throw function(e,t){return{name:"DeserializationError",message:e,response:t}}(t.message,e)}}(e)},onRetry:function(r){var n={request:h,response:r,host:f,triesLeft:l.length,timeoutRetries:a};return o.push(n),r.isTimedOut&&a++,Promise.all([e.logger.debug("Retryable failure",n),e.hostsCache.set({url:f.url},f)]).then((function(){return t(l)}))},onFail:function(e){throw function(e){var t=e.content,r=e.status,n=t;try{n=JSON.parse(t).message}catch(e){}return function(e,t){return{name:"ApiError",message:e,status:t}}(n,r)}(e)}};return e.requester.send(h).then((function(e){return d(f,e,p)}))};return function(e,t){return Promise.all(t.map((function(t){return e.get({url:t.url},(function(){return Promise.resolve(t)})).then((function(e){return Object.assign(t,{downDate:e.downDate,up:e.up})}))}))).then((function(e){return e.filter((function(e){return e.isUp()})).reverse()}))}(e.hostsCache,t).then((function(e){return l(e)}))}function h(e){var t={hostsCache:e.hostsCache,logger:e.logger,requester:e.requester,requestsCache:e.requestsCache,responsesCache:e.responsesCache,timeouts:e.timeouts,userAgent:e.userAgent,headers:{},queryParameters:{},hosts:[],addHeaders:function(e){Object.assign(t.headers,e)},addQueryParameters:function(e){Object.assign(t.queryParameters,e)},setHosts:function(e){t.hosts=e.map((function(e){return function(e){var t={protocol:e.protocol||"https",url:e.url,accept:e.accept,downDate:0,up:!0,setAsDown:function(){t.downDate=Date.now(),t.up=!1},isUp:function(){return!t.up&&Date.now()-t.downDate>f&&(t.up=!0),t.up}};return t}(e)}))},read:function(e,r){var n=g(r,t.timeouts.read),o={request:e,mappedRequestOptions:n},a=function(){return m(t,t.hosts.filter((function(e){return 0!=(e.accept&b.Read)})),e,n)};return!0!==(void 0!==n.cacheable?n.cacheable:e.cacheable)?a():t.responsesCache.get(o,(function(){return t.requestsCache.get(o,(function(){return t.requestsCache.set(o,a()).then((function(e){return Promise.all([t.requestsCache.delete(o),e])}),(function(e){return Promise.all([t.requestsCache.delete(o),Promise.reject(e)])})).then((function(e){return e[1]}))}))}),{miss:function(e){return t.responsesCache.set(o,e)}})},write:function(e,r){return m(t,t.hosts.filter((function(e){return 0!=(e.accept&b.Write)})),e,g(r,t.timeouts.write))}};return t}function p(e){var t={value:"Algolia for JavaScript (".concat(e,")"),add:function(e){var r="; ".concat(e.segment).concat(void 0!==e.version?" (".concat(e.version,")"):"");return-1===t.value.indexOf(r)&&(t.value="".concat(t.value).concat(r)),t}};return t}function g(e,t){var r=e||{},n={};return Object.keys(r).forEach((function(e){-1===["timeout","headers","queryParameters","data","cacheable"].indexOf(e)&&(n[e]=r[e])})),{data:n,timeout:r.timeout||t,headers:r.headers||{},queryParameters:r.queryParameters||{},cacheable:r.cacheable}}function v(e,t,r){var n=y(r),o="".concat(e.protocol,"://").concat(e.url,"/").concat("/"===t.charAt(0)?t.substr(1):t);return n.length&&(o+="?".concat(n)),o}function y(e){return Object.keys(e).map((function(t){return o("%s=%s",t,(r=e[t],"[object Object]"===Object.prototype.toString.call(r)||"[object Array]"===Object.prototype.toString.call(r)?JSON.stringify(e[t]):e[t]));var r})).join("&")}var b={Read:1,Write:2,Any:3},O=function(e){var t=e.appId,r=h(e);r.setHosts([{url:"".concat(t,"-dsn.algolia.net"),accept:b.Read},{url:"".concat(t,".algolia.net"),accept:b.Write}].concat(function(e){for(var t=e.length-1;t>0;t--){var r=Math.floor(Math.random()*(t+1)),n=e[t];e[t]=e[r],e[r]=n}return e}([{url:"".concat(t,"-1.algolianet.com"),accept:b.Any},{url:"".concat(t,"-2.algolianet.com"),accept:b.Any},{url:"".concat(t,"-3.algolianet.com"),accept:b.Any}])));var o=function(e,t,r){var n={"x-algolia-api-key":r,"x-algolia-application-id":t};return{headers:function(){return e===u.WithinHeaders?n:{}},queryParameters:function(){return e===u.WithinQueryParameters?n:{}}}}(void 0!==e.authMode?e.authMode:u.WithinHeaders,t,e.apiKey);return r.addHeaders(c({},o.headers(),{},{"content-type":"application/x-www-form-urlencoded"})),r.addQueryParameters(o.queryParameters()),n({transporter:r,appId:t,addAlgoliaAgent:function(e,t){r.userAgent.add({segment:e,version:t})}},e.methods)},P="POST",j=function(e){return function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o={transporter:e.transporter,appId:e.appId,indexName:t};return n(o,r.methods)}},w=function(e){return function(t,r){var n=t.map((function(e){return c({},e,{params:y(e.params||{})})}));return e.transporter.read({method:P,path:"1/indexes/*/queries",data:{requests:n},cacheable:!0},r)}},q=function(e){return function(t,r){return Promise.all(t.map((function(t){var n=t.params,o=n.facetName,a=n.facetQuery,u=l(n,["facetName","facetQuery"]);return j(e)(t.indexName,{methods:{searchForFacetValues:N}}).searchForFacetValues(o,a,c({},r,{},u))})))}},S=function(e){return function(t,r){return e.transporter.read({method:P,path:o("1/indexes/%s/query",e.indexName),data:{query:t},cacheable:!0},r)}},N=function(e){return function(t,r,n){return e.transporter.read({method:P,path:o("1/indexes/%s/facets/%s/query",e.indexName,t),data:{facetQuery:r},cacheable:!0},n)}};return function(n,o){var s,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},c=(s=i.logLevel||e.Error,{debug:function(t,r){return e.Debug>=s&&console.debug(t,r),Promise.resolve()},info:function(t,r){return e.Info>=s&&console.info(t,r),Promise.resolve()},error:function(e,t){return console.error(e,t),Promise.resolve()}});return O({appId:n,apiKey:o,timeouts:{connect:1,read:2,write:30},requester:{send:function(e){return new Promise((function(t){var r=new XMLHttpRequest;r.open(e.method,e.url,!0),Object.keys(e.headers).forEach((function(t){return r.setRequestHeader(t,e.headers[t])}));var n,o=function(e,n){return setTimeout((function(){r.abort(),t({status:0,content:n,isTimedOut:!0})}),1e3*e)},a=o(e.connectTimeout,"Connection timeout");r.onreadystatechange=function(){r.readyState>r.OPENED&&void 0===n&&(clearTimeout(a),n=o(e.socketTimeout,"Socket timeout"))},r.onerror=function(){0===r.status&&(clearTimeout(a),clearTimeout(n),t({content:r.responseText||"Network request failed",status:r.status,isTimedOut:!1}))},r.onload=function(){clearTimeout(a),clearTimeout(n),t({content:r.responseText,status:r.status,isTimedOut:!1})},r.send(e.data)}))}},logger:c,responsesCache:r(),requestsCache:r({serializable:!1}),hostsCache:t({version:a,logger:c}),userAgent:p(a).add({segment:"Browser",version:"lite"}),authMode:u.WithinQueryParameters,methods:{search:w,searchForFacetValues:q,multipleQueries:w,multipleSearchForFacetValues:q,initIndex:function(e){return function(t){return j(e)(t,{methods:{search:S,searchForFacetValues:N}})}}}})}}));
