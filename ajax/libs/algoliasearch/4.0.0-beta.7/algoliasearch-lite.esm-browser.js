const e={Debug:1,Info:2,Error:3};function t(e,t={debug:(e,t)=>Promise.resolve(),info:(e,t)=>Promise.resolve(),error:(e,t)=>Promise.resolve()},r=window.localStorage){const s=`algoliasearch-client-js-${e}`,a="LocalStorage is not available or json could not be decoded.",o=()=>JSON.parse(r.getItem(s)||"{}");return{get(e,r,s={miss:()=>Promise.resolve()}){try{const t=JSON.stringify(e),r=o()[t];if(void 0!==r)return Promise.resolve(r)}catch(e){t.debug(a)}const n=r();return n.then(e=>s.miss(e)).then(()=>n)},set(e,n){try{const t=o();t[JSON.stringify(e)]=n,r.setItem(s,JSON.stringify(t))}catch(e){t.debug(a)}return Promise.resolve(n)},delete(e){try{const t=o();delete t[JSON.stringify(e)],r.setItem(s,JSON.stringify(t))}catch(e){t.debug(a)}return Promise.resolve()},clear(){try{r.removeItem(s)}catch(e){t.debug(a)}return Promise.resolve()}}}function r(){let e={};return{get(t,r,s={miss:()=>Promise.resolve()}){const a=JSON.stringify(t);if(a in e)return Promise.resolve(e[a]);const o=r(),n=s&&s.miss||(()=>Promise.resolve());return o.then(e=>n(e)).then(()=>o)},set:(t,r)=>(e[JSON.stringify(t)]=r,Promise.resolve(r)),delete:t=>(delete e[JSON.stringify(t)],Promise.resolve()),clear:()=>(e={},Promise.resolve())}}function s(e,t){return Object.keys(void 0!==t?t:{}).forEach(r=>{e[r]=t[r](e)}),e}function a(e,...t){let r=0;return e.replace(/%s/g,()=>encodeURIComponent(t[r++]))}const o="4.0.0-beta.7",n={WithinQueryParameters:0,WithinHeaders:1},c=3e5;const i=(e,t,r)=>(e=>{const t=e.status;return e.isTimedOut||(({isTimedOut:e,status:t})=>!e&&0==~~t)(e)||2!=~~(t/100)&&4!=~~(t/100)})(t)?(t.isTimedOut||e.setAsDown(),r.onRetry(t)):(({status:e})=>2==~~(e/100))(t)?r.onSucess(t):r.onFail(t);function u(e,t,r,s){const a=[];let o=0;const n=function(e,t){const r=Array.isArray(e.data)?e.data:{...e.data,...t.data};if(r.constructor===Object&&0===Object.entries(r).length)return"";return JSON.stringify(r)}(r,s),c={...e.headers,...s.headers},u=r.method,l=t=>{const d=t.pop();if(void 0===d)throw function(e){return{name:"RetryError",message:"Unreachable hosts - your application id may be incorrect. If the error persists, contact support@algolia.com.",stackTrace:e}}(a);const m=o+1,p={data:n,headers:c,method:u,url:h(d,r.path,{...e.queryParameters,...s.queryParameters,"x-algolia-agent":e.userAgent.value}),connectTimeout:m*e.timeouts.connect,socketTimeout:m*(s.timeout||0)},g={onSucess:e=>(function(e){try{return JSON.parse(e.content)}catch(t){throw function(e,t){return{name:"DeserializationError",message:e,response:t}}(t.message,e)}})(e),onRetry(r){const s={request:p,response:r,host:d,triesLeft:t.length,timeoutRetries:o};return a.push(s),r.isTimedOut&&o++,Promise.all([e.logger.debug("Retryable failure",s),e.hostsCache.set({url:d.url},d)]).then(()=>l(t))},onFail(e){throw function({content:e,status:t}){let r=e;try{r=JSON.parse(e).message}catch(e){}return function(e,t){return{name:"ApiError",message:e,status:t}}(r,t)}(e)}};return e.requester.send(p).then(e=>i(d,e,g))};return function(e,t){return Promise.all(t.map(t=>e.get({url:t.url},()=>Promise.resolve(t)).then(e=>Object.assign(t,{downDate:e.downDate,up:e.up})))).then(e=>e.filter(e=>e.isUp()).reverse())}(e.hostsCache,t).then(e=>l(e))}function l(e){const{hostsCache:t,logger:r,requester:s,requestsCache:a,responsesCache:o,timeouts:n,userAgent:i}=e,l={hostsCache:t,logger:r,requester:s,requestsCache:a,responsesCache:o,timeouts:n,userAgent:i,headers:{},queryParameters:{},hosts:[],addHeaders(e){Object.assign(l.headers,e)},addQueryParameters(e){Object.assign(l.queryParameters,e)},setHosts(e){l.hosts=e.map(e=>(function(e){const t={protocol:e.protocol||"https",url:e.url,accept:e.accept,downDate:0,up:!0,setAsDown(){t.downDate=Date.now(),t.up=!1},isUp:()=>(!t.up&&Date.now()-t.downDate>c&&(t.up=!0),t.up)};return t})(e))},read(e,t){const r=m(t,l.timeouts.read),s={request:e,mappedRequestOptions:r},a=()=>u(l,l.hosts.filter(e=>0!=(e.accept&g.Read)),e,r);return!0!==(void 0!==r.cacheable?r.cacheable:e.cacheable)?a():l.responsesCache.get(s,()=>l.requestsCache.get(s,()=>l.requestsCache.set(s,a()).then(e=>Promise.all([l.requestsCache.delete(s),e]),e=>Promise.all([l.requestsCache.delete(s),Promise.reject(e)])).then(e=>e[1])),{miss:e=>l.responsesCache.set(s,e)})},write:(e,t)=>u(l,l.hosts.filter(e=>0!=(e.accept&g.Write)),e,m(t,l.timeouts.write))};return l}function d(e){const t={value:`Algolia for JavaScript (${e})`,add(e){const r=`; ${e.segment}${void 0!==e.version?` (${e.version})`:""}`;return-1===t.value.indexOf(r)&&(t.value=`${t.value}${r}`),t}};return t}function m(e,t){const r=e||{},s={};return Object.keys(r).forEach(e=>{-1===["timeout","headers","queryParameters","data","cacheable"].indexOf(e)&&(s[e]=r[e])}),{data:s,timeout:r.timeout||t,headers:r.headers||{},queryParameters:r.queryParameters||{},cacheable:r.cacheable}}function h(e,t,r){const s=p(r);let a=`${e.protocol}://${e.url}/${"/"===t.charAt(0)?t.substr(1):t}`;return s.length&&(a+=`?${s}`),a}function p(e){return Object.keys(e).map(t=>a("%s=%s",t,(e=>"[object Object]"===Object.prototype.toString.call(e)||"[object Array]"===Object.prototype.toString.call(e))(e[t])?JSON.stringify(e[t]):e[t])).join("&")}const g={Read:1,Write:2,Any:3},f=e=>{const t=e.appId,r=l(e);r.setHosts([{url:`${t}-dsn.algolia.net`,accept:g.Read},{url:`${t}.algolia.net`,accept:g.Write}].concat(function(e){let t=e.length-1;for(;t>0;t--){const r=Math.floor(Math.random()*(t+1)),s=e[t];e[t]=e[r],e[r]=s}return e}([{url:`${t}-1.algolianet.com`,accept:g.Any},{url:`${t}-2.algolianet.com`,accept:g.Any},{url:`${t}-3.algolianet.com`,accept:g.Any}])));const a=function(e,t,r){const s={"x-algolia-api-key":r,"x-algolia-application-id":t};return{headers:()=>e===n.WithinHeaders?s:{},queryParameters:()=>e===n.WithinQueryParameters?s:{}}}(void 0!==e.authMode?e.authMode:n.WithinHeaders,t,e.apiKey);return r.addHeaders({...a.headers(),"content-type":"application/x-www-form-urlencoded"}),r.addQueryParameters(a.queryParameters()),s({transporter:r,appId:t,addAlgoliaAgent(e,t){r.userAgent.add({segment:e,version:t})}},e.methods)},y="POST",b=e=>(t,r={})=>{return s({transporter:e.transporter,appId:e.appId,indexName:t},r.methods)},P=e=>(t,r)=>{const s=t.map(e=>({...e,params:p(e.params||{})}));return e.transporter.read({method:y,path:"1/indexes/*/queries",data:{requests:s},cacheable:!0},r)},v=e=>(t,r)=>Promise.all(t.map(t=>{const{facetName:s,facetQuery:a,...o}=t.params;return b(e)(t.indexName,{methods:{searchForFacetValues:q}}).searchForFacetValues(s,a,{...r,...o})})),O=e=>(t,r)=>e.transporter.read({method:y,path:a("1/indexes/%s/query",e.indexName),data:{query:t},cacheable:!0},r),q=e=>(t,r,s)=>e.transporter.read({method:y,path:a("1/indexes/%s/facets/%s/query",e.indexName,t),data:{facetQuery:r},cacheable:!0},s);export default function(s,a,c={}){const i=(u=c.logLevel||e.Error,{debug:(t,r)=>(e.Debug>=u&&console.debug(t,r),Promise.resolve()),info:(t,r)=>(e.Info>=u&&console.info(t,r),Promise.resolve()),error:(e,t)=>(console.error(e,t),Promise.resolve())});var u;return f({appId:s,apiKey:a,timeouts:{connect:1,read:2,write:30},requester:{send:e=>new Promise(t=>{const r=new XMLHttpRequest;r.open(e.method,e.url,!0),Object.keys(e.headers).forEach(t=>r.setRequestHeader(t,e.headers[t]));const s=(e,s)=>setTimeout(()=>{r.abort(),t({status:0,content:s,isTimedOut:!0})},1e3*e),a=s(e.connectTimeout,"Connection timeout");let o;r.onreadystatechange=()=>{r.readyState>r.OPENED&&void 0===o&&(clearTimeout(a),o=s(e.socketTimeout,"Socket timeout"))},r.onerror=()=>{0===r.status&&(clearTimeout(a),clearTimeout(o),t({content:r.responseText||"Network request failed",status:r.status,isTimedOut:!1}))},r.onload=()=>{clearTimeout(a),clearTimeout(o),t({content:r.responseText,status:r.status,isTimedOut:!1})},r.send(e.data)})},logger:i,responsesCache:r(),requestsCache:r(),hostsCache:t(o,i),userAgent:d(o).add({segment:"Browser",version:"lite"}),authMode:n.WithinQueryParameters,methods:{search:P,searchForFacetValues:v,multipleQueries:P,multipleSearchForFacetValues:v,initIndex:e=>t=>b(e)(t,{methods:{search:O,searchForFacetValues:q}})}})}
