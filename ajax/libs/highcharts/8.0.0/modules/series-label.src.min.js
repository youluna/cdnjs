"use strict";!function(e){"object"==typeof module&&module.exports?module.exports=e.default=e:"function"==typeof define&&define.amd?define("highcharts/modules/series-label",["highcharts"],function(t){return e(t),e.Highcharts=t,e}):e("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(t){var e=t?t._modules:{};function o(t,e,o,r){t.hasOwnProperty(e)||(t[e]=r.apply(null,o))}o(e,"modules/series-label.src.js",[e["parts/Globals.js"],e["parts/Utilities.js"]],function(e,t){var k=t.animObject,z=t.extend,M=t.isNumber,E=t.pick,o=t.syncTimeout,r=e.addEvent,i=e.Series,a=e.SVGRenderer,h=e.Chart;function s(t,e,o,r,i,a){var h=(a-e)*(o-t)-(r-e)*(i-t);return 0<h||!(h<0)}function l(t,e,o,r,i,a,h,n){return s(t,e,i,a,h,n)!==s(o,r,i,a,h,n)&&s(t,e,o,r,i,a)!==s(t,e,o,r,h,n)}function Y(t,e,o,r,i,a,h,n){return l(t,e,t+o,e,i,a,h,n)||l(t+o,e,t+o,e+r,i,a,h,n)||l(t,e+r,t+o,e+r,i,a,h,n)||l(t,e,t,e+r,i,a,h,n)}function n(i){var a=this,h=k(a.renderer.globalAnimation).duration;a.labelSeries=[],a.labelSeriesMaxSum=0,e.clearTimeout(a.seriesLabelTimer),a.series.forEach(function(t){var e=t.options.label,o=t.labelBySeries,r=o&&o.closest;e.enabled&&t.visible&&(t.graph||t.area)&&!t.isSeriesBoosting&&(a.labelSeries.push(t),e.minFontSize&&e.maxFontSize&&(t.sum=t.yData.reduce(function(t,e){return(t||0)+(e||0)},0),a.labelSeriesMaxSum=Math.max(a.labelSeriesMaxSum,t.sum)),"load"===i.type&&(h=Math.max(h,k(t.options.animation).duration)),r&&(void 0!==r[0].plotX?o.animate({x:r[0].plotX+r[1],y:r[0].plotY+r[2]}):o.attr({opacity:0})))}),a.seriesLabelTimer=o(function(){a.series&&a.labelSeries&&a.drawSeriesLabels()},a.renderer.forExport||!h?0:h)}e.setOptions({plotOptions:{series:{label:{enabled:!0,connectorAllowed:!1,connectorNeighbourDistance:24,minFontSize:null,maxFontSize:null,onArea:null,style:{fontWeight:"bold"},boxesToAvoid:[]}}}}),a.prototype.symbols.connector=function(t,e,o,r,i){var a,h,n=i&&i.anchorX,s=i&&i.anchorY,l=o/2;return M(n)&&M(s)&&(a=["M",n,s],(h=e-s)<0&&(h=-r-h),h<o&&(l=n<t+o/2?h:o-h),e+r<s?a.push("L",t+l,e+r):s<e?a.push("L",t+l,e):n<t?a.push("L",t,e+r/2):t+o<n&&a.push("L",t+o,e+r/2)),a||[]},i.prototype.getPointsOnGraph=function(){if(this.xAxis||this.yAxis){var t,e,o,r,i,a,h,n,s,l,c=this.points,p=[],d=this.graph||this.area,u=d.element,x=this.chart.inverted,f=this.xAxis,b=this.yAxis,g=x?b.pos:f.pos,m=x?f.pos:b.pos,y=E(this.options.label.onArea,!!this.area),Y=b.getThreshold(this.options.threshold),X={};if(this.getPointSpline&&u.getPointAtLength&&!y&&c.length<this.chart.plotSizeX/16){for(d.toD&&(l=d.attr("d"),d.attr({d:d.toD})),h=u.getTotalLength(),o=0;o<h;o+=16)w({chartX:g+(t=u.getPointAtLength(o)).x,chartY:m+t.y,plotX:t.x,plotY:t.y});l&&d.attr({d:l}),(t=c[c.length-1]).chartX=g+t.plotX,t.chartY=m+t.plotY,w(t)}else for(h=c.length,o=0;o<h;o+=1){if(t=c[o],e=c[o-1],t.chartX=g+t.plotX,t.chartY=m+t.plotY,y&&(t.chartCenterY=m+(t.plotY+E(t.yBottom,Y))/2),0<o&&(r=Math.abs(t.chartX-e.chartX),i=Math.abs(t.chartY-e.chartY),16<(a=Math.max(r,i))))for(n=Math.ceil(a/16),s=1;s<n;s+=1)w({chartX:e.chartX+(t.chartX-e.chartX)*(s/n),chartY:e.chartY+(t.chartY-e.chartY)*(s/n),chartCenterY:e.chartCenterY+(t.chartCenterY-e.chartCenterY)*(s/n),plotX:e.plotX+(t.plotX-e.plotX)*(s/n),plotY:e.plotY+(t.plotY-e.plotY)*(s/n)});M(t.plotY)&&w(t)}return p}function w(t){var e=Math.round(t.plotX/8)+","+Math.round(t.plotY/8);X[e]||(X[e]=1,p.push(t))}},i.prototype.labelFontSize=function(t,e){return t+this.sum/this.chart.labelSeriesMaxSum*(e-t)+"px"},i.prototype.checkClearPoint=function(t,e,o,r){var i,a,h,n,s,l,c,p,d,u,x,f=Number.MAX_VALUE,b=Number.MAX_VALUE,g=E(this.options.label.onArea,!!this.area),m=g||this.options.label.connectorAllowed,y=this.chart;for(p=0;p<y.boxesToAvoid.length;p+=1)if(u=y.boxesToAvoid[p],!((x={left:t,right:t+o.width,top:e,bottom:e+o.height}).left>u.right||x.right<u.left||x.top>u.bottom||x.bottom<u.top))return!1;for(p=0;p<y.series.length;p+=1)if(n=(h=y.series[p]).interpolatedPoints,h.visible&&n){for(d=1;d<n.length;d+=1){if(n[d].chartX>=t-16&&n[d-1].chartX<=t+o.width+16){if(Y(t,e,o.width,o.height,n[d-1].chartX,n[d-1].chartY,n[d].chartX,n[d].chartY))return!1;this===h&&!s&&r&&(s=Y(t-16,e-16,o.width+32,o.height+32,n[d-1].chartX,n[d-1].chartY,n[d].chartX,n[d].chartY))}!m&&!s||this===h&&!g||(l=t+o.width/2-n[d].chartX,c=e+o.height/2-n[d].chartY,f=Math.min(f,l*l+c*c))}if(!g&&m&&this===h&&(r&&!s||f<Math.pow(this.options.label.connectorNeighbourDistance,2))){for(d=1;d<n.length;d+=1)(i=Math.min(Math.pow(t+o.width/2-n[d].chartX,2)+Math.pow(e+o.height/2-n[d].chartY,2),Math.pow(t-n[d].chartX,2)+Math.pow(e-n[d].chartY,2),Math.pow(t+o.width-n[d].chartX,2)+Math.pow(e-n[d].chartY,2),Math.pow(t+o.width-n[d].chartX,2)+Math.pow(e+o.height-n[d].chartY,2),Math.pow(t-n[d].chartX,2)+Math.pow(e+o.height-n[d].chartY,2)))<b&&(b=i,a=n[d]);s=!0}}return!(r&&!s)&&{x:t,y:e,weight:f-(a?b:0),connectorPoint:a}},h.prototype.drawSeriesLabels=function(){var T=this,t=this.labelSeries;T.boxesToAvoid=[],t.forEach(function(t){t.interpolatedPoints=t.getPointsOnGraph(),(t.options.label.boxesToAvoid||[]).forEach(function(t){T.boxesToAvoid.push(t)})}),T.series.forEach(function(t){if(t.xAxis||t.yAxis){var e,o,r,i,a,h,n,s,l,c=[],p=t.options.label,d=T.inverted,u=d?t.yAxis.pos:t.xAxis.pos,x=d?t.xAxis.pos:t.yAxis.pos,f=T.inverted?t.yAxis.len:t.xAxis.len,b=T.inverted?t.xAxis.len:t.yAxis.len,g=t.interpolatedPoints,m=E(p.onArea,!!t.area),y=t.labelBySeries,Y=!y,X=p.minFontSize,w=p.maxFontSize,M="highcharts-color-"+E(t.colorIndex,"none");if(m&&!d&&(n=[t.xAxis.toPixels(t.xData[0]),t.xAxis.toPixels(t.xData[t.xData.length-1])],s=Math.min.apply(Math,n),l=Math.max.apply(Math,n)),t.visible&&!t.isSeriesBoosting&&g){for(y||(t.labelBySeries=y=T.renderer.label(t.name,0,-9999,"connector").addClass("highcharts-series-label highcharts-series-label-"+t.index+" "+(t.options.className||"")+M),T.renderer.styledMode||y.css(z({color:m?T.renderer.getContrast(t.color):t.color},t.options.label.style)),X&&w&&y.css({fontSize:t.labelFontSize(X,w)}),y.attr({padding:0,opacity:T.renderer.forExport?1:0,stroke:t.color,"stroke-width":1,zIndex:3}).add()),(e=y.getBBox()).width=Math.round(e.width),a=g.length-1;0<a;--a)m?C(o=g[a].chartX-e.width/2,r=g[a].chartCenterY-e.height/2,e)&&(h=t.checkClearPoint(o,r,e)):(C(o=g[a].chartX+3,r=g[a].chartY-e.height-3,e)&&(h=t.checkClearPoint(o,r,e,!0)),h&&c.push(h),C(o=g[a].chartX+3,r=g[a].chartY+3,e)&&(h=t.checkClearPoint(o,r,e,!0)),h&&c.push(h),C(o=g[a].chartX-e.width-3,r=g[a].chartY+3,e)&&(h=t.checkClearPoint(o,r,e,!0)),h&&c.push(h),C(o=g[a].chartX-e.width-3,r=g[a].chartY-e.height-3,e)&&(h=t.checkClearPoint(o,r,e,!0))),h&&c.push(h);if(p.connectorAllowed&&!c.length&&!m)for(o=u+f-e.width;u<=o;o-=16)for(r=x;r<x+b-e.height;r+=16)(i=t.checkClearPoint(o,r,e,!0))&&c.push(i);if(c.length){c.sort(function(t,e){return e.weight-t.weight}),h=c[0],T.boxesToAvoid.push({left:h.x,right:h.x+e.width,top:h.y,bottom:h.y+e.height});var A=Math.sqrt(Math.pow(Math.abs(h.x-y.x),2),Math.pow(Math.abs(h.y-y.y),2));if(A){var S={opacity:T.renderer.forExport?1:0,x:h.x,y:h.y},v={opacity:1};A<=10&&(v={x:S.x,y:S.y},S={}),t.labelBySeries.attr(z(S,{anchorX:h.connectorPoint&&h.connectorPoint.plotX+u,anchorY:h.connectorPoint&&h.connectorPoint.plotY+x})).animate(v,Y?.2*k(t.options.animation).duration:T.renderer.globalAnimation),t.options.kdNow=!0,t.buildKDTree();var P=t.searchPoint({chartX:h.x,chartY:h.y},!0);y.closest=[P,h.x-P.plotX,h.y-P.plotY]}}else L()}else L()}function C(t,e,o){var r=Math.max(u,E(s,-1/0)),i=Math.min(u+f,E(l,1/0));return r<t&&t<=i-o.width&&x<=e&&e<=x+b-o.height}function L(){y&&(t.labelBySeries=y.destroy())}}),e.fireEvent(T,"afterDrawSeriesLabels")},r(h,"load",n),r(h,"redraw",n)}),o(e,"masters/modules/series-label.src.js",[],function(){})});