"use strict";!function(t){"object"==typeof module&&module.exports?module.exports=t.default=t:"function"==typeof define&&define.amd?define("highcharts/modules/sankey",["highcharts"],function(o){return t(o),t.Highcharts=o,t}):t("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(o){var t=o?o._modules:{};function e(o,t,e,i){o.hasOwnProperty(t)||(o[t]=i.apply(null,e))}e(t,"mixins/nodes.js",[t["parts/Globals.js"],t["parts/Utilities.js"]],function(s,o){var i=o.defined,r=o.extend,l=o.pick,n=s.Point;s.NodesMixin={createNode:function(o){function t(o,t){return s.find(o,function(o){return o.id===t})}var e,n=t(this.nodes,o),i=this.pointClass;return n||(e=this.options.nodes&&t(this.options.nodes,o),(n=(new i).init(this,r({className:"highcharts-node",isNode:!0,id:o,y:1},e))).linksTo=[],n.linksFrom=[],n.formatPrefix="node",n.name=n.name||n.options.id,n.mass=l(n.options.mass,n.options.marker&&n.options.marker.radius,this.options.marker&&this.options.marker.radius,4),n.getSum=function(){var t=0,e=0;return n.linksTo.forEach(function(o){t+=o.weight}),n.linksFrom.forEach(function(o){e+=o.weight}),Math.max(t,e)},n.offset=function(o,t){for(var e=0,i=0;i<n[t].length;i++){if(n[t][i]===o)return e;e+=n[t][i].weight}},n.hasShape=function(){var t=0;return n.linksTo.forEach(function(o){o.outgoing&&t++}),!n.linksTo.length||t!==n.linksTo.length},this.nodes.push(n)),n},generatePoints:function(){var t=this.chart,e={};s.Series.prototype.generatePoints.call(this),this.nodes||(this.nodes=[]),this.colorCounter=0,this.nodes.forEach(function(o){o.linksFrom.length=0,o.linksTo.length=0,o.level=o.options.level}),this.points.forEach(function(o){i(o.from)&&(e[o.from]||(e[o.from]=this.createNode(o.from)),e[o.from].linksFrom.push(o),o.fromNode=e[o.from],t.styledMode?o.colorIndex=l(o.options.colorIndex,e[o.from].colorIndex):o.color=o.options.color||e[o.from].color),i(o.to)&&(e[o.to]||(e[o.to]=this.createNode(o.to)),e[o.to].linksTo.push(o),o.toNode=e[o.to]),o.name=o.name||o.id},this),this.nodeLookup=e},setData:function(){this.nodes&&(this.nodes.forEach(function(o){o.destroy()}),this.nodes.length=0),s.Series.prototype.setData.apply(this,arguments)},destroy:function(){return this.data=[].concat(this.points||[],this.nodes),s.Series.prototype.destroy.apply(this,arguments)},setNodeState:function(o){var t=arguments,e=this.isNode?this.linksTo.concat(this.linksFrom):[this.fromNode,this.toNode];"select"!==o&&e.forEach(function(o){o.series&&(n.prototype.setState.apply(o,t),o.isNode||(o.fromNode.graphic&&n.prototype.setState.apply(o.fromNode,t),o.toNode.graphic&&n.prototype.setState.apply(o.toNode,t)))}),n.prototype.setState.apply(this,t)}}}),e(t,"mixins/tree-series.js",[t["parts/Globals.js"],t["parts/Utilities.js"]],function(N,o){function p(o){return"boolean"==typeof o}var u=o.extend,a=o.isArray,h=o.isNumber,d=o.isObject,k=o.pick,c=N.merge;return{getColor:function(o,t){var e,i,n,s,r,l,a,h,d=t.index,c=t.mapOptionsToLevel,p=t.parentColor,u=t.parentColorIndex,f=t.series,m=t.colors,v=t.siblings,g=f.points,y=f.chart.options.chart;return o&&(e=g[o.i],i=c[o.level]||{},e&&i.colorByPoint&&(s=e.index%(m?m.length:y.colorCount),n=m&&m[s]),f.chart.styledMode||(r=k(e&&e.options.color,i&&i.color,n,p&&(a=p,(h=i&&i.colorVariation)&&"brightness"===h.key?N.color(a).brighten(h.to*(d/v)).get():a),f.color)),l=k(e&&e.options.colorIndex,i&&i.colorIndex,s,u,t.colorIndex)),{color:r,colorIndex:l}},getLevelOptions:function(o){var s,t,e,r,i,n,l=null;if(d(o))for(l={},r=h(o.from)?o.from:1,n=o.levels,t={},s=d(o.defaults)?o.defaults:{},a(n)&&(t=n.reduce(function(o,t){var e,i,n;return d(t)&&h(t.level)&&(n=c({},t),i=p(n.levelIsConstant)?n.levelIsConstant:s.levelIsConstant,delete n.levelIsConstant,delete n.level,e=t.level+(i?0:r-1),d(o[e])?u(o[e],n):o[e]=n),o},{})),i=h(o.to)?o.to:1,e=0;e<=i;e++)l[e]=c({},s,d(t[e])?t[e]:{});return l},setTreeValues:function i(n,s){var o,t=s.before,e=s.idRoot,r=s.mapIdToNode[e],l=!p(s.levelIsConstant)||s.levelIsConstant,a=s.points[n.i],h=a&&a.options||{},d=0,c=[];return u(n,{levelDynamic:n.level-(l?0:r.level),name:k(a&&a.name,""),visible:e===n.id||!!p(s.visible)&&s.visible}),"function"==typeof t&&(n=t(n,s)),n.children.forEach(function(o,t){var e=u({},s);u(e,{index:t,siblings:n.children.length,visible:n.visible}),o=i(o,e),c.push(o),o.visible&&(d+=o.val)}),n.visible=0<d||n.visible,o=k(h.value,d),u(n,{children:c,childrenTotal:d,isLeaf:n.visible&&!d,val:o}),n},updateRootId:function(o){var t,e;return d(o)&&(e=d(o.options)?o.options:{},t=k(o.rootNode,e.rootId,""),d(o.userOptions)&&(o.userOptions.rootId=t),o.rootNode=t),t}}}),e(t,"modules/sankey.src.js",[t["parts/Globals.js"],t["parts/Utilities.js"],t["mixins/tree-series.js"]],function(h,o,t){var r=o.defined,v=o.isObject,g=o.pick,l=o.relativeLength,a=t.getLevelOptions,d=h.find,y=h.merge,e=h.seriesType,i=h.Point;e("sankey","column",{borderWidth:0,colorByPoint:!0,curveFactor:.33,dataLabels:{enabled:!0,backgroundColor:"none",crop:!1,nodeFormat:void 0,nodeFormatter:function(){return this.point.name},format:void 0,formatter:function(){},inside:!0},inactiveOtherPoints:!0,linkOpacity:.5,minLinkWidth:0,nodeWidth:20,nodePadding:10,showInLegend:!1,states:{hover:{linkOpacity:1},inactive:{linkOpacity:.1,opacity:.1,animation:{duration:50}}},tooltip:{followPointer:!0,headerFormat:'<span style="font-size: 10px">{series.name}</span><br/>',pointFormat:"{point.fromNode.name} â†’ {point.toNode.name}: <b>{point.weight}</b><br/>",nodeFormat:"{point.name}: <b>{point.sum}</b><br/>"}},{isCartesian:!1,invertable:!0,forceDL:!0,orderNodes:!0,pointArrayMap:["from","to"],createNode:h.NodesMixin.createNode,setData:h.NodesMixin.setData,destroy:h.NodesMixin.destroy,getNodePadding:function(){return this.options.nodePadding},createNodeColumn:function(){var t=this.chart,s=[],r=this.getNodePadding();return s.sum=function(){return this.reduce(function(o,t){return o+t.getSum()},0)},s.offset=function(o,t){for(var e,i=0,n=0;n<s.length;n++){if(e=s[n].getSum()*t+r,s[n]===o)return{relativeTop:i+l(o.options.offset||0,e)};i+=e}},s.top=function(e){var o=this.reduce(function(o,t){return 0<o&&(o+=r),o+=t.getSum()*e},0);return(t.plotSizeY-o)/2},s},createNodeColumns:function(){var s=[];this.nodes.forEach(function(i){var o,n,t,e=-1;if(!r(i.options.column))if(0===i.linksTo.length)i.column=0;else{for(n=0;n<i.linksTo.length;n++)(t=i.linksTo[0]).fromNode.column>e&&(e=(o=t.fromNode).column);i.column=e+1,o&&"hanging"===o.options.layout&&(i.hangsFrom=o,n=-1,d(o.linksFrom,function(o,t){var e=o.toNode===i;return e&&(n=t),e}),i.column+=n)}s[i.column]||(s[i.column]=this.createNodeColumn()),s[i.column].push(i)},this);for(var o=0;o<s.length;o++)void 0===s[o]&&(s[o]=this.createNodeColumn());return s},hasData:function(){return!!this.processedXData.length},pointAttribs:function(o,t){var e=this,i=o.isNode?o.level:o.fromNode.level,n=e.mapOptionsToLevel[i||0]||{},s=o.options,r=n.states&&n.states[t]||{},l=["colorByPoint","borderColor","borderWidth","linkOpacity"].reduce(function(o,t){return o[t]=g(r[t],s[t],n[t],e.options[t]),o},{}),a=g(r.color,s.color,l.colorByPoint?o.color:n.color);return o.isNode?{fill:a,stroke:l.borderColor,"stroke-width":l.borderWidth}:{fill:h.color(a).setOpacity(l.linkOpacity).get()}},generatePoints:function(){h.NodesMixin.generatePoints.apply(this,arguments),this.orderNodes&&(this.nodes.filter(function(o){return 0===o.linksTo.length}).forEach(function(o){!function t(o,e){void 0===o.level&&(o.level=e,o.linksFrom.forEach(function(o){t(o.toNode,e+1)}))}(o,0)}),h.stableSort(this.nodes,function(o,t){return o.level-t.level}))},translateNode:function(o,t){var e,i,n,s=this.translationFactor,r=this.chart,l=this.options,a=o.getSum(),h=Math.round(a*s),d=Math.round(l.borderWidth)%2/2,c=t.offset(o,s),p=Math.floor(g(c.absoluteTop,t.top(s)+c.relativeTop))+d,u=Math.floor(this.colDistance*o.column+l.borderWidth/2)+d,f=r.inverted?r.plotSizeX-u:u,m=Math.round(this.nodeWidth);o.sum=a,o.shapeType="rect",o.nodeX=f,o.nodeY=p,r.inverted?o.shapeArgs={x:f-m,y:r.plotSizeY-p-h,width:o.options.height||l.height||m,height:o.options.width||l.width||h}:o.shapeArgs={x:f,y:p,width:o.options.width||l.width||m,height:o.options.height||l.height||h},o.shapeArgs.display=o.hasShape()?"":"none",o.dlOptions=(e={level:this.mapOptionsToLevel[o.level],optionsPoint:o.options},i=v(e.optionsPoint)?e.optionsPoint.dataLabels:{},n=v(e.level)?e.level.dataLabels:{},y({style:{}},n,i)),o.plotY=1},translateLink:function(o){var t=o.fromNode,e=o.toNode,i=this.chart,n=this.translationFactor,s=Math.max(o.weight*n,this.options.minLinkWidth),r=this.options,l=t.offset(o,"linksFrom")*n,a=(i.inverted?-this.colDistance:this.colDistance)*r.curveFactor,h=t.nodeY+l,d=t.nodeX,c=this.nodeColumns[e.column].top(n)+e.offset(o,"linksTo")*n+this.nodeColumns[e.column].offset(e,n).relativeTop,p=this.nodeWidth,u=e.column*this.colDistance,f=o.outgoing,m=d<u;if(i.inverted&&(h=i.plotSizeY-h,c=i.plotSizeY-c,p=-p,s=-s,m=(u=i.plotSizeX-u)<d),o.shapeType="path",o.linkBase=[h,h+s,c,c+s],m)o.shapeArgs={d:["M",d+p,h,"C",d+p+a,h,u-a,c,u,c,"L",u+(f?p:0),c+s/2,"L",u,c+s,"C",u-a,c+s,d+p+a,h+s,d+p,h+s,"z"]};else{var v=u-20-s,g=u-20,y=d+p,N=y+20,k=N+s,b=h+s,C=b+20,x=C+(i.plotHeight-h-s),L=x+20,S=L+s,T=c+s,P=T+20,O=b-.7*s,w=L+.7*s,F=T-.7*s,I=u-.7*s,M=y+.7*s;o.shapeArgs={d:["M",y,h,"C",M,h,k,O,k,C,"L",k,x,"C",k,w,M,S,y,S,"L",u,S,"C",I,S,v,w,v,x,"L",v,P,"C",v,F,I,c,u,c,"L",u,T,"C",g,T,g,T,g,P,"L",g,x,"C",g,L,g,L,u,L,"L",y,L,"C",N,L,N,L,N,x,"L",N,C,"C",N,b,N,b,y,b,"z"]}}o.dlBox={x:d+(u-d+p)/2,y:h+(c-h)/2,height:s,width:0},o.y=o.plotY=1,o.color||(o.color=t.color)},translate:function(){this.processedXData||this.processData(),this.generatePoints(),this.nodeColumns=this.createNodeColumns(),this.nodeWidth=l(this.options.nodeWidth,this.chart.plotSizeX);var e=this,i=this.chart,n=this.options,o=this.nodeWidth,t=this.nodeColumns,s=this.getNodePadding();this.translationFactor=t.reduce(function(o,t){var e=i.plotSizeY-n.borderWidth-(t.length-1)*s;return Math.min(o,e/t.sum())},1/0),this.colDistance=(i.plotSizeX-o-n.borderWidth)/Math.max(1,t.length-1),e.mapOptionsToLevel=a({from:1,levels:n.levels,to:t.length-1,defaults:{borderColor:n.borderColor,borderRadius:n.borderRadius,borderWidth:n.borderWidth,color:e.color,colorByPoint:n.colorByPoint,levelIsConstant:!0,linkColor:n.linkColor,linkLineWidth:n.linkLineWidth,linkOpacity:n.linkOpacity,states:n.states}}),t.forEach(function(t){t.forEach(function(o){e.translateNode(o,t)})},this),this.nodes.forEach(function(o){o.linksFrom.forEach(function(o){e.translateLink(o),o.allowShadow=!1})})},render:function(){var o=this.points;this.points=this.points.concat(this.nodes||[]),h.seriesTypes.column.prototype.render.call(this),this.points=o},animate:h.Series.prototype.animate},{applyOptions:function(o,t){return i.prototype.applyOptions.call(this,o,t),r(this.options.level)&&(this.options.column=this.column=this.options.level),this},setState:h.NodesMixin.setNodeState,getClassName:function(){return(this.isNode?"highcharts-node ":"highcharts-link ")+i.prototype.getClassName.call(this)},isValid:function(){return this.isNode||"number"==typeof this.weight}})}),e(t,"masters/modules/sankey.src.js",[],function(){})});