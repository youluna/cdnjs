"use strict";import H from"./../../parts/Globals.js";import U from"./../../parts/Utilities.js";var extend=U.extend,isNumber=U.isNumber,pick=U.pick;import"./../../parts/SvgRenderer.js";import controllableMixin from"./controllableMixin.js";import MockPoint from"./../MockPoint.js";function ControllableLabel(t,i,o){this.init(t,i,o),this.collection="labels"}ControllableLabel.shapesWithoutBackground=["connector"],ControllableLabel.alignedPosition=function(t,i){var o,n,e=t.align,l=t.verticalAlign,a=(i.x||0)+(t.x||0),s=(i.y||0)+(t.y||0);return"right"===e?o=1:"center"===e&&(o=2),o&&(a+=(i.width-(t.width||0))/o),"bottom"===l?n=1:"middle"===l&&(n=2),n&&(s+=(i.height-(t.height||0))/n),{x:Math.round(a),y:Math.round(s)}},ControllableLabel.justifiedOptions=function(t,i,o,n){var e,l=o.align,a=o.verticalAlign,s=i.box?0:i.padding||0,r=i.getBBox(),h={align:l,verticalAlign:a,x:o.x,y:o.y,width:i.width,height:i.height},c=n.x-t.plotLeft,p=n.y-t.plotTop;return(e=c+s)<0&&("right"===l?h.align="left":h.x=-e),(e=c+r.width-s)>t.plotWidth&&("left"===l?h.align="right":h.x=t.plotWidth-e),(e=p+s)<0&&("bottom"===a?h.verticalAlign="top":h.y=-e),(e=p+r.height-s)>t.plotHeight&&("top"===a?h.verticalAlign="bottom":h.y=t.plotHeight-e),h},ControllableLabel.attrsMap={backgroundColor:"fill",borderColor:"stroke",borderWidth:"stroke-width",zIndex:"zIndex",borderRadius:"r",padding:"padding"},H.merge(!0,ControllableLabel.prototype,controllableMixin,{translatePoint:function(t,i){controllableMixin.translatePoint.call(this,t,i,0)},translate:function(t,i){var o,n=this.annotation.chart,e=this.annotation.userOptions,l=n.annotations.indexOf(this.annotation),a=n.options.annotations[l];n.inverted&&(o=t,t=i,i=o),this.options.x+=t,this.options.y+=i,a[this.collection][this.index].x=this.options.x,a[this.collection][this.index].y=this.options.y,e[this.collection][this.index].x=this.options.x,e[this.collection][this.index].y=this.options.y},render:function(t){var i=this.options,o=this.attrsFromOptions(i),n=i.style;this.graphic=this.annotation.chart.renderer.label("",0,-9999,i.shape,null,null,i.useHTML,null,"annotation-label").attr(o).add(t),this.annotation.chart.styledMode||("contrast"===n.color&&(n.color=this.annotation.chart.renderer.getContrast(ControllableLabel.shapesWithoutBackground.indexOf(i.shape)>-1?"#FFFFFF":i.backgroundColor)),this.graphic.css(i.style).shadow(i.shadow)),i.className&&this.graphic.addClass(i.className),this.graphic.labelrank=i.labelrank,controllableMixin.render.call(this)},redraw:function(t){var i,o,n,e=this.options,l=this.text||e.format||e.text,a=this.graphic,s=this.points[0];a.attr({text:l?H.format(l,s.getLabelConfig(),this.annotation.chart):e.formatter.call(s,this)}),o=this.anchor(s),(i=n=this.position(o))?(a.alignAttr=n,n.anchorX=o.absolutePosition.x,n.anchorY=o.absolutePosition.y,a[t?"animate":"attr"](n)):a.attr({x:0,y:-9999}),a.placed=Boolean(i),controllableMixin.redraw.call(this,t)},anchor:function(){var t=controllableMixin.anchor.apply(this,arguments),i=this.options.x||0,o=this.options.y||0;return t.absolutePosition.x-=i,t.absolutePosition.y-=o,t.relativePosition.x-=i,t.relativePosition.y-=o,t},position:function(t){var i,o,n,e,l=this.graphic,a=this.annotation.chart,s=this.points[0],r=this.options,h=t.absolutePosition,c=t.relativePosition,p=s.series.visible&&MockPoint.prototype.isInsidePane.call(s);return p&&(r.distance?i=H.Tooltip.prototype.getPosition.call({chart:a,distance:pick(r.distance,16)},l.width,l.height,{plotX:c.x,plotY:c.y,negative:s.negative,ttBelow:s.ttBelow,h:c.height||c.width}):r.positioner?i=r.positioner.call(this):(o={x:h.x,y:h.y,width:0,height:0},i=ControllableLabel.alignedPosition(extend(r,{width:l.width,height:l.height}),o),"justify"===this.options.overflow&&(i=ControllableLabel.alignedPosition(ControllableLabel.justifiedOptions(a,l,r,i),o))),r.crop&&(n=i.x-a.plotLeft,e=i.y-a.plotTop,p=a.isInsidePlot(n,e)&&a.isInsidePlot(n+l.width,e+l.height))),p?i:null}}),H.SVGRenderer.prototype.symbols.connector=function(t,i,o,n,e){var l,a,s=e&&e.anchorX,r=e&&e.anchorY,h=o/2;return isNumber(s)&&isNumber(r)&&(l=["M",s,r],(a=i-r)<0&&(a=-n-a),a<o&&(h=s<t+o/2?a:o-a),r>i+n?l.push("L",t+h,i+n):r<i?l.push("L",t+h,i):s<t?l.push("L",t,i+n/2):s>t+o&&l.push("L",t+o,i+n/2)),l||[]};export default ControllableLabel;