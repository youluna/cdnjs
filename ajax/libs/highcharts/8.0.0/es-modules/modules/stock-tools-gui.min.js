"use strict";import H from"../parts/Globals.js";import U from"../parts/Utilities.js";var extend=U.extend,isArray=U.isArray,pick=U.pick,addEvent=H.addEvent,createElement=H.createElement,fireEvent=H.fireEvent,getStyle=H.getStyle,merge=H.merge,css=H.css,win=H.win,DIV="div",SPAN="span",UL="ul",LI="li",PREFIX="highcharts-",activeClass=PREFIX+"active";H.setOptions({lang:{stockTools:{gui:{simpleShapes:"Simple shapes",lines:"Lines",crookedLines:"Crooked lines",measure:"Measure",advanced:"Advanced",toggleAnnotations:"Toggle annotations",verticalLabels:"Vertical labels",flags:"Flags",zoomChange:"Zoom change",typeChange:"Type change",saveChart:"Save chart",indicators:"Indicators",currentPriceIndicator:"Current Price Indicators",zoomX:"Zoom X",zoomY:"Zoom Y",zoomXY:"Zooom XY",fullScreen:"Fullscreen",typeOHLC:"OHLC",typeLine:"Line",typeCandlestick:"Candlestick",circle:"Circle",label:"Label",rectangle:"Rectangle",flagCirclepin:"Flag circle",flagDiamondpin:"Flag diamond",flagSquarepin:"Flag square",flagSimplepin:"Flag simple",measureXY:"Measure XY",measureX:"Measure X",measureY:"Measure Y",segment:"Segment",arrowSegment:"Arrow segment",ray:"Ray",arrowRay:"Arrow ray",line:"Line",arrowLine:"Arrow line",horizontalLine:"Horizontal line",verticalLine:"Vertical line",infinityLine:"Infinity line",crooked3:"Crooked 3 line",crooked5:"Crooked 5 line",elliott3:"Elliott 3 line",elliott5:"Elliott 5 line",verticalCounter:"Vertical counter",verticalLabel:"Vertical label",verticalArrow:"Vertical arrow",fibonacci:"Fibonacci",pitchfork:"Pitchfork",parallelChannel:"Parallel channel"}},navigation:{popup:{circle:"Circle",rectangle:"Rectangle",label:"Label",segment:"Segment",arrowSegment:"Arrow segment",ray:"Ray",arrowRay:"Arrow ray",line:"Line",arrowLine:"Arrow line",horizontalLine:"Horizontal line",verticalLine:"Vertical line",crooked3:"Crooked 3 line",crooked5:"Crooked 5 line",elliott3:"Elliott 3 line",elliott5:"Elliott 5 line",verticalCounter:"Vertical counter",verticalLabel:"Vertical label",verticalArrow:"Vertical arrow",fibonacci:"Fibonacci",pitchfork:"Pitchfork",parallelChannel:"Parallel channel",infinityLine:"Infinity line",measure:"Measure",measureXY:"Measure XY",measureX:"Measure X",measureY:"Measure Y",flags:"Flags",addButton:"add",saveButton:"save",editButton:"edit",removeButton:"remove",series:"Series",volume:"Volume",connector:"Connector",innerBackground:"Inner background",outerBackground:"Outer background",crosshairX:"Crosshair X",crosshairY:"Crosshair Y",tunnel:"Tunnel",background:"Background"}}},stockTools:{gui:{enabled:!0,className:"highcharts-bindings-wrapper",toolbarClassName:"stocktools-toolbar",buttons:["indicators","separator","simpleShapes","lines","crookedLines","measure","advanced","toggleAnnotations","separator","verticalLabels","flags","separator","zoomChange","fullScreen","typeChange","separator","currentPriceIndicator","saveChart"],definitions:{separator:{symbol:"separator.svg"},simpleShapes:{items:["label","circle","rectangle"],circle:{symbol:"circle.svg"},rectangle:{symbol:"rectangle.svg"},label:{symbol:"label.svg"}},flags:{items:["flagCirclepin","flagDiamondpin","flagSquarepin","flagSimplepin"],flagSimplepin:{symbol:"flag-basic.svg"},flagDiamondpin:{symbol:"flag-diamond.svg"},flagSquarepin:{symbol:"flag-trapeze.svg"},flagCirclepin:{symbol:"flag-elipse.svg"}},lines:{items:["segment","arrowSegment","ray","arrowRay","line","arrowLine","horizontalLine","verticalLine"],segment:{symbol:"segment.svg"},arrowSegment:{symbol:"arrow-segment.svg"},ray:{symbol:"ray.svg"},arrowRay:{symbol:"arrow-ray.svg"},line:{symbol:"line.svg"},arrowLine:{symbol:"arrow-line.svg"},verticalLine:{symbol:"vertical-line.svg"},horizontalLine:{symbol:"horizontal-line.svg"}},crookedLines:{items:["elliott3","elliott5","crooked3","crooked5"],crooked3:{symbol:"crooked-3.svg"},crooked5:{symbol:"crooked-5.svg"},elliott3:{symbol:"elliott-3.svg"},elliott5:{symbol:"elliott-5.svg"}},verticalLabels:{items:["verticalCounter","verticalLabel","verticalArrow"],verticalCounter:{symbol:"vertical-counter.svg"},verticalLabel:{symbol:"vertical-label.svg"},verticalArrow:{symbol:"vertical-arrow.svg"}},advanced:{items:["fibonacci","pitchfork","parallelChannel"],pitchfork:{symbol:"pitchfork.svg"},fibonacci:{symbol:"fibonacci.svg"},parallelChannel:{symbol:"parallel-channel.svg"}},measure:{items:["measureXY","measureX","measureY"],measureX:{symbol:"measure-x.svg"},measureY:{symbol:"measure-y.svg"},measureXY:{symbol:"measure-xy.svg"}},toggleAnnotations:{symbol:"annotations-visible.svg"},currentPriceIndicator:{symbol:"current-price-show.svg"},indicators:{symbol:"indicators.svg"},zoomChange:{items:["zoomX","zoomY","zoomXY"],zoomX:{symbol:"zoom-x.svg"},zoomY:{symbol:"zoom-y.svg"},zoomXY:{symbol:"zoom-xy.svg"}},typeChange:{items:["typeOHLC","typeLine","typeCandlestick"],typeOHLC:{symbol:"series-ohlc.svg"},typeLine:{symbol:"series-line.svg"},typeCandlestick:{symbol:"series-candlestick.svg"}},fullScreen:{symbol:"fullscreen.svg"},saveChart:{symbol:"save-chart.svg"}}}}}),addEvent(H.Chart,"afterGetContainer",function(){this.setStockTools()}),addEvent(H.Chart,"getMargins",function(){var e=this.stockTools&&this.stockTools.listWrapper,t=e&&(e.startWidth+H.getStyle(e,"padding-left")+H.getStyle(e,"padding-right")||e.offsetWidth);t&&t<this.plotWidth&&(this.plotLeft+=t)}),addEvent(H.Chart,"destroy",function(){this.stockTools&&this.stockTools.destroy()}),addEvent(H.Chart,"redraw",function(){this.stockTools&&this.stockTools.guiEnabled&&this.stockTools.redraw()}),H.Toolbar=function(e,t,i){this.chart=i,this.options=e,this.lang=t,this.iconsURL=this.getIconsURL(),this.guiEnabled=e.enabled,this.visible=pick(e.visible,!0),this.placed=pick(e.placed,!1),this.eventsToUnbind=[],this.guiEnabled&&(this.createHTML(),this.init(),this.showHideNavigatorion()),fireEvent(this,"afterInit")},extend(H.Chart.prototype,{setStockTools:function(e){var t=this.options,i=t.lang,a=merge(t.stockTools&&t.stockTools.gui,e&&e.gui),o=i.stockTools&&i.stockTools.gui;this.stockTools=new H.Toolbar(a,o,this),this.stockTools.guiEnabled&&(this.isDirtyBox=!0)}}),H.Toolbar.prototype={init:function(){var e,t=this,i=this.lang,a=this.options,o=this.toolbar,s=t.addSubmenu,r=a.buttons,n=a.definitions,l=o.childNodes,c=this.inIframe();r.forEach(function(a){e=t.addButton(o,n,a,i),c&&"fullScreen"===a&&(e.buttonWrapper.className+=" "+PREFIX+"disabled-btn"),t.eventsToUnbind.push(addEvent(e.buttonWrapper,"click",function(){t.eraseActiveButtons(l,e.buttonWrapper)})),isArray(n[a].items)&&s.call(t,e,n[a])})},addSubmenu:function(e,t){var i,a=this,o=e.submenuArrow,s=e.buttonWrapper,r=getStyle(s,"width"),n=this.wrapper,l=this.listWrapper,c=this.toolbar.childNodes,h=0;this.submenu=i=createElement(UL,{className:PREFIX+"submenu-wrapper"},null,s),this.addSubmenuItems(s,t),a.eventsToUnbind.push(addEvent(o,"click",function(e){e.stopPropagation(),a.eraseActiveButtons(c,s),s.className.indexOf(PREFIX+"current")>=0?(l.style.width=l.startWidth+"px",s.classList.remove(PREFIX+"current"),i.style.display="none"):(i.style.display="block",h=i.offsetHeight-s.offsetHeight-3,i.offsetHeight+s.offsetTop>n.offsetHeight&&s.offsetTop>h||(h=0),css(i,{top:-h+"px",left:r+3+"px"}),s.className+=" "+PREFIX+"current",l.startWidth=n.offsetWidth,l.style.width=l.startWidth+H.getStyle(l,"padding-left")+i.offsetWidth+3+"px")}))},addSubmenuItems:function(e,t){var i,a,o=this,s=this.submenu,r=this.lang,n=this.listWrapper;t.items.forEach(function(i){a=o.addButton(s,t,i,r),o.eventsToUnbind.push(addEvent(a.mainButton,"click",function(){o.switchSymbol(this,e,!0),n.style.width=n.startWidth+"px",s.style.display="none"}))}),i=s.querySelectorAll("li > ."+PREFIX+"menu-item-btn")[0],o.switchSymbol(i,!1)},eraseActiveButtons:function(e,t,i){[].forEach.call(e,function(e){e!==t&&(e.classList.remove(PREFIX+"current"),e.classList.remove(PREFIX+"active"),(i=e.querySelectorAll("."+PREFIX+"submenu-wrapper")).length>0&&(i[0].style.display="none"))})},addButton:function(e,t,i,a){var o,s,r,n=t[i],l=n.items,c=H.Toolbar.prototype.classMapping,h=n.className||"";return r=createElement(LI,{className:pick(c[i],"")+" "+h,title:a[i]||i},null,e),o=createElement(SPAN,{className:PREFIX+"menu-item-btn"},null,r),l&&l.length?(s=createElement(SPAN,{className:PREFIX+"submenu-item-arrow "+PREFIX+"arrow-right"},null,r)).style["background-image"]="url("+this.iconsURL+"arrow-bottom.svg)":o.style["background-image"]="url("+this.iconsURL+n.symbol+")",{buttonWrapper:r,mainButton:o,submenuArrow:s}},addNavigation:function(){var e=this.wrapper;this.arrowWrapper=createElement(DIV,{className:PREFIX+"arrow-wrapper"}),this.arrowUp=createElement(DIV,{className:PREFIX+"arrow-up"},null,this.arrowWrapper),this.arrowUp.style["background-image"]="url("+this.iconsURL+"arrow-right.svg)",this.arrowDown=createElement(DIV,{className:PREFIX+"arrow-down"},null,this.arrowWrapper),this.arrowDown.style["background-image"]="url("+this.iconsURL+"arrow-right.svg)",e.insertBefore(this.arrowWrapper,e.childNodes[0]),this.scrollButtons()},scrollButtons:function(){var e=0,t=this.wrapper,i=this.toolbar,a=.1*t.offsetHeight;this.eventsToUnbind.push(addEvent(this.arrowUp,"click",function(){e>0&&(e-=a,i.style["margin-top"]=-e+"px")})),this.eventsToUnbind.push(addEvent(this.arrowDown,"click",function(){t.offsetHeight+e<=i.offsetHeight+a&&(e+=a,i.style["margin-top"]=-e+"px")}))},createHTML:function(){var e,t,i,a=this.chart,o=this.options,s=a.container,r=a.options.navigation,n=r&&r.bindingsClassName;this.wrapper=i=createElement(DIV,{className:PREFIX+"stocktools-wrapper "+o.className+" "+n}),s.parentNode.insertBefore(i,s),this.toolbar=t=createElement(UL,{className:PREFIX+"stocktools-toolbar "+o.toolbarClassName}),this.listWrapper=e=createElement(DIV,{className:PREFIX+"menu-wrapper"}),i.insertBefore(e,i.childNodes[0]),e.insertBefore(t,e.childNodes[0]),this.showHideToolbar(),this.addNavigation()},showHideNavigatorion:function(){this.visible&&this.toolbar.offsetHeight>this.wrapper.offsetHeight-50?this.arrowWrapper.style.display="block":(this.toolbar.style.marginTop="0px",this.arrowWrapper.style.display="none")},showHideToolbar:function(){var e,t=this.chart,i=this.wrapper,a=this.listWrapper,o=this.submenu,s=this.visible;this.showhideBtn=e=createElement(DIV,{className:PREFIX+"toggle-toolbar "+PREFIX+"arrow-left"},null,i),e.style["background-image"]="url("+this.iconsURL+"arrow-right.svg)",s?(i.style.height="100%",e.style.top=H.getStyle(a,"padding-top")+"px",e.style.left=i.offsetWidth+H.getStyle(a,"padding-left")+"px"):(o&&(o.style.display="none"),e.style.left="0px",this.visible=s=!1,a.classList.add(PREFIX+"hide"),e.classList.toggle(PREFIX+"arrow-right"),i.style.height=e.offsetHeight+"px"),this.eventsToUnbind.push(addEvent(e,"click",function(){t.update({stockTools:{gui:{visible:!s,placed:!0}}})}))},switchSymbol:function(e,t){var i=e.parentNode,a=i.classList.value,o=i.parentNode.parentNode;o.className="",a&&o.classList.add(a.trim()),o.querySelectorAll("."+PREFIX+"menu-item-btn")[0].style["background-image"]=e.style["background-image"],t&&this.selectButton(o)},selectButton:function(e){e.className.indexOf(activeClass)>=0?e.classList.remove(activeClass):e.classList.add(activeClass)},unselectAllButtons:function(e){var t=e.parentNode.querySelectorAll("."+activeClass);[].forEach.call(t,function(t){t!==e&&t.classList.remove(activeClass)})},inIframe:function(){try{return win.self!==win.top}catch(e){return!0}},update:function(e){merge(!0,this.chart.options.stockTools,e),this.destroy(),this.chart.setStockTools(e),this.chart.navigationBindings&&this.chart.navigationBindings.update()},destroy:function(){var e=this.wrapper,t=e&&e.parentNode;this.eventsToUnbind.forEach(function(e){e()}),t&&t.removeChild(e),this.chart.isDirtyBox=!0,this.chart.redraw()},redraw:function(){this.showHideNavigatorion()},getIconsURL:function(){return this.chart.options.navigation.iconsURL||this.options.iconsURL||"https://code.highcharts.com/8.0.0/gfx/stock-icons/"},classMapping:{circle:PREFIX+"circle-annotation",rectangle:PREFIX+"rectangle-annotation",label:PREFIX+"label-annotation",segment:PREFIX+"segment",arrowSegment:PREFIX+"arrow-segment",ray:PREFIX+"ray",arrowRay:PREFIX+"arrow-ray",line:PREFIX+"infinity-line",arrowLine:PREFIX+"arrow-infinity-line",verticalLine:PREFIX+"vertical-line",horizontalLine:PREFIX+"horizontal-line",crooked3:PREFIX+"crooked3",crooked5:PREFIX+"crooked5",elliott3:PREFIX+"elliott3",elliott5:PREFIX+"elliott5",pitchfork:PREFIX+"pitchfork",fibonacci:PREFIX+"fibonacci",parallelChannel:PREFIX+"parallel-channel",measureX:PREFIX+"measure-x",measureY:PREFIX+"measure-y",measureXY:PREFIX+"measure-xy",verticalCounter:PREFIX+"vertical-counter",verticalLabel:PREFIX+"vertical-label",verticalArrow:PREFIX+"vertical-arrow",currentPriceIndicator:PREFIX+"current-price-indicator",indicators:PREFIX+"indicators",flagCirclepin:PREFIX+"flag-circlepin",flagDiamondpin:PREFIX+"flag-diamondpin",flagSquarepin:PREFIX+"flag-squarepin",flagSimplepin:PREFIX+"flag-simplepin",zoomX:PREFIX+"zoom-x",zoomY:PREFIX+"zoom-y",zoomXY:PREFIX+"zoom-xy",typeLine:PREFIX+"series-type-line",typeOHLC:PREFIX+"series-type-ohlc",typeCandlestick:PREFIX+"series-type-candlestick",fullScreen:PREFIX+"full-screen",toggleAnnotations:PREFIX+"toggle-annotations",saveChart:PREFIX+"save-chart",separator:PREFIX+"separator"}},addEvent(H.NavigationBindings,"selectButton",function(e){var t=e.button,i=PREFIX+"submenu-wrapper",a=this.chart.stockTools;a&&a.guiEnabled&&(a.unselectAllButtons(e.button),t.parentNode.className.indexOf(i)>=0&&(t=t.parentNode.parentNode),a.selectButton(t))}),addEvent(H.NavigationBindings,"deselectButton",function(e){var t=e.button,i=PREFIX+"submenu-wrapper",a=this.chart.stockTools;a&&a.guiEnabled&&(t.parentNode.className.indexOf(i)>=0&&(t=t.parentNode.parentNode),a.selectButton(t))});