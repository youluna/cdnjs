"use strict";import H from"./Globals.js";import U from"./Utilities.js";var defined=U.defined,erase=U.erase,extend=U.extend,isArray=U.isArray,isNumber=U.isNumber,isObject=U.isObject,isString=U.isString,objectEach=U.objectEach,pick=U.pick,relativeLength=U.relativeLength,setAnimation=U.setAnimation,splat=U.splat;import"./Axis.js";import"./Chart.js";import"./Point.js";import"./Series.js";var addEvent=H.addEvent,animate=H.animate,Axis=H.Axis,Chart=H.Chart,createElement=H.createElement,css=H.css,fireEvent=H.fireEvent,merge=H.merge,Point=H.Point,Series=H.Series,seriesTypes=H.seriesTypes;H.cleanRecursively=function(t,e){var i={};return objectEach(t,function(s,a){var o;isObject(t[a],!0)&&!t.nodeType&&e[a]?(o=H.cleanRecursively(t[a],e[a]),Object.keys(o).length&&(i[a]=o)):(isObject(t[a])||t[a]!==e[a])&&(i[a]=t[a])}),i},extend(Chart.prototype,{addSeries:function(t,e,i){var s,a=this;return t&&(e=pick(e,!0),fireEvent(a,"addSeries",{options:t},function(){s=a.initSeries(t),a.isDirtyLegend=!0,a.linkSeries(),s.enabledDataSorting&&s.setData(t.data,!1),fireEvent(a,"afterAddSeries",{series:s}),e&&a.redraw(i)})),s},addAxis:function(t,e,i,s){return this.createAxis(e?"xAxis":"yAxis",{axis:t,redraw:i,animation:s})},addColorAxis:function(t,e,i){return this.createAxis("colorAxis",{axis:t,redraw:e,animation:i})},createAxis:function(t,e){var i,s=this.options,a="colorAxis"===t,o=e.axis,n=e.redraw,r=e.animation,p=merge(o,{index:this[t].length,isX:"xAxis"===t});return i=a?new H.ColorAxis(this,p):new Axis(this,p),s[t]=splat(s[t]||{}),s[t].push(p),a&&(this.isDirtyLegend=!0,this.axes.forEach(function(t){t.series=[]}),this.series.forEach(function(t){t.bindAxes(),t.isDirtyData=!0})),pick(n,!0)&&this.redraw(r),i},showLoading:function(t){var e=this,i=e.options,s=e.loadingDiv,a=i.loading,o=function(){s&&css(s,{left:e.plotLeft+"px",top:e.plotTop+"px",width:e.plotWidth+"px",height:e.plotHeight+"px"})};s||(e.loadingDiv=s=createElement("div",{className:"highcharts-loading highcharts-loading-hidden"},null,e.container),e.loadingSpan=createElement("span",{className:"highcharts-loading-inner"},null,s),addEvent(e,"redraw",o)),s.className="highcharts-loading",e.loadingSpan.innerHTML=pick(t,i.lang.loading,""),e.styledMode||(css(s,extend(a.style,{zIndex:10})),css(e.loadingSpan,a.labelStyle),e.loadingShown||(css(s,{opacity:0,display:""}),animate(s,{opacity:a.style.opacity||.5},{duration:a.showDuration||0}))),e.loadingShown=!0,o()},hideLoading:function(){var t=this.options,e=this.loadingDiv;e&&(e.className="highcharts-loading highcharts-loading-hidden",this.styledMode||animate(e,{opacity:0},{duration:t.loading.hideDuration||100,complete:function(){css(e,{display:"none"})}})),this.loadingShown=!1},propsRequireDirtyBox:["backgroundColor","borderColor","borderWidth","borderRadius","plotBackgroundColor","plotBackgroundImage","plotBorderColor","plotBorderWidth","plotShadow","shadow"],propsRequireReflow:["margin","marginTop","marginRight","marginBottom","marginLeft","spacing","spacingTop","spacingRight","spacingBottom","spacingLeft"],propsRequireUpdateSeries:["chart.inverted","chart.polar","chart.ignoreHiddenSeries","chart.type","colors","plotOptions","time","tooltip"],collectionsWithUpdate:["xAxis","yAxis","zAxis","series"],update:function(t,e,i,s){var a,o,n,r,p,d,c=this,l={credits:"addCredits",title:"setTitle",subtitle:"setSubtitle",caption:"setCaption"},h=t.isResponsiveOptions,u=[];fireEvent(c,"update",{options:t}),h||c.setResponsive(!1,!0),t=H.cleanRecursively(t,c.options),merge(!0,c.userOptions,t),(a=t.chart)&&(merge(!0,c.options.chart,a),"className"in a&&c.setClassName(a.className),"reflow"in a&&c.setReflow(a.reflow),("inverted"in a||"polar"in a||"type"in a)&&(c.propFromSeries(),o=!0),"alignTicks"in a&&(o=!0),objectEach(a,function(t,e){-1!==c.propsRequireUpdateSeries.indexOf("chart."+e)&&(n=!0),-1!==c.propsRequireDirtyBox.indexOf(e)&&(c.isDirtyBox=!0),h||-1===c.propsRequireReflow.indexOf(e)||(d=!0)}),!c.styledMode&&"style"in a&&c.renderer.setStyle(a.style)),!c.styledMode&&t.colors&&(this.options.colors=t.colors),t.plotOptions&&merge(!0,this.options.plotOptions,t.plotOptions),t.time&&this.time===H.time&&(this.time=new H.Time(t.time)),objectEach(t,function(t,e){c[e]&&"function"==typeof c[e].update?c[e].update(t,!1):"function"==typeof c[l[e]]&&c[l[e]](t),"chart"!==e&&-1!==c.propsRequireUpdateSeries.indexOf(e)&&(n=!0)}),this.collectionsWithUpdate.forEach(function(e){var s;t[e]&&("series"===e&&(s=[],c[e].forEach(function(t,e){t.options.isInternal||s.push(pick(t.options.index,e))})),splat(t[e]).forEach(function(t,a){var o=defined(t.id)&&c.get(t.id)||c[e][s?s[a]:a];o&&o.coll===e&&(o.update(t,!1),i&&(o.touched=!0)),!o&&i&&c.collectionsWithInit[e]&&(c.collectionsWithInit[e][0].apply(c,[t].concat(c.collectionsWithInit[e][1]||[]).concat([!1])).touched=!0)}),i&&c[e].forEach(function(t){t.touched||t.options.isInternal?delete t.touched:u.push(t)}))}),u.forEach(function(t){t.remove&&t.remove(!1)}),o&&c.axes.forEach(function(t){t.update({},!1)}),n&&c.getSeriesOrderByLinks().forEach(function(t){t.chart&&t.update({},!1)},this),t.loading&&merge(!0,c.options.loading,t.loading),r=a&&a.width,p=a&&a.height,isString(p)&&(p=relativeLength(p,r||c.chartWidth)),d||isNumber(r)&&r!==c.chartWidth||isNumber(p)&&p!==c.chartHeight?c.setSize(r,p,s):pick(e,!0)&&c.redraw(s),fireEvent(c,"afterUpdate",{options:t,redraw:e,animation:s})},setSubtitle:function(t,e){this.applyDescription("subtitle",t),this.layOutTitles(e)},setCaption:function(t,e){this.applyDescription("caption",t),this.layOutTitles(e)}}),Chart.prototype.collectionsWithInit={xAxis:[Chart.prototype.addAxis,[!0]],yAxis:[Chart.prototype.addAxis,[!1]],series:[Chart.prototype.addSeries]},extend(Point.prototype,{update:function(t,e,i,s){var a,o=this,n=o.series,r=o.graphic,p=n.chart,d=n.options;function c(){o.applyOptions(t),null===o.y&&r&&(o.graphic=r.destroy()),isObject(t,!0)&&(r&&r.element&&t&&t.marker&&void 0!==t.marker.symbol&&(o.graphic=r.destroy()),t&&t.dataLabels&&o.dataLabel&&(o.dataLabel=o.dataLabel.destroy()),o.connector&&(o.connector=o.connector.destroy())),a=o.index,n.updateParallelArrays(o,a),d.data[a]=isObject(d.data[a],!0)||isObject(t,!0)?o.options:pick(t,d.data[a]),n.isDirty=n.isDirtyData=!0,!n.fixedBox&&n.hasCartesianSeries&&(p.isDirtyBox=!0),"point"===d.legendType&&(p.isDirtyLegend=!0),e&&p.redraw(i)}e=pick(e,!0),!1===s?c():o.firePointEvent("update",{options:t},c)},remove:function(t,e){this.series.removePoint(this.series.data.indexOf(this),t,e)}}),extend(Series.prototype,{addPoint:function(t,e,i,s,a){var o,n,r,p,d=this.options,c=this.data,l=this.chart,h=this.xAxis,u=h&&h.hasNames&&h.names,f=d.data,y=this.xData;if(e=pick(e,!0),o={series:this},this.pointClass.prototype.applyOptions.apply(o,[t]),p=o.x,r=y.length,this.requireSorting&&p<y[r-1])for(n=!0;r&&y[r-1]>p;)r--;this.updateParallelArrays(o,"splice",r,0,0),this.updateParallelArrays(o,r),u&&o.name&&(u[p]=o.name),f.splice(r,0,t),n&&(this.data.splice(r,0,null),this.processData()),"point"===d.legendType&&this.generatePoints(),i&&(c[0]&&c[0].remove?c[0].remove(!1):(c.shift(),this.updateParallelArrays(o,"shift"),f.shift())),!1!==a&&fireEvent(this,"addPoint",{point:o}),this.isDirty=!0,this.isDirtyData=!0,e&&l.redraw(s)},removePoint:function(t,e,i){var s=this,a=s.data,o=a[t],n=s.points,r=s.chart,p=function(){n&&n.length===a.length&&n.splice(t,1),a.splice(t,1),s.options.data.splice(t,1),s.updateParallelArrays(o||{series:s},"splice",t,1),o&&o.destroy(),s.isDirty=!0,s.isDirtyData=!0,e&&r.redraw()};setAnimation(i,r),e=pick(e,!0),o?o.firePointEvent("remove",null,p):p()},remove:function(t,e,i,s){var a=this,o=a.chart;function n(){a.destroy(s),a.remove=null,o.isDirtyLegend=o.isDirtyBox=!0,o.linkSeries(),pick(t,!0)&&o.redraw(e)}!1!==i?fireEvent(a,"remove",null,n):n()},update:function(t,e){t=H.cleanRecursively(t,this.userOptions),fireEvent(this,"update",{options:t});var i,s,a=this,o=a.chart,n=a.userOptions,r=a.initialType||a.type,p=t.type||n.type||o.options.chart.type,d=!(this.hasDerivedData||t.dataGrouping||p&&p!==this.type||void 0!==t.pointStart||t.pointInterval||t.pointIntervalUnit||t.keys),c=seriesTypes[r].prototype,l=["group","markerGroup","dataLabelsGroup","transformGroup"],h=["eventOptions","navigatorSeries","baseSeries"],u=a.finishedAnimating&&{animation:!1},f={};for(s in d&&(h.push("data","isDirtyData","points","processedXData","processedYData","xIncrement","_hasPointMarkers","_hasPointLabels","mapMap","mapData","minY","maxY","minX","maxX"),!1!==t.visible&&h.push("area","graph"),a.parallelArrays.forEach(function(t){h.push(t+"Data")}),t.data&&(t.dataSorting&&extend(a.options.dataSorting,t.dataSorting),this.setData(t.data,!1))),t=merge(n,u,{index:void 0===n.index?a.index:n.index,pointStart:pick(n.pointStart,a.xData[0])},!d&&{data:a.options.data},t),d&&t.data&&(t.data=a.options.data),(h=l.concat(h)).forEach(function(t){h[t]=a[t],delete a[t]}),a.remove(!1,null,!1,!0),c)a[s]=void 0;if(seriesTypes[p||r]?extend(a,seriesTypes[p||r].prototype):H.error(17,!0,o,{missingModuleFor:p||r}),h.forEach(function(t){a[t]=h[t]}),a.init(o,t),d&&this.points){if(!1===(i=a.options).visible)f.graphic=1,f.dataLabel=1;else if(!a._hasPointLabels){var y=i.marker,g=i.dataLabels;y&&(!1===y.enabled||"symbol"in y)&&(f.graphic=1),g&&!1===g.enabled&&(f.dataLabel=1)}this.points.forEach(function(t){t&&t.series&&(t.resolveColor(),Object.keys(f).length&&t.destroyElements(f),!1===i.showInLegend&&t.legendItem&&o.legend.destroyItem(t))},this)}t.zIndex!==n.zIndex&&l.forEach(function(e){a[e]&&a[e].attr({zIndex:t.zIndex})}),a.initialType=r,o.linkSeries(),fireEvent(this,"afterUpdate"),pick(e,!0)&&o.redraw(!!d&&void 0)},setName:function(t){this.name=this.options.name=this.userOptions.name=t,this.chart.isDirtyLegend=!0}}),extend(Axis.prototype,{update:function(t,e){var i=this.chart,s=t&&t.events||{};t=merge(this.userOptions,t),i.options[this.coll].indexOf&&(i.options[this.coll][i.options[this.coll].indexOf(this.userOptions)]=t),objectEach(i.options[this.coll].events,function(t,e){void 0===s[e]&&(s[e]=void 0)}),this.destroy(!0),this.init(i,extend(t,{events:s})),i.isDirtyBox=!0,pick(e,!0)&&i.redraw()},remove:function(t){for(var e=this.chart,i=this.coll,s=this.series,a=s.length;a--;)s[a]&&s[a].remove(!1);erase(e.axes,this),erase(e[i],this),isArray(e.options[i])?e.options[i].splice(this.options.index,1):delete e.options[i],e[i].forEach(function(t,e){t.options.index=t.userOptions.index=e}),this.destroy(),e.isDirtyBox=!0,pick(t,!0)&&e.redraw()},setTitle:function(t,e){this.update({title:t},e)},setCategories:function(t,e){this.update({categories:t},e)}});