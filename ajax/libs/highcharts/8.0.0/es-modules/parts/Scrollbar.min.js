"use strict";import H from"./Globals.js";import U from"./Utilities.js";var correctFloat=U.correctFloat,defined=U.defined,destroyObjectProperties=U.destroyObjectProperties,pick=U.pick;import"./Axis.js";import"./Options.js";var swapXY,addEvent=H.addEvent,Axis=H.Axis,defaultOptions=H.defaultOptions,fireEvent=H.fireEvent,hasTouch=H.hasTouch,isTouchDevice=H.isTouchDevice,merge=H.merge,removeEvent=H.removeEvent,defaultScrollbarOptions={height:isTouchDevice?20:14,barBorderRadius:0,buttonBorderRadius:0,liveRedraw:void 0,margin:10,minWidth:6,step:.2,zIndex:3,barBackgroundColor:"#cccccc",barBorderWidth:1,barBorderColor:"#cccccc",buttonArrowColor:"#333333",buttonBackgroundColor:"#e6e6e6",buttonBorderColor:"#cccccc",buttonBorderWidth:1,rifleColor:"#333333",trackBackgroundColor:"#f2f2f2",trackBorderColor:"#f2f2f2",trackBorderWidth:1};function Scrollbar(t,r,i){this.init(t,r,i)}defaultOptions.scrollbar=merge(!0,defaultScrollbarOptions,defaultOptions.scrollbar),H.swapXY=swapXY=function(t,r){var i,o,s=t.length;if(r)for(i=0;i<s;i+=3)o=t[i+1],t[i+1]=t[i+2],t[i+2]=o;return t},Scrollbar.prototype={init:function(t,r,i){this.scrollbarButtons=[],this.renderer=t,this.userOptions=r,this.options=merge(defaultScrollbarOptions,r),this.chart=i,this.size=pick(this.options.size,this.options.height),r.enabled&&(this.render(),this.initEvents(),this.addEvents())},render:function(){var t,r=this.renderer,i=this.options,o=this.size,s=this.chart.styledMode;this.group=t=r.g("scrollbar").attr({zIndex:i.zIndex,translateY:-99999}).add(),this.track=r.rect().addClass("highcharts-scrollbar-track").attr({x:0,r:i.trackBorderRadius||0,height:o,width:o}).add(t),s||this.track.attr({fill:i.trackBackgroundColor,stroke:i.trackBorderColor,"stroke-width":i.trackBorderWidth}),this.trackBorderWidth=this.track.strokeWidth(),this.track.attr({y:-this.trackBorderWidth%2/2}),this.scrollbarGroup=r.g().add(t),this.scrollbar=r.rect().addClass("highcharts-scrollbar-thumb").attr({height:o,width:o,r:i.barBorderRadius||0}).add(this.scrollbarGroup),this.scrollbarRifles=r.path(swapXY(["M",-3,o/4,"L",-3,2*o/3,"M",0,o/4,"L",0,2*o/3,"M",3,o/4,"L",3,2*o/3],i.vertical)).addClass("highcharts-scrollbar-rifles").add(this.scrollbarGroup),s||(this.scrollbar.attr({fill:i.barBackgroundColor,stroke:i.barBorderColor,"stroke-width":i.barBorderWidth}),this.scrollbarRifles.attr({stroke:i.rifleColor,"stroke-width":1})),this.scrollbarStrokeWidth=this.scrollbar.strokeWidth(),this.scrollbarGroup.translate(-this.scrollbarStrokeWidth%2/2,-this.scrollbarStrokeWidth%2/2),this.drawScrollbarButton(0),this.drawScrollbarButton(1)},position:function(t,r,i,o){var s=this.options.vertical,e=o,a=0,h=this.rendered?"animate":"attr";this.x=t,this.y=r+this.trackBorderWidth,this.width=i,this.height=o,this.xOffset=e,this.yOffset=a,s?(this.width=this.yOffset=i=a=this.size,this.xOffset=e=0,this.barWidth=o-2*i,this.x=t+=this.options.margin):(this.height=this.xOffset=o=e=this.size,this.barWidth=i-2*o,this.y=this.y+this.options.margin),this.group[h]({translateX:t,translateY:this.y}),this.track[h]({width:i,height:o}),this.scrollbarButtons[1][h]({translateX:s?0:i-e,translateY:s?o-a:0})},drawScrollbarButton:function(t){var r,i,o=this.renderer,s=this.scrollbarButtons,e=this.options,a=this.size;r=o.g().add(this.group),s.push(r),i=o.rect().addClass("highcharts-scrollbar-button").add(r),this.chart.styledMode||i.attr({stroke:e.buttonBorderColor,"stroke-width":e.buttonBorderWidth,fill:e.buttonBackgroundColor}),i.attr(i.crisp({x:-.5,y:-.5,width:a+1,height:a+1,r:e.buttonBorderRadius},i.strokeWidth())),i=o.path(swapXY(["M",a/2+(t?-1:1),a/2-3,"L",a/2+(t?-1:1),a/2+3,"L",a/2+(t?2:-2),a/2],e.vertical)).addClass("highcharts-scrollbar-arrow").add(s[t]),this.chart.styledMode||i.attr({fill:e.buttonArrowColor})},setRange:function(t,r){var i,o,s,e,a,h=this.options,n=h.vertical,l=h.minWidth,c=this.barWidth,d=!this.rendered||this.hasDragged||this.chart.navigator&&this.chart.navigator.hasDragged?"attr":"animate";defined(c)&&(t=Math.max(t,0),i=Math.ceil(c*t),o=c*Math.min(r,1),this.calculatedWidth=e=correctFloat(o-i),e<l&&(i=(c-l+e)*t,e=l),s=Math.floor(i+this.xOffset+this.yOffset),a=e/2-.5,this.from=t,this.to=r,n?(this.scrollbarGroup[d]({translateY:s}),this.scrollbar[d]({height:e}),this.scrollbarRifles[d]({translateY:a}),this.scrollbarTop=s,this.scrollbarLeft=0):(this.scrollbarGroup[d]({translateX:s}),this.scrollbar[d]({width:e}),this.scrollbarRifles[d]({translateX:a}),this.scrollbarLeft=s,this.scrollbarTop=0),e<=12?this.scrollbarRifles.hide():this.scrollbarRifles.show(!0),!1===h.showFull&&(t<=0&&r>=1?this.group.hide():this.group.show()),this.rendered=!0)},initEvents:function(){var t=this;t.mouseMoveHandler=function(r){var i,o=t.chart.pointer.normalize(r),s=t.options.vertical?"chartY":"chartX",e=t.initPositions;!t.grabbedCenter||r.touches&&0===r.touches[0][s]||(i=t.cursorToScrollbarPosition(o)[s]-t[s],t.hasDragged=!0,t.updatePosition(e[0]+i,e[1]+i),t.hasDragged&&fireEvent(t,"changed",{from:t.from,to:t.to,trigger:"scrollbar",DOMType:r.type,DOMEvent:r}))},t.mouseUpHandler=function(r){t.hasDragged&&fireEvent(t,"changed",{from:t.from,to:t.to,trigger:"scrollbar",DOMType:r.type,DOMEvent:r}),t.grabbedCenter=t.hasDragged=t.chartX=t.chartY=null},t.mouseDownHandler=function(r){var i=t.chart.pointer.normalize(r),o=t.cursorToScrollbarPosition(i);t.chartX=o.chartX,t.chartY=o.chartY,t.initPositions=[t.from,t.to],t.grabbedCenter=!0},t.buttonToMinClick=function(r){var i=correctFloat(t.to-t.from)*t.options.step;t.updatePosition(correctFloat(t.from-i),correctFloat(t.to-i)),fireEvent(t,"changed",{from:t.from,to:t.to,trigger:"scrollbar",DOMEvent:r})},t.buttonToMaxClick=function(r){var i=(t.to-t.from)*t.options.step;t.updatePosition(t.from+i,t.to+i),fireEvent(t,"changed",{from:t.from,to:t.to,trigger:"scrollbar",DOMEvent:r})},t.trackClick=function(r){var i=t.chart.pointer.normalize(r),o=t.to-t.from,s=t.y+t.scrollbarTop,e=t.x+t.scrollbarLeft;t.options.vertical&&i.chartY>s||!t.options.vertical&&i.chartX>e?t.updatePosition(t.from+o,t.to+o):t.updatePosition(t.from-o,t.to-o),fireEvent(t,"changed",{from:t.from,to:t.to,trigger:"scrollbar",DOMEvent:r})}},cursorToScrollbarPosition:function(t){var r=this.options,i=r.minWidth>this.calculatedWidth?r.minWidth:0;return{chartX:(t.chartX-this.x-this.xOffset)/(this.barWidth-i),chartY:(t.chartY-this.y-this.yOffset)/(this.barWidth-i)}},updatePosition:function(t,r){r>1&&(t=correctFloat(1-correctFloat(r-t)),r=1),t<0&&(r=correctFloat(r-t),t=0),this.from=t,this.to=r},update:function(t){this.destroy(),this.init(this.chart.renderer,merge(!0,this.options,t),this.chart)},addEvents:function(){var t,r=this.options.inverted?[1,0]:[0,1],i=this.scrollbarButtons,o=this.scrollbarGroup.element,s=this.track.element,e=this.mouseDownHandler,a=this.mouseMoveHandler,h=this.mouseUpHandler;t=[[i[r[0]].element,"click",this.buttonToMinClick],[i[r[1]].element,"click",this.buttonToMaxClick],[s,"click",this.trackClick],[o,"mousedown",e],[o.ownerDocument,"mousemove",a],[o.ownerDocument,"mouseup",h]],hasTouch&&t.push([o,"touchstart",e],[o.ownerDocument,"touchmove",a],[o.ownerDocument,"touchend",h]),t.forEach(function(t){addEvent.apply(null,t)}),this._events=t},removeEvents:function(){this._events.forEach(function(t){removeEvent.apply(null,t)}),this._events.length=0},destroy:function(){var t=this.chart.scroller;this.removeEvents(),["track","scrollbarRifles","scrollbar","scrollbarGroup","group"].forEach(function(t){this[t]&&this[t].destroy&&(this[t]=this[t].destroy())},this),t&&this===t.scrollbar&&(t.scrollbar=null,destroyObjectProperties(t.scrollbarButtons))}},H.Scrollbar||(addEvent(Axis,"afterInit",function(){var t=this;t.options&&t.options.scrollbar&&t.options.scrollbar.enabled&&(t.options.scrollbar.vertical=!t.horiz,t.options.startOnTick=t.options.endOnTick=!1,t.scrollbar=new Scrollbar(t.chart.renderer,t.options.scrollbar,t.chart),addEvent(t.scrollbar,"changed",function(r){var i,o,s=Math.min(pick(t.options.min,t.min),t.min,t.dataMin),e=Math.max(pick(t.options.max,t.max),t.max,t.dataMax)-s;t.horiz&&!t.reversed||!t.horiz&&t.reversed?(i=s+e*this.to,o=s+e*this.from):(i=s+e*(1-this.from),o=s+e*(1-this.to)),pick(this.options.liveRedraw,H.svg&&!H.isTouchDevice&&!this.chart.isBoosting)||"mouseup"===r.DOMType||!defined(r.DOMType)?t.setExtremes(o,i,!0,"mousemove"!==r.DOMType,r):this.setRange(this.from,this.to)}))}),addEvent(Axis,"afterRender",function(){var t,r,i,o=Math.min(pick(this.options.min,this.min),this.min,pick(this.dataMin,this.min)),s=Math.max(pick(this.options.max,this.max),this.max,pick(this.dataMax,this.max)),e=this.scrollbar,a=this.axisTitleMargin+(this.titleOffset||0),h=this.chart.scrollbarsOffsets,n=this.options.margin||0;e&&(this.horiz?(this.opposite||(h[1]+=a),e.position(this.left,this.top+this.height+2+h[1]-(this.opposite?n:0),this.width,this.height),this.opposite||(h[1]+=n),t=1):(this.opposite&&(h[0]+=a),e.position(this.left+this.width+2+h[0]-(this.opposite?0:n),this.top,this.width,this.height),this.opposite&&(h[0]+=n),t=0),h[t]+=e.size+e.options.margin,isNaN(o)||isNaN(s)||!defined(this.min)||!defined(this.max)||this.min===this.max?e.setRange(0,1):(r=(this.min-o)/(s-o),i=(this.max-o)/(s-o),this.horiz&&!this.reversed||!this.horiz&&this.reversed?e.setRange(r,i):e.setRange(1-i,1-r)))}),addEvent(Axis,"afterGetOffset",function(){var t=this.horiz?2:1,r=this.scrollbar;r&&(this.chart.scrollbarsOffsets=[0,0],this.chart.axisOffset[t]+=r.size+r.options.margin)}),H.Scrollbar=Scrollbar);