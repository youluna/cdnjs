import H from"../parts/Globals.js";import U from"../parts/Utilities.js";var defined=U.defined,extend=U.extend,pick=U.pick,Point=H.Point;H.NodesMixin={createNode:function(o){function t(o,t){return H.find(o,function(o){return o.id===t})}var e,i=t(this.nodes,o),n=this.pointClass;return i||(e=this.options.nodes&&t(this.options.nodes,o),(i=(new n).init(this,extend({className:"highcharts-node",isNode:!0,id:o,y:1},e))).linksTo=[],i.linksFrom=[],i.formatPrefix="node",i.name=i.name||i.options.id,i.mass=pick(i.options.mass,i.options.marker&&i.options.marker.radius,this.options.marker&&this.options.marker.radius,4),i.getSum=function(){var o=0,t=0;return i.linksTo.forEach(function(t){o+=t.weight}),i.linksFrom.forEach(function(o){t+=o.weight}),Math.max(o,t)},i.offset=function(o,t){for(var e=0,n=0;n<i[t].length;n++){if(i[t][n]===o)return e;e+=i[t][n].weight}},i.hasShape=function(){var o=0;return i.linksTo.forEach(function(t){t.outgoing&&o++}),!i.linksTo.length||o!==i.linksTo.length},this.nodes.push(i)),i},generatePoints:function(){var o=this.chart,t={};H.Series.prototype.generatePoints.call(this),this.nodes||(this.nodes=[]),this.colorCounter=0,this.nodes.forEach(function(o){o.linksFrom.length=0,o.linksTo.length=0,o.level=o.options.level}),this.points.forEach(function(e){defined(e.from)&&(t[e.from]||(t[e.from]=this.createNode(e.from)),t[e.from].linksFrom.push(e),e.fromNode=t[e.from],o.styledMode?e.colorIndex=pick(e.options.colorIndex,t[e.from].colorIndex):e.color=e.options.color||t[e.from].color),defined(e.to)&&(t[e.to]||(t[e.to]=this.createNode(e.to)),t[e.to].linksTo.push(e),e.toNode=t[e.to]),e.name=e.name||e.id},this),this.nodeLookup=t},setData:function(){this.nodes&&(this.nodes.forEach(function(o){o.destroy()}),this.nodes.length=0),H.Series.prototype.setData.apply(this,arguments)},destroy:function(){return this.data=[].concat(this.points||[],this.nodes),H.Series.prototype.destroy.apply(this,arguments)},setNodeState:function(o){var t=arguments,e=this.isNode?this.linksTo.concat(this.linksFrom):[this.fromNode,this.toNode];"select"!==o&&e.forEach(function(o){o.series&&(Point.prototype.setState.apply(o,t),o.isNode||(o.fromNode.graphic&&Point.prototype.setState.apply(o.fromNode,t),o.toNode.graphic&&Point.prototype.setState.apply(o.toNode,t)))}),Point.prototype.setState.apply(this,t)}};