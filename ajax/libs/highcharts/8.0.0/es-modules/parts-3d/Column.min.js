"use strict";import H from"../parts/Globals.js";import U from"../parts/Utilities.js";var pick=U.pick,wrap=U.wrap;import"../parts/Series.js";var addEvent=H.addEvent,perspective=H.perspective,Series=H.Series,seriesTypes=H.seriesTypes,svg=H.svg;function pointAttribs(t){var e=t.apply(this,[].slice.call(arguments,1));return this.chart.is3d&&this.chart.is3d()&&(e.stroke=this.options.edgeColor||e.fill,e["stroke-width"]=pick(this.options.edgeWidth,1)),e}function setState(t,e,s){var i=this.chart.is3d&&this.chart.is3d();i&&(this.options.inactiveOtherPoints=!0),t.call(this,e,s),i&&(this.options.inactiveOtherPoints=!1)}function hasNewShapeType(t){for(var e=[],s=1;s<arguments.length;s++)e[s-1]=arguments[s];return this.series.chart.is3d()?this.graphic&&"g"!==this.graphic.element.nodeName:t.apply(this,e)}wrap(seriesTypes.column.prototype,"translate",function(t){t.apply(this,[].slice.call(arguments,1)),this.chart.is3d()&&this.translate3dShapes()}),wrap(H.Series.prototype,"alignDataLabel",function(t){arguments[3].outside3dPlot=arguments[1].outside3dPlot,t.apply(this,[].slice.call(arguments,1))}),wrap(H.Series.prototype,"justifyDataLabel",function(t){return!arguments[2].outside3dPlot&&t.apply(this,[].slice.call(arguments,1))}),seriesTypes.column.prototype.translate3dPoints=function(){},seriesTypes.column.prototype.translate3dShapes=function(){var t=this,e=t.chart,s=t.options,i=s.depth||25,r=(s.stacking?s.stack||0:t.index)*(i+(s.groupZPadding||1)),p=t.borderWidth%2?.5:0;e.inverted&&!t.yAxis.reversed&&(p*=-1),!1!==s.grouping&&(r=0),r+=s.groupZPadding||1,t.data.forEach(function(s){if(s.outside3dPlot=null,null!==s.y){var a,o=s.shapeArgs,n=s.tooltipPos;[["x","width"],["y","height"]].forEach(function(e){if((a=o[e[0]]-p)<0&&(o[e[1]]+=o[e[0]]+p,o[e[0]]=-p,a=0),a+o[e[1]]>t[e[0]+"Axis"].len&&0!==o[e[1]]&&(o[e[1]]=t[e[0]+"Axis"].len-o[e[0]]),0!==o[e[1]]&&(o[e[0]]>=t[e[0]+"Axis"].len||o[e[0]]+o[e[1]]<=p)){for(var i in o)o[i]=0;s.outside3dPlot=!0}}),"rect"===s.shapeType&&(s.shapeType="cuboid"),o.z=r,o.depth=i,o.insidePlotArea=!0,n=perspective([{x:n[0],y:n[1],z:r}],e,!0)[0],s.tooltipPos=[n.x,n.y]}}),t.z=r},wrap(seriesTypes.column.prototype,"animate",function(t){if(this.chart.is3d()){var e=arguments[1],s=this.yAxis,i=this,r=this.yAxis.reversed;svg&&(e?i.data.forEach(function(t){null!==t.y&&(t.height=t.shapeArgs.height,t.shapey=t.shapeArgs.y,t.shapeArgs.height=1,r||(t.stackY?t.shapeArgs.y=t.plotY+s.translate(t.stackY):t.shapeArgs.y=t.plotY+(t.negative?-t.height:t.height)))}):(i.data.forEach(function(t){null!==t.y&&(t.shapeArgs.height=t.height,t.shapeArgs.y=t.shapey,t.graphic&&t.graphic.animate(t.shapeArgs,i.options.animation))}),this.drawDataLabels(),i.animate=null))}else t.apply(this,[].slice.call(arguments,1))}),wrap(seriesTypes.column.prototype,"plotGroup",function(t,e,s,i,r,p){return"dataLabelsGroup"!==e&&this.chart.is3d()&&(this[e]&&delete this[e],p&&(this.chart.columnGroup||(this.chart.columnGroup=this.chart.renderer.g("columnGroup").add(p)),this[e]=this.chart.columnGroup,this.chart.columnGroup.attr(this.getPlotBox()),this[e].survive=!0,"group"!==e&&"markerGroup"!==e||(arguments[3]="visible"))),t.apply(this,Array.prototype.slice.call(arguments,1))}),wrap(seriesTypes.column.prototype,"setVisible",function(t,e){var s,i=this;i.chart.is3d()&&i.data.forEach(function(t){t.visible=t.options.visible=e=void 0===e?!pick(i.visible,t.visible):e,s=e?"visible":"hidden",i.options.data[i.data.indexOf(t)]=t.options,t.graphic&&t.graphic.attr({visibility:s})}),t.apply(this,Array.prototype.slice.call(arguments,1))}),seriesTypes.column.prototype.handle3dGrouping=!0,addEvent(Series,"afterInit",function(){if(this.chart.is3d()&&this.handle3dGrouping){var t=this.options,e=t.grouping,s=t.stacking,i=pick(this.yAxis.options.reversedStacks,!0),r=0;if(void 0===e||e){var p,a=this.chart.retrieveStacks(s),o=t.stack||0;for(p=0;p<a[o].series.length&&a[o].series[p]!==this;p++);r=10*(a.totalStacks-a[o].position)+(i?p:-p),this.xAxis.reversed||(r=10*a.totalStacks-r)}t.zIndex=r}}),wrap(seriesTypes.column.prototype,"pointAttribs",pointAttribs),wrap(seriesTypes.column.prototype,"setState",setState),wrap(seriesTypes.column.prototype.pointClass.prototype,"hasNewShapeType",hasNewShapeType),seriesTypes.columnrange&&(wrap(seriesTypes.columnrange.prototype,"pointAttribs",pointAttribs),wrap(seriesTypes.columnrange.prototype,"setState",setState),wrap(seriesTypes.columnrange.prototype.pointClass.prototype,"hasNewShapeType",hasNewShapeType),seriesTypes.columnrange.prototype.plotGroup=seriesTypes.column.prototype.plotGroup,seriesTypes.columnrange.prototype.setVisible=seriesTypes.column.prototype.setVisible),wrap(Series.prototype,"alignDataLabel",function(t){if(this.chart.is3d()&&this instanceof seriesTypes.column){var e=this.chart,s=arguments,i=s[4],r=s[1],p={x:i.x,y:i.y,z:this.z};p=perspective([p],e,!0)[0],i.x=p.x,i.y=r.outside3dPlot?-9e9:p.y}t.apply(this,[].slice.call(arguments,1))}),wrap(H.StackItem.prototype,"getStackBox",function(t,e){var s=t.apply(this,[].slice.call(arguments,1));if(e.is3d()){var i={x:s.x,y:s.y,z:0};i=H.perspective([i],e,!0)[0],s.x=i.x,s.y=i.y}return s});