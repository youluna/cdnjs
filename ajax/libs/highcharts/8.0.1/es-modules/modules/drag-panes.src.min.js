"use strict";import H from"../parts/Globals.js";import U from"../parts/Utilities.js";var addEvent=U.addEvent,clamp=U.clamp,isNumber=U.isNumber,merge=U.merge,objectEach=U.objectEach,relativeLength=U.relativeLength,wrap=U.wrap;import"../parts/Axis.js";import"../parts/Pointer.js";var hasTouch=H.hasTouch,Axis=H.Axis,Pointer=H.Pointer,resizerOptions={minLength:"10%",maxLength:"100%",resize:{controlledAxis:{next:[],prev:[]},enabled:!1,cursor:"ns-resize",lineColor:"#cccccc",lineDashStyle:"Solid",lineWidth:4,x:0,y:0}};merge(!0,Axis.prototype.defaultYAxisOptions,resizerOptions),H.AxisResizer=function(t){this.init(t)},H.AxisResizer.prototype={init:function(t,e){this.axis=t,this.options=t.options.resize,this.render(),e||this.addMouseEvents()},render:function(){var t,e=this.axis,i=e.chart,s=this.options,o=s.x,n=s.y,r=clamp(e.top+e.height+n,i.plotTop,i.plotTop+i.plotHeight),a={};i.styledMode||(a={cursor:s.cursor,stroke:s.lineColor,"stroke-width":s.lineWidth,dashstyle:s.lineDashStyle}),this.lastPos=r-n,this.controlLine||(this.controlLine=i.renderer.path().addClass("highcharts-axis-resizer")),this.controlLine.add(e.axisGroup),t=i.styledMode?this.controlLine.strokeWidth():s.lineWidth,a.d=i.renderer.crispLine(["M",e.left+o,r,"L",e.left+e.width+o,r],t),this.controlLine.attr(a)},addMouseEvents:function(){var t,e,i,s=this,o=s.controlLine.element,n=s.axis.chart.container,r=[];s.mouseMoveHandler=t=function(t){s.onMouseMove(t)},s.mouseUpHandler=e=function(t){s.onMouseUp(t)},s.mouseDownHandler=i=function(t){s.onMouseDown(t)},r.push(addEvent(n,"mousemove",t),addEvent(n.ownerDocument,"mouseup",e),addEvent(o,"mousedown",i)),hasTouch&&r.push(addEvent(n,"touchmove",t),addEvent(n.ownerDocument,"touchend",e),addEvent(o,"touchstart",i)),s.eventsToUnbind=r},onMouseMove:function(t){t.touches&&0===t.touches[0].pageX||this.grabbed&&(this.hasDragged=!0,this.updateAxes(this.axis.chart.pointer.normalize(t).chartY-this.options.y))},onMouseUp:function(t){this.hasDragged&&this.updateAxes(this.axis.chart.pointer.normalize(t).chartY-this.options.y),this.grabbed=this.hasDragged=this.axis.chart.activeResizer=null},onMouseDown:function(t){this.axis.chart.pointer.reset(!1,0),this.grabbed=this.axis.chart.activeResizer=!0},updateAxes:function(t){var e,i=this,s=i.axis.chart,o=i.options.controlledAxis,n=0===o.next.length?[s.yAxis.indexOf(i.axis)+1]:o.next,r=[i.axis].concat(o.prev),a=[],h=!1,c=s.plotTop,p=s.plotHeight,d=c+p,u=function(t){return 100*t/p+"%"},l=function(t,e,i){return Math.round(clamp(t,e,i))};t=clamp(t,c,d),(e=t-i.lastPos)*e<1||([r,n].forEach(function(o,n){o.forEach(function(o,r){var x,v,f,m,g=isNumber(o)?s.yAxis[o]:n||r?s.get(o):o,y=g&&g.options,z=0;y&&"navigator-y-axis"!==y.id&&(v=g.top,f=Math.round(relativeLength(y.minLength,p)),m=Math.round(relativeLength(y.maxLength,p)),n?(e=t-i.lastPos,x=l(g.len-e,f,m),(v=g.top+e)+x>d&&(t+=z=d-x-v,v+=z),v<c&&(v=c)+x>d&&(x=p),x===f&&(h=!0),a.push({axis:g,options:{top:u(v-c),height:u(x)}})):((x=l(t-v,f,m))===m&&(h=!0),t=v+x,a.push({axis:g,options:{height:u(x)}})))})}),h||(a.forEach(function(t){t.axis.update(t.options,!1)}),s.redraw(!1)))},destroy:function(){var t=this;delete t.axis.resizer,this.eventsToUnbind&&this.eventsToUnbind.forEach(function(t){t()}),t.controlLine.destroy(),objectEach(t,function(e,i){t[i]=null})}},Axis.prototype.keepProps.push("resizer"),addEvent(Axis,"afterRender",function(){var t,e=this.resizer,i=this.options.resize;i&&(t=!1!==i.enabled,e?t?e.init(this,!0):e.destroy():t&&(this.resizer=new H.AxisResizer(this)))}),addEvent(Axis,"destroy",function(t){!t.keepEvents&&this.resizer&&this.resizer.destroy()}),wrap(Pointer.prototype,"runPointActions",function(t){this.chart.activeResizer||t.apply(this,Array.prototype.slice.call(arguments,1))}),wrap(Pointer.prototype,"drag",function(t){this.chart.activeResizer||t.apply(this,Array.prototype.slice.call(arguments,1))});