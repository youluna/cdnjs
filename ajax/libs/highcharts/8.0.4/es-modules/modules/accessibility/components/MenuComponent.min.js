"use strict";import H from"../../../parts/Globals.js";import U from"../../../parts/Utilities.js";var extend=U.extend;import AccessibilityComponent from"../AccessibilityComponent.js";import KeyboardNavigationHandler from"../KeyboardNavigationHandler.js";import ChartUtilities from"../utils/chartUtilities.js";var unhideChartElementFromAT=ChartUtilities.unhideChartElementFromAT;import HTMLUtilities from"../utils/htmlUtilities.js";var removeElement=HTMLUtilities.removeElement,getFakeMouseEvent=HTMLUtilities.getFakeMouseEvent;function getExportMenuButtonElement(t){return t.exportSVGElements&&t.exportSVGElements[0]}function exportingShouldHaveA11y(t){var e=t.options.exporting,i=getExportMenuButtonElement(t);return!!(e&&!1!==e.enabled&&e.accessibility&&e.accessibility.enabled&&i&&i.element)}H.Chart.prototype.showExportMenu=function(){var t=getExportMenuButtonElement(this);if(t){var e=t.element;e.onclick&&e.onclick(getFakeMouseEvent("click"))}},H.Chart.prototype.hideExportMenu=function(){var t=this.exportDivElements;t&&this.exportContextMenu&&(t.forEach(function(t){"highcharts-menu-item"===t.className&&t.onmouseout&&t.onmouseout(getFakeMouseEvent("mouseout"))}),this.highlightedExportItemIx=0,this.exportContextMenu.hideMenu(),this.container.focus())},H.Chart.prototype.highlightExportItem=function(t){var e,i=this.exportDivElements&&this.exportDivElements[t],n=this.exportDivElements&&this.exportDivElements[this.highlightedExportItemIx];return!(!i||"LI"!==i.tagName||i.children&&i.children.length)&&(e=!!(this.renderTo.getElementsByTagName("g")[0]||{}).focus,i.focus&&e&&i.focus(),n&&n.onmouseout&&n.onmouseout(getFakeMouseEvent("mouseout")),i.onmouseover&&i.onmouseover(getFakeMouseEvent("mouseover")),this.highlightedExportItemIx=t,!0)},H.Chart.prototype.highlightLastExportItem=function(){var t;if(this.exportDivElements)for(t=this.exportDivElements.length;t--;)if(this.highlightExportItem(t))return!0;return!1};var MenuComponent=function(){};MenuComponent.prototype=new AccessibilityComponent,extend(MenuComponent.prototype,{init:function(){var t=this.chart,e=this;this.addEvent(t,"exportMenuShown",function(){e.onMenuShown()}),this.addEvent(t,"exportMenuHidden",function(){e.onMenuHidden()})},onMenuHidden:function(){var t=this.chart.exportContextMenu;t&&t.setAttribute("aria-hidden","true"),this.isExportMenuShown=!1,this.setExportButtonExpandedState("false")},onMenuShown:function(){var t=this.chart,e=t.exportContextMenu;e&&(this.addAccessibleContextMenuAttribs(),unhideChartElementFromAT(t,e)),this.isExportMenuShown=!0,this.setExportButtonExpandedState("true")},setExportButtonExpandedState:function(t){var e=this.exportButtonProxy;e&&e.setAttribute("aria-expanded",t)},onChartRender:function(){var t=this.chart,e=t.options.accessibility;if(removeElement(this.exportProxyGroup),exportingShouldHaveA11y(t)){this.exportProxyGroup=this.addProxyGroup("all"===e.landmarkVerbosity?{"aria-label":t.langFormat("accessibility.exporting.exportRegionLabel",{chart:t}),role:"region"}:{});var i=getExportMenuButtonElement(this.chart);this.exportButtonProxy=this.createProxyButton(i,this.exportProxyGroup,{"aria-label":t.langFormat("accessibility.exporting.menuButtonLabel",{chart:t}),"aria-expanded":"false"})}},addAccessibleContextMenuAttribs:function(){var t=this.chart,e=t.exportDivElements;if(e&&e.length){e.forEach(function(t){"LI"!==t.tagName||t.children&&t.children.length?t.setAttribute("aria-hidden","true"):t.setAttribute("tabindex",-1)});var i=e[0].parentNode;i.removeAttribute("aria-hidden"),i.setAttribute("aria-label",t.langFormat("accessibility.exporting.chartMenuLabel",{chart:t}))}},getKeyboardNavigation:function(){var t=this.keyCodes,e=this.chart,i=this;return new KeyboardNavigationHandler(e,{keyCodeMap:[[[t.left,t.up],function(){return i.onKbdPrevious(this)}],[[t.right,t.down],function(){return i.onKbdNext(this)}],[[t.enter,t.space],function(){return i.onKbdClick(this)}],[[t.esc],function(){return this.response.prev}]],validate:function(){return e.exportChart&&!1!==e.options.exporting.enabled&&!1!==e.options.exporting.accessibility.enabled},init:function(){var t=i.exportButtonProxy,n=e.exportingGroup;n&&t&&e.setFocusToElement(n,t)},terminate:function(){e.hideExportMenu()}})},onKbdPrevious:function(t){for(var e=this.chart,i=e.options.accessibility,n=t.response,o=e.highlightedExportItemIx||0;o--;)if(e.highlightExportItem(o))return n.success;return i.keyboardNavigation.wrapAround?(e.highlightLastExportItem(),n.success):n.prev},onKbdNext:function(t){for(var e=this.chart,i=e.options.accessibility,n=t.response,o=(e.highlightedExportItemIx||0)+1;o<e.exportDivElements.length;++o)if(e.highlightExportItem(o))return n.success;return i.keyboardNavigation.wrapAround?(e.highlightExportItem(0),n.success):n.next},onKbdClick:function(t){var e=this.chart,i=e.exportDivElements[e.highlightedExportItemIx],n=getExportMenuButtonElement(e).element;return this.isExportMenuShown?this.fakeClickEvent(i):(this.fakeClickEvent(n),e.highlightExportItem(0)),t.response.success}});export default MenuComponent;