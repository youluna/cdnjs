"use strict";!function(o){"object"==typeof module&&module.exports?module.exports=o.default=o:"function"==typeof define&&define.amd?define("highcharts/modules/sankey",["highcharts"],function(t){return o(t),o.Highcharts=t,o}):o("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(t){var o=t?t._modules:{};function e(t,o,e,i){t.hasOwnProperty(o)||(t[o]=i.apply(null,e))}e(o,"mixins/nodes.js",[o["parts/Globals.js"],o["parts/Point.js"],o["parts/Utilities.js"]],function(t,i,o){var n=o.defined,s=o.extend,r=o.find,a=o.pick;t.NodesMixin={createNode:function(t){function o(t,o){return r(t,function(t){return t.id===o})}var e,n=o(this.nodes,t),i=this.pointClass;return n||(e=this.options.nodes&&o(this.options.nodes,t),(n=(new i).init(this,s({className:"highcharts-node",isNode:!0,id:t,y:1},e))).linksTo=[],n.linksFrom=[],n.formatPrefix="node",n.name=n.name||n.options.id,n.mass=a(n.options.mass,n.options.marker&&n.options.marker.radius,this.options.marker&&this.options.marker.radius,4),n.getSum=function(){var o=0,e=0;return n.linksTo.forEach(function(t){o+=t.weight}),n.linksFrom.forEach(function(t){e+=t.weight}),Math.max(o,e)},n.offset=function(t,o){for(var e=0,i=0;i<n[o].length;i++){if(n[o][i]===t)return e;e+=n[o][i].weight}},n.hasShape=function(){var o=0;return n.linksTo.forEach(function(t){t.outgoing&&o++}),!n.linksTo.length||o!==n.linksTo.length},this.nodes.push(n)),n},generatePoints:function(){var o=this.chart,e={};t.Series.prototype.generatePoints.call(this),this.nodes||(this.nodes=[]),this.colorCounter=0,this.nodes.forEach(function(t){t.linksFrom.length=0,t.linksTo.length=0,t.level=t.options.level}),this.points.forEach(function(t){n(t.from)&&(e[t.from]||(e[t.from]=this.createNode(t.from)),e[t.from].linksFrom.push(t),t.fromNode=e[t.from],o.styledMode?t.colorIndex=a(t.options.colorIndex,e[t.from].colorIndex):t.color=t.options.color||e[t.from].color),n(t.to)&&(e[t.to]||(e[t.to]=this.createNode(t.to)),e[t.to].linksTo.push(t),t.toNode=e[t.to]),t.name=t.name||t.id},this),this.nodeLookup=e},setData:function(){this.nodes&&(this.nodes.forEach(function(t){t.destroy()}),this.nodes.length=0),t.Series.prototype.setData.apply(this,arguments)},destroy:function(){return this.data=[].concat(this.points||[],this.nodes),t.Series.prototype.destroy.apply(this,arguments)},setNodeState:function(t){var o=arguments,e=this.isNode?this.linksTo.concat(this.linksFrom):[this.fromNode,this.toNode];"select"!==t&&e.forEach(function(t){t&&t.series&&(i.prototype.setState.apply(t,o),t.isNode||(t.fromNode.graphic&&i.prototype.setState.apply(t.fromNode,o),t.toNode&&t.toNode.graphic&&i.prototype.setState.apply(t.toNode,o)))}),i.prototype.setState.apply(this,o)}}}),e(o,"mixins/tree-series.js",[o["parts/Color.js"],o["parts/Utilities.js"]],function(k,t){function p(t){return"boolean"==typeof t}var u=t.extend,l=t.isArray,h=t.isNumber,d=t.isObject,c=t.merge,N=t.pick;return{getColor:function(t,o){var e,i,n,s,r,a,l,h,d=o.index,c=o.mapOptionsToLevel,p=o.parentColor,u=o.parentColorIndex,f=o.series,m=o.colors,g=o.siblings,v=f.points,y=f.chart.options.chart;return t&&(e=v[t.i],i=c[t.level]||{},e&&i.colorByPoint&&(s=e.index%(m?m.length:y.colorCount),n=m&&m[s]),f.chart.styledMode||(r=N(e&&e.options.color,i&&i.color,n,p&&(l=p,(h=i&&i.colorVariation)&&"brightness"===h.key?k.parse(l).brighten(h.to*(d/g)).get():l),f.color)),a=N(e&&e.options.colorIndex,i&&i.colorIndex,s,u,o.colorIndex)),{color:r,colorIndex:a}},getLevelOptions:function(t){var s,o,e,r,i,n,a=null;if(d(t))for(a={},r=h(t.from)?t.from:1,n=t.levels,o={},s=d(t.defaults)?t.defaults:{},l(n)&&(o=n.reduce(function(t,o){var e,i,n;return d(o)&&h(o.level)&&(n=c({},o),i=p(n.levelIsConstant)?n.levelIsConstant:s.levelIsConstant,delete n.levelIsConstant,delete n.level,e=o.level+(i?0:r-1),d(t[e])?u(t[e],n):t[e]=n),t},{})),i=h(t.to)?t.to:1,e=0;e<=i;e++)a[e]=c({},s,d(o[e])?o[e]:{});return a},setTreeValues:function i(n,s){var t,o=s.before,e=s.idRoot,r=s.mapIdToNode[e],a=!p(s.levelIsConstant)||s.levelIsConstant,l=s.points[n.i],h=l&&l.options||{},d=0,c=[];return u(n,{levelDynamic:n.level-(a?0:r.level),name:N(l&&l.name,""),visible:e===n.id||!!p(s.visible)&&s.visible}),"function"==typeof o&&(n=o(n,s)),n.children.forEach(function(t,o){var e=u({},s);u(e,{index:o,siblings:n.children.length,visible:n.visible}),t=i(t,e),c.push(t),t.visible&&(d+=t.val)}),n.visible=0<d||n.visible,t=N(h.value,d),u(n,{children:c,childrenTotal:d,isLeaf:n.visible&&!d,val:t}),n},updateRootId:function(t){var o,e;return d(t)&&(e=d(t.options)?t.options:{},o=N(t.rootNode,e.rootId,""),d(t.userOptions)&&(t.userOptions.rootId=o),t.rootNode=o),o}}}),e(o,"modules/sankey.src.js",[o["parts/Globals.js"],o["parts/Color.js"],o["parts/Point.js"],o["parts/Utilities.js"],o["mixins/tree-series.js"]],function(o,h,e,t,i){var r=t.defined,a=t.find,g=t.isObject,v=t.merge,y=t.pick,c=t.relativeLength,n=t.seriesType,s=t.stableSort,p=i.getLevelOptions;n("sankey","column",{borderWidth:0,colorByPoint:!0,curveFactor:.33,dataLabels:{enabled:!0,backgroundColor:"none",crop:!1,nodeFormat:void 0,nodeFormatter:function(){return this.point.name},format:void 0,formatter:function(){},inside:!0},inactiveOtherPoints:!0,linkOpacity:.5,minLinkWidth:0,nodeWidth:20,nodePadding:10,showInLegend:!1,states:{hover:{linkOpacity:1},inactive:{linkOpacity:.1,opacity:.1,animation:{duration:50}}},tooltip:{followPointer:!0,headerFormat:'<span style="font-size: 10px">{series.name}</span><br/>',pointFormat:"{point.fromNode.name} â†’ {point.toNode.name}: <b>{point.weight}</b><br/>",nodeFormat:"{point.name}: <b>{point.sum}</b><br/>"}},{isCartesian:!1,invertable:!0,forceDL:!0,orderNodes:!0,pointArrayMap:["from","to"],createNode:o.NodesMixin.createNode,searchPoint:o.noop,setData:o.NodesMixin.setData,destroy:o.NodesMixin.destroy,getNodePadding:function(){var t=this.options.nodePadding||0;if(this.nodeColumns){var o=this.nodeColumns.reduce(function(t,o){return Math.max(t,o.length)},0);o*t>this.chart.plotSizeY&&(t=this.chart.plotSizeY/o)}return t},createNodeColumn:function(){var l=this,o=this.chart,h=[];return h.sum=function(){return this.reduce(function(t,o){return t+o.getSum()},0)},h.offset=function(t,o){for(var e,i=0,n=l.nodePadding,s=0;s<h.length;s++){var r=h[s].getSum(),a=Math.max(r*o,l.options.minLinkWidth);if(e=r?a+n:0,h[s]===t)return{relativeTop:i+c(t.options.offset||0,e)};i+=e}},h.top=function(e){var i=l.nodePadding,t=this.reduce(function(t,o){return 0<t&&(t+=i),t+=Math.max(o.getSum()*e,l.options.minLinkWidth)},0);return(o.plotSizeY-t)/2},h},createNodeColumns:function(){var s=[];this.nodes.forEach(function(i){var t,n,o,e=-1;if(!r(i.options.column))if(0===i.linksTo.length)i.column=0;else{for(n=0;n<i.linksTo.length;n++)(o=i.linksTo[0]).fromNode.column>e&&(e=(t=o.fromNode).column);i.column=e+1,t&&"hanging"===t.options.layout&&(i.hangsFrom=t,n=-1,a(t.linksFrom,function(t,o){var e=t.toNode===i;return e&&(n=o),e}),i.column+=n)}s[i.column]||(s[i.column]=this.createNodeColumn()),s[i.column].push(i)},this);for(var t=0;t<s.length;t++)void 0===s[t]&&(s[t]=this.createNodeColumn());return s},hasData:function(){return!!this.processedXData.length},pointAttribs:function(t,o){var e=this,i=t.isNode?t.level:t.fromNode.level,n=e.mapOptionsToLevel[i||0]||{},s=t.options,r=n.states&&n.states[o]||{},a=["colorByPoint","borderColor","borderWidth","linkOpacity"].reduce(function(t,o){return t[o]=y(r[o],s[o],n[o],e.options[o]),t},{}),l=y(r.color,s.color,a.colorByPoint?t.color:n.color);return t.isNode?{fill:l,stroke:a.borderColor,"stroke-width":a.borderWidth}:{fill:h.parse(l).setOpacity(a.linkOpacity).get()}},generatePoints:function(){o.NodesMixin.generatePoints.apply(this,arguments),this.orderNodes&&(this.nodes.filter(function(t){return 0===t.linksTo.length}).forEach(function(t){!function o(t,e){void 0===t.level&&(t.level=e,t.linksFrom.forEach(function(t){t.toNode&&o(t.toNode,e+1)}))}(t,0)}),s(this.nodes,function(t,o){return t.level-o.level}))},translateNode:function(t,o){var e,i,n,s=this.translationFactor,r=this.chart,a=this.options,l=t.getSum(),h=Math.max(Math.round(l*s),this.options.minLinkWidth),d=Math.round(a.borderWidth)%2/2,c=o.offset(t,s),p=Math.floor(y(c.absoluteTop,o.top(s)+c.relativeTop))+d,u=Math.floor(this.colDistance*t.column+a.borderWidth/2)+d,f=r.inverted?r.plotSizeX-u:u,m=Math.round(this.nodeWidth);(t.sum=l)?(t.shapeType="rect",t.nodeX=f,t.nodeY=p,r.inverted?t.shapeArgs={x:f-m,y:r.plotSizeY-p-h,width:t.options.height||a.height||m,height:t.options.width||a.width||h}:t.shapeArgs={x:f,y:p,width:t.options.width||a.width||m,height:t.options.height||a.height||h},t.shapeArgs.display=t.hasShape()?"":"none",t.dlOptions=(e={level:this.mapOptionsToLevel[t.level],optionsPoint:t.options},i=g(e.optionsPoint)?e.optionsPoint.dataLabels:{},n=g(e.level)?e.level.dataLabels:{},v({style:{}},n,i)),t.plotY=1,t.tooltipPos=r.inverted?[r.plotSizeY-t.shapeArgs.y-t.shapeArgs.height/2,r.plotSizeX-t.shapeArgs.x-t.shapeArgs.width/2]:[t.shapeArgs.x+t.shapeArgs.width/2,t.shapeArgs.y+t.shapeArgs.height/2]):t.dlOptions={enabled:!1}},translateLink:function(n){function t(t,o){var e,i=t.offset(n,o)*s;return Math.min(t.nodeY+i,t.nodeY+(null===(e=t.shapeArgs)||void 0===e?void 0:e.height)-r)}var o=n.fromNode,e=n.toNode,i=this.chart,s=this.translationFactor,r=Math.max(n.weight*s,this.options.minLinkWidth),a=this.options,l=(i.inverted?-this.colDistance:this.colDistance)*a.curveFactor,h=t(o,"linksFrom"),d=t(e,"linksTo"),c=o.nodeX,p=this.nodeWidth,u=e.column*this.colDistance,f=n.outgoing,m=c<u;if(i.inverted&&(h=i.plotSizeY-h,d=i.plotSizeY-d,u=i.plotSizeX-u,p=-p,r=-r,m=u<c),n.shapeType="path",n.linkBase=[h,h+r,d,d+r],m)n.shapeArgs={d:["M",c+p,h,"C",c+p+l,h,u-l,d,u,d,"L",u+(f?p:0),d+r/2,"L",u,d+r,"C",u-l,d+r,c+p+l,h+r,c+p,h+r,"z"]};else{var g=i.plotHeight-h-r,v=u-20-r,y=u-20,k=c+p,N=k+20,b=N+r,x=h+r,C=x+20,S=C+g,L=S+20,P=L+r,T=d+r,M=T+20,O=x-.7*r,w=L+.7*r,W=T-.7*r,F=u-.7*r,I=k+.7*r;n.shapeArgs={d:["M",k,h,"C",I,h,b,O,b,C,"L",b,S,"C",b,w,I,P,k,P,"L",u,P,"C",F,P,v,w,v,S,"L",v,M,"C",v,W,F,d,u,d,"L",u,T,"C",y,T,y,T,y,M,"L",y,S,"C",y,L,y,L,u,L,"L",k,L,"C",N,L,N,L,N,S,"L",N,C,"C",N,x,N,x,k,x,"z"]}}n.dlBox={x:c+(u-c+p)/2,y:h+(d-h)/2,height:r,width:0},n.tooltipPos=i.inverted?[i.plotSizeY-n.dlBox.y-r/2,i.plotSizeX-n.dlBox.x]:[n.dlBox.x,n.dlBox.y+r/2],n.y=n.plotY=1,n.color||(n.color=o.color)},translate:function(){var a=this;this.processedXData||this.processData(),this.generatePoints(),this.nodeColumns=this.createNodeColumns(),this.nodeWidth=c(this.options.nodeWidth,this.chart.plotSizeX);var l=this,h=this.chart,d=this.options,t=this.nodeWidth,o=this.nodeColumns;this.nodePadding=this.getNodePadding(),this.translationFactor=o.reduce(function(t,o){return Math.min(t,function(o){for(var t,e,i=o.slice(),n=a.options.minLinkWidth||0,s=0,r=h.plotSizeY-d.borderWidth-(o.length-1)*l.nodePadding;o.length;){for(s=r/o.sum(),t=!1,e=o.length;e--;)o[e].getSum()*s<n&&(o.splice(e,1),r-=n+l.nodePadding,t=!0);if(!t)break}return o.length=0,i.forEach(function(t){return o.push(t)}),s}(o))},1/0),this.colDistance=(h.plotSizeX-t-d.borderWidth)/Math.max(1,o.length-1),l.mapOptionsToLevel=p({from:1,levels:d.levels,to:o.length-1,defaults:{borderColor:d.borderColor,borderRadius:d.borderRadius,borderWidth:d.borderWidth,color:l.color,colorByPoint:d.colorByPoint,levelIsConstant:!0,linkColor:d.linkColor,linkLineWidth:d.linkLineWidth,linkOpacity:d.linkOpacity,states:d.states}}),o.forEach(function(o){o.forEach(function(t){l.translateNode(t,o)})},this),this.nodes.forEach(function(t){t.linksFrom.forEach(function(t){(t.weight||t.isNull)&&t.to&&(l.translateLink(t),t.allowShadow=!1)})})},render:function(){var t=this.points;this.points=this.points.concat(this.nodes||[]),o.seriesTypes.column.prototype.render.call(this),this.points=t},animate:o.Series.prototype.animate},{applyOptions:function(t,o){return e.prototype.applyOptions.call(this,t,o),r(this.options.level)&&(this.options.column=this.column=this.options.level),this},setState:o.NodesMixin.setNodeState,getClassName:function(){return(this.isNode?"highcharts-node ":"highcharts-link ")+e.prototype.getClassName.call(this)},isValid:function(){return this.isNode||"number"==typeof this.weight}})}),e(o,"masters/modules/sankey.src.js",[],function(){})});