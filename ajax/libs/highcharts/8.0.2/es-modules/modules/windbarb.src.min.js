"use strict";import H from"../parts/Globals.js";import U from"../parts/Utilities.js";var animObject=U.animObject,isNumber=U.isNumber,pick=U.pick,seriesType=U.seriesType;import onSeriesMixin from"../mixins/on-series.js";var noop=H.noop;function registerApproximation(){H.approximations&&!H.approximations.windbarb&&(H.approximations.windbarb=function(t,i){var r,e=0,o=0,s=t.length;for(r=0;r<s;r++)e+=t[r]*Math.cos(i[r]*H.deg2rad),o+=t[r]*Math.sin(i[r]*H.deg2rad);return[t.reduce(function(t,i){return t+i},0)/t.length,Math.atan2(o,e)/H.deg2rad]})}registerApproximation(),seriesType("windbarb","column",{dataGrouping:{enabled:!0,approximation:"windbarb",groupPixelWidth:30},lineWidth:2,onSeries:null,states:{hover:{lineWidthPlus:0}},tooltip:{pointFormat:'<span style="color:{point.color}">‚óè</span> {series.name}: <b>{point.value}</b> ({point.beaufort})<br/>'},vectorLength:20,colorKey:"value",yOffset:-20,xOffset:0},{pointArrayMap:["value","direction"],parallelArrays:["x","value","direction"],beaufortName:["Calm","Light air","Light breeze","Gentle breeze","Moderate breeze","Fresh breeze","Strong breeze","Near gale","Gale","Strong gale","Storm","Violent storm","Hurricane"],beaufortFloor:[0,.3,1.6,3.4,5.5,8,10.8,13.9,17.2,20.8,24.5,28.5,32.7],trackerGroups:["markerGroup"],init:function(t,i){registerApproximation(),H.Series.prototype.init.call(this,t,i)},pointAttribs:function(t,i){var r=this.options,e=t.color||this.color,o=this.options.lineWidth;return i&&(e=r.states[i].color||e,o=(r.states[i].lineWidth||o)+(r.states[i].lineWidthPlus||0)),{stroke:e,"stroke-width":o}},markerAttribs:function(){},getPlotBox:onSeriesMixin.getPlotBox,windArrow:function(t){var i,r,e=1.943844*t.value,o=t.beaufortLevel,s=this.options.vectorLength/20,n=-10;if(t.isNull)return[];if(0===o)return this.chart.renderer.symbols.circle(-10*s,-10*s,20*s,20*s);if(i=["M",0,7*s,"L",-1.5*s,7*s,0,10*s,1.5*s,7*s,0,7*s,0,-10*s],(r=(e-e%50)/50)>0)for(;r--;)i.push(-10===n?"L":"M",0,n*s,"L",5*s,n*s+2,"L",0,n*s+4),e-=50,n+=7;if((r=(e-e%10)/10)>0)for(;r--;)i.push(-10===n?"L":"M",0,n*s,"L",7*s,n*s),e-=10,n+=3;if((r=(e-e%5)/5)>0)for(;r--;)i.push(-10===n?"L":"M",0,n*s,"L",4*s,n*s),e-=5,n+=3;return i},translate:function(){var t=this.beaufortFloor,i=this.beaufortName;onSeriesMixin.translate.call(this),this.points.forEach(function(r){for(var e=0;e<t.length&&!(t[e]>r.value);e++);r.beaufortLevel=e-1,r.beaufort=i[e-1]})},drawPoints:function(){var t=this.chart,i=this.yAxis,r=t.inverted,e=this.options.vectorLength/2;this.points.forEach(function(o){var s=o.plotX,n=o.plotY;!1===this.options.clip||t.isInsidePlot(s,0,!1)?(o.graphic||(o.graphic=this.chart.renderer.path().add(this.markerGroup).addClass("highcharts-point highcharts-color-"+pick(o.colorIndex,o.series.colorIndex))),o.graphic.attr({d:this.windArrow(o),translateX:s+this.options.xOffset,translateY:n+this.options.yOffset,rotation:o.direction}),this.chart.styledMode||o.graphic.attr(this.pointAttribs(o))):o.graphic&&(o.graphic=o.graphic.destroy()),o.tooltipPos=[s+this.options.xOffset+(r&&!this.onSeries?e:0),n+this.options.yOffset-(r?0:e+i.pos-t.plotTop)]},this)},animate:function(t){t?this.markerGroup.attr({opacity:.01}):(this.markerGroup.animate({opacity:1},animObject(this.options.animation)),this.animate=null)},invertGroups:noop,getExtremes:noop},{isValid:function(){return isNumber(this.value)&&this.value>=0}});