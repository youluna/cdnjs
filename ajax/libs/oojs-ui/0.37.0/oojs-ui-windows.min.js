/*! OOUI v0.37.0 | http://oojs.mit-license.org */
!function(c){"use strict";c.ui.ActionWidget=function(t){t=$.extend({framed:!1},t),c.ui.ActionWidget.parent.call(this,t),c.ui.mixin.PendingElement.call(this,t),this.action=t.action||"",this.modes=t.modes||[],this.width=0,this.height=0,this.$element.addClass("oo-ui-actionWidget")},c.inheritClass(c.ui.ActionWidget,c.ui.ButtonWidget),c.mixinClass(c.ui.ActionWidget,c.ui.mixin.PendingElement),c.ui.ActionWidget.prototype.hasMode=function(t){return-1!==this.modes.indexOf(t)},c.ui.ActionWidget.prototype.getAction=function(){return this.action},c.ui.ActionWidget.prototype.getModes=function(){return this.modes.slice()},c.ui.ActionSet=function(){c.EventEmitter.call(this),this.list=[],this.categories={actions:"getAction",flags:"getFlags",modes:"getModes"},this.categorized={},this.special={},this.others=[],this.organized=!1,this.changing=!1,this.changed=!1},c.mixinClass(c.ui.ActionSet,c.EventEmitter),c.ui.ActionSet.static.specialFlags=["safe","primary"],c.ui.ActionSet.prototype.onActionChange=function(){this.organized=!1,this.changing?this.changed=!0:this.emit("change")},c.ui.ActionSet.prototype.isSpecial=function(t){var e;for(e in this.special)if(t===this.special[e])return!0;return!1},c.ui.ActionSet.prototype.get=function(t){var e,i,o,n,s,r,a,c;if(t){for(n in this.organize(),c=[],this.categorized)if(o=t[n])for(Array.isArray(o)||(o=[o]),e=0,i=o.length;e<i;e++)s=this.categorized[n][o[e]],Array.isArray(s)&&c.push.apply(c,s);for(e=0,i=c.length;e<i;e++)a=c[e],(void 0!==t.visible&&a.isVisible()!==t.visible||void 0!==t.disabled&&a.isDisabled()!==t.disabled)&&(c.splice(e,1),i--,e--);for(e=0,i=c.length;e<i;e++)for(a=c[e],r=c.lastIndexOf(a);r!==e;)c.splice(r,1),i--,r=c.lastIndexOf(a);return c}return this.list.slice()},c.ui.ActionSet.prototype.getSpecial=function(){return this.organize(),$.extend({},this.special)},c.ui.ActionSet.prototype.getOthers=function(){return this.organize(),this.others.slice()},c.ui.ActionSet.prototype.setMode=function(t){var e,i,o;for(this.changing=!0,e=0,i=this.list.length;e<i;e++)(o=this.list[e]).toggle(o.hasMode(t));return this.organized=!1,this.changing=!1,this.emit("change"),this},c.ui.ActionSet.prototype.setAbilities=function(t){var e,i,o,n;for(e=0,i=this.list.length;e<i;e++)void 0!==t[o=(n=this.list[e]).getAction()]&&n.setDisabled(!t[o]);return this},c.ui.ActionSet.prototype.forEach=function(t,e){return this.changed=!1,this.changing=!0,this.get(t).forEach(e),this.changing=!1,this.changed&&this.emit("change"),this},c.ui.ActionSet.prototype.add=function(t){var e,i,o;for(this.changing=!0,e=0,i=t.length;e<i;e++)(o=t[e]).connect(this,{click:["emit","click",o],toggle:["onActionChange"]}),this.list.push(o);return this.organized=!1,this.emit("add",t),this.changing=!1,this.emit("change"),this},c.ui.ActionSet.prototype.remove=function(t){var e,i,o,n;for(this.changing=!0,e=0,i=t.length;e<i;e++)n=t[e],-1!==(o=this.list.indexOf(n))&&(n.disconnect(this),this.list.splice(o,1));return this.organized=!1,this.emit("remove",t),this.changing=!1,this.emit("change"),this},c.ui.ActionSet.prototype.clear=function(){var t,e,i=this.list.slice();for(this.changing=!0,t=0,e=this.list.length;t<e;t++)this.list[t].disconnect(this);return this.list=[],this.organized=!1,this.emit("remove",i),this.changing=!1,this.emit("change"),this},c.ui.ActionSet.prototype.organize=function(){var t,e,i,o,n,s,r,a,c,l,u=this.constructor.static.specialFlags;if(!this.organized){for(this.categorized={},this.special={},this.others=[],t=0,e=this.list.length;t<e;t++)if((s=this.list[t]).isVisible()){for(r in this.categories)for(this.categorized[r]||(this.categorized[r]={}),a=s[this.categories[r]](),Array.isArray(a)||(a=[a]),i=0,o=a.length;i<o;i++)c=a[i],this.categorized[r][c]||(this.categorized[r][c]=[]),this.categorized[r][c].push(s);for(l=!1,i=0,o=u.length;i<o;i++)if(n=u[i],!this.special[n]&&s.hasFlag(n)){this.special[n]=s,l=!0;break}l||this.others.push(s)}this.organized=!0}return this},c.ui.Error=function(t,e){c.isPlainObject(t)&&void 0===e&&(t=(e=t).message),e=e||{},this.message=t instanceof $?t:String(t),this.recoverable=void 0===e.recoverable||!!e.recoverable,this.warning=!!e.warning},c.initClass(c.ui.Error),c.ui.Error.prototype.isRecoverable=function(){return this.recoverable},c.ui.Error.prototype.isWarning=function(){return this.warning},c.ui.Error.prototype.getMessage=function(){return this.message instanceof $?this.message.clone():$("<div>").text(this.message).contents()},c.ui.Error.prototype.getMessageText=function(){return this.message instanceof $?this.message.text():this.message},c.ui.Process=function(t,e){this.steps=[],void 0!==t&&this.next(t,e)},c.initClass(c.ui.Process),c.ui.Process.prototype.execute=function(){var t,e,i;function o(i){return function(){var t,e=i.callback.call(i.context);if(!1===e)return $.Deferred().reject([]).promise();if("number"!=typeof e)return e instanceof c.ui.Error?$.Deferred().reject([e]).promise():Array.isArray(e)&&e.length&&e[0]instanceof c.ui.Error?$.Deferred().reject(e).promise():e&&"function"==typeof e.then?$.when(e).promise():$.Deferred().resolve().promise();if(e<0)throw new Error("Cannot go back in time: flux capacitor is out of service");return t=$.Deferred(),setTimeout(t.resolve,e),t.promise()}}if(this.steps.length)for(i=o(this.steps[0])(),t=1,e=this.steps.length;t<e;t++)i=i.then(o(this.steps[t]));else i=$.Deferred().resolve().promise();return i},c.ui.Process.prototype.createStep=function(t,e){if("number"==typeof t||"function"==typeof t.then)return{callback:function(){return t},context:null};if("function"==typeof t)return{callback:t,context:e};throw new Error("Cannot create process step: number, promise or function expected")},c.ui.Process.prototype.first=function(t,e){return this.steps.unshift(this.createStep(t,e)),this},c.ui.Process.prototype.next=function(t,e){return this.steps.push(this.createStep(t,e)),this},c.ui.WindowInstance=function(){var t={opening:$.Deferred(),opened:$.Deferred(),closing:$.Deferred(),closed:$.Deferred()};this.deferreds=t,this.opening=t.opening.promise(),this.opened=this.opening.then(function(){return t.opened}),this.closing=this.opened.then(function(){return t.closing}),this.closed=this.closing.then(function(){return t.closed})},c.initClass(c.ui.WindowInstance),c.ui.WindowInstance.prototype.isOpening=function(){return"pending"===this.deferreds.opened.state()},c.ui.WindowInstance.prototype.isOpened=function(){return"resolved"===this.deferreds.opened.state()&&"pending"===this.deferreds.closing.state()},c.ui.WindowInstance.prototype.isClosing=function(){return"resolved"===this.deferreds.closing.state()&&"pending"===this.deferreds.closed.state()},c.ui.WindowInstance.prototype.isClosed=function(){return"resolved"===this.deferreds.closed.state()},c.ui.WindowManager=function(t){t=t||{},c.ui.WindowManager.parent.call(this,t),c.EventEmitter.call(this),this.factory=t.factory,this.modal=void 0===t.modal||!!t.modal,this.windows={},this.compatOpened=null,this.preparingToOpen=null,this.preparingToClose=null,this.currentWindow=null,this.globalEvents=!1,this.$returnFocusTo=null,this.$ariaHidden=null,this.onWindowResizeTimeout=null,this.onWindowResizeHandler=this.onWindowResize.bind(this),this.afterWindowResizeHandler=this.afterWindowResize.bind(this),this.$element.addClass("oo-ui-windowManager").toggleClass("oo-ui-windowManager-modal",this.modal),this.modal&&this.$element.attr("aria-hidden",!0)},c.inheritClass(c.ui.WindowManager,c.ui.Element),c.mixinClass(c.ui.WindowManager,c.EventEmitter),c.ui.WindowManager.static.sizes={small:{width:300},medium:{width:500},large:{width:700},larger:{width:900},full:{width:"100%",height:"100%"}},c.ui.WindowManager.static.defaultSize="medium",c.ui.WindowManager.prototype.onWindowResize=function(){clearTimeout(this.onWindowResizeTimeout),this.onWindowResizeTimeout=setTimeout(this.afterWindowResizeHandler,200)},c.ui.WindowManager.prototype.afterWindowResize=function(){var t=document.activeElement;this.currentWindow&&(this.updateWindowSize(this.currentWindow),t!==document.activeElement&&t.focus())},c.ui.WindowManager.prototype.isOpening=function(t){return t===this.currentWindow&&!!this.lifecycle&&this.lifecycle.isOpening()},c.ui.WindowManager.prototype.isClosing=function(t){return t===this.currentWindow&&!!this.lifecycle&&this.lifecycle.isClosing()},c.ui.WindowManager.prototype.isOpened=function(t){return t===this.currentWindow&&!!this.lifecycle&&this.lifecycle.isOpened()},c.ui.WindowManager.prototype.hasWindow=function(t){var e;for(e in this.windows)if(this.windows[e]===t)return!0;return!1},c.ui.WindowManager.prototype.getSetupDelay=function(){return 0},c.ui.WindowManager.prototype.getReadyDelay=function(){return this.modal?c.ui.theme.getDialogTransitionDuration():0},c.ui.WindowManager.prototype.getHoldDelay=function(){return 0},c.ui.WindowManager.prototype.getTeardownDelay=function(){return this.modal?c.ui.theme.getDialogTransitionDuration():0},c.ui.WindowManager.prototype.getWindow=function(t){var e=$.Deferred(),i=this.windows[t];return i instanceof c.ui.Window?e.resolve(i):this.factory?this.factory.lookup(t)?(i=this.factory.create(t),this.addWindows([i]),e.resolve(i)):e.reject(new c.ui.Error("Cannot auto-instantiate window: symbolic name is unrecognized by the factory")):e.reject(new c.ui.Error("Cannot get unmanaged window: symbolic name unrecognized as a managed window")),e.promise()},c.ui.WindowManager.prototype.getCurrentWindow=function(){return this.currentWindow},c.ui.WindowManager.prototype.openWindow=function(e,i,o,n){var t,s=this;return i=i||{},o=o||new c.ui.WindowInstance,n=n||$.Deferred(),["state","always","catch","pipe","then","promise","progress","done","fail"].forEach(function(t){o[t]=function(){return c.ui.warnDeprecation("Using the return value of openWindow as a promise is deprecated. Use .openWindow( ... ).opening."+t+"( ... ) instead."),n[t].apply(this,arguments)}}),"string"==typeof e?(this.getWindow(e).then(function(t){s.openWindow(t,i,o,n)},function(t){o.deferreds.opening.reject(t)}),o):(this.hasWindow(e)?this.lifecycle&&this.lifecycle.isOpened()?t="Cannot open window: another window is open":(this.preparingToOpen||this.lifecycle&&this.lifecycle.isOpening())&&(t="Cannot open window: another window is opening"):t="Cannot open window: window is not attached to manager",t?(n.reject(new c.ui.Error(t)),o.deferreds.opening.reject(new c.ui.Error(t))):(this.preparingToOpen=$.when(this.lifecycle&&this.lifecycle.closed),this.preparingToOpen.done(function(){s.modal&&(s.toggleGlobalEvents(!0),s.toggleAriaIsolation(!0)),s.$returnFocusTo=void 0!==i.$returnFocusTo?i.$returnFocusTo:$(document.activeElement),s.currentWindow=e,s.lifecycle=o,s.preparingToOpen=null,s.emit("opening",e,n,i),o.deferreds.opening.resolve(i),setTimeout(function(){s.compatOpened=$.Deferred(),e.setup(i).then(function(){n.notify({state:"setup"}),setTimeout(function(){e.ready(i).then(function(){n.notify({state:"ready"}),o.deferreds.opened.resolve(i),n.resolve(s.compatOpened.promise(),i),s.togglePreventIosScrolling(!0)},function(t){o.deferreds.opened.reject(),n.reject(),s.closeWindow(e),setTimeout(function(){throw t})})},s.getReadyDelay())},function(t){o.deferreds.opened.reject(),n.reject(),s.closeWindow(e),setTimeout(function(){throw t})})},s.getSetupDelay())})),o)},c.ui.WindowManager.prototype.closeWindow=function(t,e){var i,o,n=this,s=$.Deferred(),r=this.lifecycle;return"string"==typeof t?t=this.windows[t]:this.hasWindow(t)||(t=null),r?t?t!==this.currentWindow||this.lifecycle.isClosed()?i="Cannot close window: window already closed with different data":(this.preparingToClose||this.lifecycle.isClosing())&&(i="Cannot close window: window already closing with different data"):i="Cannot close window: window is not attached to manager":i="Cannot close window: no window is currently open",i&&((r=new c.ui.WindowInstance).deferreds.opening.resolve({}),r.deferreds.opened.resolve({})),["state","always","catch","pipe","then","promise","progress","done","fail"].forEach(function(t){r[t]=function(){return c.ui.warnDeprecation("Using the return value of closeWindow as a promise is deprecated. Use .closeWindow( ... ).closed."+t+"( ... ) instead."),s[t].apply(this,arguments)}}),i?(s.reject(new c.ui.Error(i)),r.deferreds.closing.reject(new c.ui.Error(i))):(this.preparingToClose=$.when(this.lifecycle.opened),this.preparingToClose.always(function(){n.preparingToClose=null,n.emit("closing",t,s,e),r.deferreds.closing.resolve(e),o=n.compatOpened,n.compatOpened=null,o.resolve(s.promise(),e),n.togglePreventIosScrolling(!1),setTimeout(function(){t.hold(e).then(function(){s.notify({state:"hold"}),setTimeout(function(){t.teardown(e).then(function(){s.notify({state:"teardown"}),n.modal&&(n.toggleGlobalEvents(!1),n.toggleAriaIsolation(!1)),n.$returnFocusTo&&n.$returnFocusTo.length&&n.$returnFocusTo[0].focus(),n.currentWindow=null,n.lifecycle=null,r.deferreds.closed.resolve(e),s.resolve(e)})},n.getTeardownDelay())})},n.getHoldDelay())})),r},c.ui.WindowManager.prototype.addWindows=function(t){var e,i,o,n,s;if(Array.isArray(t))for(s={},e=0,i=t.length;e<i;e++){if(!(n=t[e].constructor.static.name))throw new Error("Windows must have a `name` static property defined.");s[n]=t[e]}else c.isPlainObject(t)&&(s=t);for(n in s)o=s[n],this.windows[n]=o.toggle(!1),this.$element.append(o.$element),o.setManager(this)},c.ui.WindowManager.prototype.removeWindows=function(t){function e(t,e){delete a.windows[t],e.$element.detach()}var i,o,n,s,r,a=this,c=[];for(i=0,o=t.length;i<o;i++){if(s=t[i],!(n=this.windows[s]))throw new Error("Cannot remove window");r=e.bind(null,s,n),c.push(this.closeWindow(s).closed.then(r,r))}return $.when.apply($,c)},c.ui.WindowManager.prototype.clearWindows=function(){return this.removeWindows(Object.keys(this.windows))},c.ui.WindowManager.prototype.updateWindowSize=function(t){var e;if(t===this.currentWindow)return e="full"===t.getSize(),this.$element.toggleClass("oo-ui-windowManager-fullscreen",e),this.$element.toggleClass("oo-ui-windowManager-floating",!e),t.setDimensions(t.getSizeProperties()),this.emit("resize",t),this},c.ui.WindowManager.prototype.togglePreventIosScrolling=function(t){var e=/ipad|iphone|ipod/i.test(navigator.userAgent),i=$(this.getElementDocument().body),o=c.ui.Element.static.getRootScrollableElement(i[0]),n=i.data("windowManagerGlobalEvents")||0;return e&&1===n&&(t?(this.iosOrigScrollPosition=o.scrollTop,"full"===this.getCurrentWindow().getSize()&&i.add(i.parent()).addClass("oo-ui-windowManager-ios-modal-ready")):(i.add(i.parent()).removeClass("oo-ui-windowManager-ios-modal-ready"),"full"===this.getCurrentWindow().getSize()&&(o.scrollTop=this.iosOrigScrollPosition))),this},c.ui.WindowManager.prototype.toggleGlobalEvents=function(t){var e,i,o=$(this.getElementDocument().body),n=o.data("windowManagerGlobalEvents")||0;return(t=void 0===t?!!this.globalEvents:!!t)?this.globalEvents||($(this.getElementWindow()).on({"orientationchange resize":this.onWindowResizeHandler}),0===n&&(e=window.innerWidth-document.documentElement.clientWidth,i=parseFloat(o.css("margin-right"))||0,o.addClass("oo-ui-windowManager-modal-active"),o.css("margin-right",i+e)),n++,this.globalEvents=!0):this.globalEvents&&($(this.getElementWindow()).off({"orientationchange resize":this.onWindowResizeHandler}),0===--n&&(o.removeClass("oo-ui-windowManager-modal-active"),o.css("margin-right","")),this.globalEvents=!1),o.data("windowManagerGlobalEvents",n),this},c.ui.WindowManager.prototype.toggleAriaIsolation=function(t){var e;return(t=void 0===t?!this.$ariaHidden:!!t)?this.$ariaHidden||(e=0===(e=this.$element.parentsUntil("body").last()).length?this.$element:e,this.$element.removeAttr("aria-hidden"),this.$ariaHidden=$(document.body).children().not("script").not(e).attr("aria-hidden",!0)):this.$ariaHidden&&(this.$ariaHidden.removeAttr("aria-hidden"),this.$ariaHidden=null,this.$element.attr("aria-hidden",!0)),this},c.ui.WindowManager.prototype.destroy=function(){this.toggleGlobalEvents(!1),this.toggleAriaIsolation(!1),this.clearWindows(),this.$element.remove()},c.ui.Window=function(t){t=t||{},c.ui.Window.parent.call(this,t),c.EventEmitter.call(this),this.manager=null,this.size=t.size||this.constructor.static.size,this.$frame=$("<div>"),this.$overlay=$("<div>"),this.$content=$("<div>"),this.$focusTrapBefore=$("<div>").prop("tabIndex",0),this.$focusTrapAfter=$("<div>").prop("tabIndex",0),this.$focusTraps=this.$focusTrapBefore.add(this.$focusTrapAfter),this.$overlay.addClass("oo-ui-window-overlay"),this.$content.addClass("oo-ui-window-content").attr("tabindex",0),this.$frame.addClass("oo-ui-window-frame").append(this.$focusTrapBefore,this.$content,this.$focusTrapAfter),this.$element.addClass("oo-ui-window").append(this.$frame,this.$overlay),this.visible=!1,this.$element.addClass("oo-ui-element-hidden")},c.inheritClass(c.ui.Window,c.ui.Element),c.mixinClass(c.ui.Window,c.EventEmitter),c.ui.Window.static.size="medium",c.ui.Window.prototype.onMouseDown=function(t){if(t.target===this.$element[0])return!1},c.ui.Window.prototype.isInitialized=function(){return!!this.manager},c.ui.Window.prototype.isVisible=function(){return this.visible},c.ui.Window.prototype.isOpening=function(){return this.manager.isOpening(this)},c.ui.Window.prototype.isClosing=function(){return this.manager.isClosing(this)},c.ui.Window.prototype.isOpened=function(){return this.manager.isOpened(this)},c.ui.Window.prototype.getManager=function(){return this.manager},c.ui.Window.prototype.getSize=function(){var t=c.ui.Element.static.getDimensions(this.getElementWindow()),e=this.manager.constructor.static.sizes,i=this.size;return e[i]||(i=this.manager.constructor.static.defaultSize),"full"!==i&&t.rect.right-t.rect.left<e[i].width&&(i="full"),i},c.ui.Window.prototype.getSizeProperties=function(){return this.manager.constructor.static.sizes[this.getSize()]},c.ui.Window.prototype.withoutSizeTransitions=function(t){var e=this.$frame.css("transition-property")+" "+this.$frame.css("transition-duration")+" "+this.$frame.css("transition-timing-function")+" "+this.$frame.css("transition-delay");this.$frame.css("transition","none"),t(),this.$frame.height(),this.$frame.css("transition",e)},c.ui.Window.prototype.getContentHeight=function(){var i,o=this,n=this.$body[0].style,s=this.$frame[0].style;return this.withoutSizeTransitions(function(){var t=s.height,e=n.position;s.height="1px",n.position="relative",i=o.getBodyHeight(),s.height=t,n.position=e}),this.$frame.outerHeight()-this.$frame.innerHeight()+(this.$head.outerHeight(!0)+i+this.$foot.outerHeight(!0))},c.ui.Window.prototype.getBodyHeight=function(){return this.$body[0].scrollHeight},c.ui.Window.prototype.getDir=function(){return c.ui.Element.static.getDir(this.$content)||"ltr"},c.ui.Window.prototype.getSetupProcess=function(){return new c.ui.Process},c.ui.Window.prototype.getReadyProcess=function(){return new c.ui.Process},c.ui.Window.prototype.getHoldProcess=function(){return new c.ui.Process},c.ui.Window.prototype.getTeardownProcess=function(){return new c.ui.Process},c.ui.Window.prototype.setManager=function(t){if(this.manager)throw new Error("Cannot set window manager, window already has a manager");return this.manager=t,this.initialize(),this},c.ui.Window.prototype.setSize=function(t){return this.size=t,this.updateSize(),this},c.ui.Window.prototype.updateSize=function(){if(!this.manager)throw new Error("Cannot update window size, must be attached to a manager");return this.manager.updateWindowSize(this),this},c.ui.Window.prototype.setDimensions=function(e){var i,o=this,n=this.$frame[0].style;return void 0===e.height?this.withoutSizeTransitions(function(){var t=n.width;o.$frame.css("width",e.width||""),i=o.getContentHeight(),n.width=t}):i=e.height,this.$frame.css({width:e.width||"",minWidth:e.minWidth||"",maxWidth:e.maxWidth||"",height:i||"",minHeight:e.minHeight||"",maxHeight:e.maxHeight||""}),this},c.ui.Window.prototype.initialize=function(){if(!this.manager)throw new Error("Cannot initialize window, must be attached to a manager");return this.$head=$("<div>"),this.$body=$("<div>"),this.$foot=$("<div>"),this.$document=$(this.getElementDocument()),this.$element.on("mousedown",this.onMouseDown.bind(this)),this.$head.addClass("oo-ui-window-head"),this.$body.addClass("oo-ui-window-body"),this.$foot.addClass("oo-ui-window-foot"),this.$content.append(this.$head,this.$body,this.$foot),this},c.ui.Window.prototype.onFocusTrapFocused=function(t){var e=this.$focusTrapBefore.is(t.target),i=c.ui.findFocusable(this.$content,e);i?i.focus():this.$content.trigger("focus")},c.ui.Window.prototype.open=function(t){if(!this.manager)throw new Error("Cannot open window, must be attached to a manager");return this.manager.openWindow(this,t)},c.ui.Window.prototype.close=function(t){if(!this.manager)throw new Error("Cannot close window, must be attached to a manager");return this.manager.closeWindow(this,t)},c.ui.Window.prototype.setup=function(t){var e=this;return this.toggle(!0),this.focusTrapHandler=c.ui.bind(this.onFocusTrapFocused,this),this.$focusTraps.on("focus",this.focusTrapHandler),this.getSetupProcess(t).execute().then(function(){e.updateSize(),e.$element.addClass("oo-ui-window-active oo-ui-window-setup").width(),e.$content.addClass("oo-ui-window-content-setup").width()})},c.ui.Window.prototype.ready=function(t){var e=this;return this.$content.trigger("focus"),this.getReadyProcess(t).execute().then(function(){e.$element.addClass("oo-ui-window-ready").width(),e.$content.addClass("oo-ui-window-content-ready").width()})},c.ui.Window.prototype.hold=function(t){var e=this;return this.getHoldProcess(t).execute().then(function(){var t=e.$content.find(c.ui.Element.static.getDocument(e.$content).activeElement);t.length&&t[0].blur(),e.$element.removeClass("oo-ui-window-ready oo-ui-window-setup").width(),e.$content.removeClass("oo-ui-window-content-ready oo-ui-window-content-setup").width()})},c.ui.Window.prototype.teardown=function(t){var e=this;return this.getTeardownProcess(t).execute().then(function(){e.$element.removeClass("oo-ui-window-active").width(),e.$focusTraps.off("focus",e.focusTrapHandler),e.toggle(!1)})},c.ui.Dialog=function(t){c.ui.Dialog.parent.call(this,t),c.ui.mixin.PendingElement.call(this),this.actions=new c.ui.ActionSet,this.attachedActions=[],this.currentAction=null,this.onDialogKeyDownHandler=this.onDialogKeyDown.bind(this),this.actions.connect(this,{click:"onActionClick",change:"onActionsChange"}),this.$element.addClass("oo-ui-dialog").attr("role","dialog")},c.inheritClass(c.ui.Dialog,c.ui.Window),c.mixinClass(c.ui.Dialog,c.ui.mixin.PendingElement),c.ui.Dialog.static.name="",c.ui.Dialog.static.title="",c.ui.Dialog.static.actions=[],c.ui.Dialog.static.escapable=!0,c.ui.Dialog.prototype.onDialogKeyDown=function(t){var e;t.which===c.ui.Keys.ESCAPE&&this.constructor.static.escapable?(this.executeAction(""),t.preventDefault(),t.stopPropagation()):t.which===c.ui.Keys.ENTER&&(t.ctrlKey||t.metaKey)&&0<(e=this.actions.get({flags:"primary",visible:!0,disabled:!1})).length&&(this.executeAction(e[0].getAction()),t.preventDefault(),t.stopPropagation())},c.ui.Dialog.prototype.onActionClick=function(t){this.isPending()||this.executeAction(t.getAction())},c.ui.Dialog.prototype.onActionsChange=function(){this.detachActions(),this.isClosing()||(this.attachActions(),this.isOpening()||this.updateSize())},c.ui.Dialog.prototype.getActions=function(){return this.actions},c.ui.Dialog.prototype.getActionProcess=function(t){return(new c.ui.Process).next(function(){t||this.close()},this)},c.ui.Dialog.prototype.getSetupProcess=function(o){return o=o||{},c.ui.Dialog.parent.prototype.getSetupProcess.call(this,o).next(function(){var t=this.constructor.static,e=void 0!==o.actions?o.actions:t.actions,i=void 0!==o.title?o.title:t.title;this.title.setLabel(i).setTitle(i),this.actions.add(this.getActionWidgets(e)),this.$element.on("keydown",this.onDialogKeyDownHandler)},this)},c.ui.Dialog.prototype.getTeardownProcess=function(t){return c.ui.Dialog.parent.prototype.getTeardownProcess.call(this,t).first(function(){this.$element.off("keydown",this.onDialogKeyDownHandler),this.actions.clear(),this.currentAction=null},this)},c.ui.Dialog.prototype.initialize=function(){c.ui.Dialog.parent.prototype.initialize.call(this),this.title=new c.ui.LabelWidget,this.$content.addClass("oo-ui-dialog-content"),this.$element.attr("aria-labelledby",this.title.getElementId()),this.setPendingElement(this.$head)},c.ui.Dialog.prototype.getActionWidgets=function(t){var e,i,o=[];for(e=0,i=t.length;e<i;e++)o.push(this.getActionWidget(t[e]));return o},c.ui.Dialog.prototype.getActionWidget=function(t){return new c.ui.ActionWidget(this.getActionWidgetConfig(t))},c.ui.Dialog.prototype.getActionWidgetConfig=function(t){return t},c.ui.Dialog.prototype.attachActions=function(){this.attachedActions=this.actions.get()},c.ui.Dialog.prototype.detachActions=function(){var t,e;for(t=0,e=this.attachedActions.length;t<e;t++)this.attachedActions[t].$element.detach();return this.attachedActions=[],this},c.ui.Dialog.prototype.executeAction=function(t){return this.pushPending(),this.currentAction=t,this.getActionProcess(t).execute().always(this.popPending.bind(this))},c.ui.MessageDialog=function(t){c.ui.MessageDialog.parent.call(this,t),this.verticalActionLayout=null,this.$element.addClass("oo-ui-messageDialog")},c.inheritClass(c.ui.MessageDialog,c.ui.Dialog),c.ui.MessageDialog.static.name="message",c.ui.MessageDialog.static.size="small",c.ui.MessageDialog.static.title=null,c.ui.MessageDialog.static.message=null,c.ui.MessageDialog.static.actions=[{action:"accept",label:c.ui.deferMsg("ooui-dialog-message-accept"),flags:"primary"},{action:"reject",label:c.ui.deferMsg("ooui-dialog-message-reject"),flags:"safe"}],c.ui.MessageDialog.prototype.toggleVerticalActionLayout=function(t){return(t=void 0===t?!this.verticalActionLayout:!!t)!==this.verticalActionLayout&&(this.verticalActionLayout=t,this.$actions.toggleClass("oo-ui-messageDialog-actions-vertical",t).toggleClass("oo-ui-messageDialog-actions-horizontal",!t)),this},c.ui.MessageDialog.prototype.getActionProcess=function(t){return t?new c.ui.Process(function(){this.close({action:t})},this):c.ui.MessageDialog.parent.prototype.getActionProcess.call(this,t)},c.ui.MessageDialog.prototype.getSetupProcess=function(t){return t=t||{},c.ui.MessageDialog.parent.prototype.getSetupProcess.call(this,t).next(function(){this.title.setLabel(void 0!==t.title?t.title:this.constructor.static.title),this.message.setLabel(void 0!==t.message?t.message:this.constructor.static.message),this.size=void 0!==t.size?t.size:this.constructor.static.size},this)},c.ui.MessageDialog.prototype.getReadyProcess=function(t){return t=t||{},c.ui.MessageDialog.parent.prototype.getReadyProcess.call(this,t).next(function(){var t=this.actions.get();0<(t=t.filter(function(t){return-1<t.getFlags().indexOf("primary")})).length&&t[0].focus()},this)},c.ui.MessageDialog.prototype.getBodyHeight=function(){var t,e,i=this.container.$element;return e=i[0].style.overflow,i[0].style.overflow="hidden",c.ui.Element.static.reconsiderScrollbars(i[0]),t=this.text.$element.outerHeight(!0),i[0].style.overflow=e,t},c.ui.MessageDialog.prototype.setDimensions=function(t){var e=this,i=this.container.$element;return c.ui.MessageDialog.parent.prototype.setDimensions.call(this,t),setTimeout(function(){var t=i[0].style.overflow,e=document.activeElement;i[0].style.overflow="hidden",c.ui.Element.static.reconsiderScrollbars(i[0]),e&&e!==document.activeElement&&e.focus&&e.focus(),i[0].style.overflow=t},300),e.fitActions(),setTimeout(function(){e.fitActions()},300),this},c.ui.MessageDialog.prototype.initialize=function(){c.ui.MessageDialog.parent.prototype.initialize.call(this),this.$actions=$("<div>"),this.container=new c.ui.PanelLayout({scrollable:!0,classes:["oo-ui-messageDialog-container"]}),this.text=new c.ui.PanelLayout({padded:!0,expanded:!1,classes:["oo-ui-messageDialog-text"]}),this.message=new c.ui.LabelWidget({classes:["oo-ui-messageDialog-message"]}),this.title.$element.addClass("oo-ui-messageDialog-title"),this.$content.addClass("oo-ui-messageDialog-content"),this.container.$element.append(this.text.$element),this.text.$element.append(this.title.$element,this.message.$element),this.$body.append(this.container.$element),this.$actions.addClass("oo-ui-messageDialog-actions"),this.$foot.append(this.$actions)},c.ui.MessageDialog.prototype.getActionWidgetConfig=function(t){return $.extend({},t,{framed:!1})},c.ui.MessageDialog.prototype.attachActions=function(){var t,e,i,o;for(c.ui.MessageDialog.parent.prototype.attachActions.call(this),i=this.actions.getSpecial(),o=this.actions.getOthers(),i.safe&&(this.$actions.append(i.safe.$element),i.safe.toggleFramed(!0)),t=0,e=o.length;t<e;t++)this.$actions.append(o[t].$element),o[t].toggleFramed(!0);i.primary&&(this.$actions.append(i.primary.$element),i.primary.toggleFramed(!0))},c.ui.MessageDialog.prototype.fitActions=function(){var t,e,i,o=this.verticalActionLayout,n=this.actions.get();for(this.toggleVerticalActionLayout(!1),t=0,e=n.length;t<e;t++)if((i=n[t]).$element[0].scrollWidth>i.$element[0].clientWidth){this.toggleVerticalActionLayout(!0);break}this.$body.css("bottom",this.$foot.outerHeight(!0)),this.verticalActionLayout!==o&&this.updateSize()},c.ui.ProcessDialog=function(t){c.ui.ProcessDialog.parent.call(this,t),this.fitOnOpen=!1,this.$element.addClass("oo-ui-processDialog"),c.ui.isMobile()&&this.$element.addClass("oo-ui-isMobile")},c.inheritClass(c.ui.ProcessDialog,c.ui.Dialog),c.ui.ProcessDialog.prototype.onDismissErrorButtonClick=function(){this.hideErrors()},c.ui.ProcessDialog.prototype.onRetryButtonClick=function(){this.hideErrors(),this.executeAction(this.currentAction)},c.ui.ProcessDialog.prototype.initialize=function(){c.ui.ProcessDialog.parent.prototype.initialize.call(this),this.$navigation=$("<div>"),this.$location=$("<div>"),this.$safeActions=$("<div>"),this.$primaryActions=$("<div>"),this.$otherActions=$("<div>"),this.dismissButton=new c.ui.ButtonWidget({label:c.ui.msg("ooui-dialog-process-dismiss")}),this.retryButton=new c.ui.ButtonWidget,this.$errors=$("<div>"),this.$errorsTitle=$("<div>"),this.dismissButton.connect(this,{click:"onDismissErrorButtonClick"}),this.retryButton.connect(this,{click:"onRetryButtonClick"}),this.title.connect(this,{labelChange:"fitLabel"}),this.title.$element.addClass("oo-ui-processDialog-title"),this.$location.append(this.title.$element).addClass("oo-ui-processDialog-location"),this.$safeActions.addClass("oo-ui-processDialog-actions-safe"),this.$primaryActions.addClass("oo-ui-processDialog-actions-primary"),this.$otherActions.addClass("oo-ui-processDialog-actions-other"),this.$errorsTitle.addClass("oo-ui-processDialog-errors-title").text(c.ui.msg("ooui-dialog-process-error")),this.$errors.addClass("oo-ui-processDialog-errors oo-ui-element-hidden").append(this.$errorsTitle,$("<div>").addClass("oo-ui-processDialog-errors-actions").append(this.dismissButton.$element,this.retryButton.$element)),this.$content.addClass("oo-ui-processDialog-content").append(this.$errors),this.$navigation.addClass("oo-ui-processDialog-navigation").append(this.$primaryActions,this.$location,this.$safeActions),this.$head.append(this.$navigation),this.$foot.append(this.$otherActions)},c.ui.ProcessDialog.prototype.getActionWidgetConfig=function(e){function t(t){return e.flags===t||Array.isArray(e.flags)&&-1!==e.flags.indexOf(t)}return e=$.extend({framed:!0},e),t("close")?$.extend(e,{icon:"close",invisibleLabel:!0}):t("back")&&$.extend(e,{icon:"previous",invisibleLabel:!0}),e},c.ui.ProcessDialog.prototype.attachActions=function(){var t,e,i,o,n;for(c.ui.ProcessDialog.parent.prototype.attachActions.call(this),o=this.actions.getSpecial(),n=this.actions.getOthers(),o.primary&&this.$primaryActions.append(o.primary.$element),t=0,e=n.length;t<e;t++)i=n[t],this.$otherActions.append(i.$element);o.safe&&this.$safeActions.append(o.safe.$element)},c.ui.ProcessDialog.prototype.executeAction=function(t){var e=this;return c.ui.ProcessDialog.parent.prototype.executeAction.call(this,t).fail(function(t){e.showErrors(t||[])})},c.ui.ProcessDialog.prototype.setDimensions=function(){var t=this;c.ui.ProcessDialog.parent.prototype.setDimensions.apply(this,arguments),this.fitLabel(),t.$body.css("bottom",t.$foot.outerHeight(!0)),setTimeout(function(){t.$body.css("bottom",t.$foot.outerHeight(!0))},300)},c.ui.ProcessDialog.prototype.fitLabel=function(){var t,e,i,o,n,s,r,a=this.getSizeProperties();if("number"!=typeof a.width){if(!this.isOpened())return this.isOpening()?void(this.fitOnOpen||(this.manager.lifecycle.opened.done(this.fitLabel.bind(this)),this.fitOnOpen=!0)):void 0;n=this.$head.width()-20}else n=a.width-20;return t=this.$safeActions.width(),e=this.$primaryActions.width(),i=Math.max(t,e),o=this.title.$element.width(),!c.ui.isMobile()&&2*i+o<n?s=r=i:r="ltr"===this.getDir()?(s=t,e):(s=e,t),this.$location.css({paddingLeft:s,paddingRight:r}),this},c.ui.ProcessDialog.prototype.showErrors=function(t){var e,i,o,n=[],s={},r=!0,a=!1;for(t instanceof c.ui.Error&&(t=[t]),e=0,i=t.length;e<i;e++)t[e].isRecoverable()||(r=!1),t[e].isWarning()&&(a=!0),n.push(new c.ui.MessageWidget({type:"error",label:t[e].getMessage()}).$element[0]);this.$errorItems=$(n),r?(s[this.currentAction]=!0,(o=this.actions.get({actions:this.currentAction})).length&&this.retryButton.clearFlags().setFlags(o[0].getFlags())):(s[this.currentAction]=!1,this.actions.setAbilities(s)),a?this.retryButton.setLabel(c.ui.msg("ooui-dialog-process-continue")):this.retryButton.setLabel(c.ui.msg("ooui-dialog-process-retry")),this.retryButton.toggle(r),this.$errorsTitle.after(this.$errorItems),this.$errors.removeClass("oo-ui-element-hidden").scrollTop(0)},c.ui.ProcessDialog.prototype.hideErrors=function(){this.$errors.addClass("oo-ui-element-hidden"),this.$errorItems&&(this.$errorItems.remove(),this.$errorItems=null)},c.ui.ProcessDialog.prototype.getTeardownProcess=function(t){return c.ui.ProcessDialog.parent.prototype.getTeardownProcess.call(this,t).first(function(){this.hideErrors(),this.fitOnOpen=!1},this)},c.ui.getWindowManager=function(){return c.ui.windowManager||(c.ui.windowManager=new c.ui.WindowManager,$(document.body).append(c.ui.windowManager.$element),c.ui.windowManager.addWindows([new c.ui.MessageDialog])),c.ui.windowManager},c.ui.alert=function(t,e){return c.ui.getWindowManager().openWindow("message",$.extend({message:t,actions:[c.ui.MessageDialog.static.actions[0]]},e)).closed.then(function(){})},c.ui.confirm=function(t,e){return c.ui.getWindowManager().openWindow("message",$.extend({message:t},e)).closed.then(function(t){return!(!t||"accept"!==t.action)})},c.ui.prompt=function(t,e){var i,o=c.ui.getWindowManager(),n=new c.ui.TextInputWidget(e&&e.textInput||{}),s=new c.ui.FieldLayout(n,{align:"top",label:t});return(i=o.openWindow("message",$.extend({message:s.$element},e))).opened.then(function(){n.on("enter",function(){o.getCurrentWindow().close({action:"accept"})}),n.focus()}),i.closed.then(function(t){return t&&"accept"===t.action?n.getValue():null})}}(OO);
//# sourceMappingURL=oojs-ui-windows.min.js.map