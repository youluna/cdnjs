!function(e,t){"object"===typeof exports&&"undefined"!==typeof module?t(exports,require("inferno"),require("stream")):"function"===typeof define&&define.amd?define(["exports","inferno","stream"],t):t(((e=e||self).Inferno=e.Inferno||{},e.Inferno.Server=e.Inferno.Server||{}),e.Inferno,e.stream)}(this,(function(e,t,r){"use strict";var n="a runtime error occured! Use Inferno in development environment to find the error.";function o(e){return void 0===e||null===e}function u(e){return null===e||!1===e||!0===e||void 0===e}function i(e){return"function"===typeof e}function s(e){return"string"===typeof e}function a(e){return"number"===typeof e}function l(e){return null===e}function c(e){throw e||(e=n),new Error("Inferno Error: "+e)}function d(e,t){var r={};if(e)for(var n in e)r[n]=e[n];if(t)for(var o in t)r[o]=t[o];return r}function f(e){if(s(e))return e;var t,r="";for(var n in e){var o=e[n];("string"===(t=typeof o)||"number"===t)&&(r+=n+":"+o+";")}return r}var h=new RegExp(/["'&<>]/);function p(e){if(!h.test(e))return e;var t,r="",n="",o=0;for(t=0;t<e.length;++t){switch(e.charCodeAt(t)){case 34:n="&quot;";break;case 39:n="&#039;";break;case 38:n="&amp;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}t>o&&(r+=e.slice(o,t)),r+=n,o=t+1}return r+e.slice(o,t)}var v=new RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),m={},y={};function F(e){if(void 0!==y[e])return!0;if(void 0!==m[e])return!1;if(v.test(e))return y[e]=!0,!0;return m[e]=!0,!1}var g=new Set(["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]);function T(e,t,r){if(e.constructor.getDerivedStateFromProps)return d(r,e.constructor.getDerivedStateFromProps(t,r));return r}function S(e){return function e(r,n,h){var v=r.flags,m=r.type,y=r.props||t.EMPTY_OBJ,S=r.children;if(0!==(14&v)){if(4&v){var x,Q=new m(y,h),b=Boolean(m.getDerivedStateFromProps);if(Q.$BS=!1,Q.$SSR=!0,i(Q.getChildContext)&&(x=Q.getChildContext()),x=o(x)?h:d(h,x),Q.props===t.EMPTY_OBJ&&(Q.props=y),Q.context=h,!b&&i(Q.componentWillMount)){Q.$BR=!0,Q.componentWillMount(),Q.$BR=!1;var k=Q.$PS;if(k){var C=Q.state;if(null===C)Q.state=k;else for(var P in k)C[P]=k[P];Q.$PSS=!1,Q.$PS=null}}b&&(Q.state=T(Q,y,Q.state));var _=Q.render(y,Q.state,Q.context);if(u(_))return"\x3c!--!--\x3e";if(s(_))return p(_);if(a(_))return _+"";return e(_,r,x)}var D=m(y,h);if(u(D))return"\x3c!--!--\x3e";if(s(D))return p(D);if(a(D))return D+"";return e(D,r,h)}if(0!==(481&v)){var N,$="<"+m,w=g.has(m),B=r.className;if(s(B)?$+=' class="'+p(B)+'"':a(B)&&($+=' class="'+B+'"'),!l(y)){for(var M in y){var R=y[M];switch(M){case"dangerouslySetInnerHTML":N=R.__html;break;case"style":o(y.style)||($+=' style="'+f(y.style)+'"');break;case"children":case"className":break;case"defaultValue":y.value||($+=' value="'+(s(R)?p(R):R)+'"');break;case"defaultChecked":y.checked||($+=' checked="'+R+'"');break;default:F(M)&&(s(R)?$+=" "+M+'="'+p(R)+'"':a(R)?$+=" "+M+'="'+R+'"':!0===R&&($+=" "+M))}}"option"===m&&"undefined"!==typeof y.value&&y.value===n.props.value&&($+=" selected")}if(w)$+=">";else{$+=">";var E=r.childFlags;if(2===E)$+=e(S,r,h);else if(12&E)for(var I=0,V=S.length;I<V;++I)$+=e(S[I],r,h);else 16===E?$+=""===S?" ":p(S):N&&($+=N);w||($+="</"+m+">")}if(String(m).match(/[\s\n\/='"\0<>]/))throw $;return $}if(0!==(16&v))return""===S?" ":p(S);if(0!==(8192&v)){var A=r.childFlags;if(2===A)return"\x3c!--!--\x3e";if(12&A){for(var O="",j=0,W=S.length;j<W;++j)O+=e(S[j],r,h);return O}}else c();return""}(e,{},{})}var x=function(e){function r(t){e.call(this),this.collector=[1/0],this.promises=[],this.pushQueue=this.pushQueue.bind(this),t&&this.renderVNodeToQueue(t,null,null)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype._read=function(){setTimeout(this.pushQueue,0)},r.prototype.addToQueue=function(e,t){if(o(t))"string"===typeof e&&this.collector.length-1===0?this.push(e):"string"===typeof e&&"string"===typeof this.collector[this.collector.length-2]?this.collector[this.collector.length-2]+=e:this.collector.splice(-1,0,e);else{var r=this.promises[t].length-1;"string"===typeof this.promises[t][r]&&"string"===typeof e?this.promises[t][r]+=e:this.promises[t].push(e)}},r.prototype.pushQueue=function(){var e=this.collector[0];if("string"===typeof e)this.push(e),this.collector.shift();else if(e&&("object"===typeof e||i(e))&&i(e.then)){var t=this;e.then((function(e){var r;(r=t.collector).splice.apply(r,[0,1].concat(t.promises[e])),t.promises[e]=null,setTimeout(t.pushQueue,0)})),this.collector[0]=null}else e===1/0&&this.emit("end")},r.prototype.renderVNodeToQueue=function(e,r,n){var h=this,v=e.flags,m=e.type,y=e.props||t.EMPTY_OBJ,S=e.children;if((14&v)>0)if(4&v){var x,Q=new m(y,r),b=Boolean(m.getDerivedStateFromProps);if(Q.$BS=!1,Q.$SSR=!0,void 0!==Q.getChildContext&&(x=Q.getChildContext()),o(x)||(r=d(r,x)),Q.props===t.EMPTY_OBJ&&(Q.props=y),Q.context=r,!b&&i(Q.componentWillMount)){Q.$BR=!0,Q.componentWillMount();var k=Q.$PS;if(k){var C=Q.state;if(null===C)Q.state=k;else for(var P in k)C[P]=k[P];Q.$PS=null}Q.$BR=!1}if(i(Q.getInitialProps)){var _=Q.getInitialProps(Q.props,Q.context);if(_){if(Promise.resolve(_)===_){var D=this.promises.push([])-1;return void this.addToQueue(_.then((function(e){"object"===typeof e&&(Q.props=d(Q.props,e));var t=Q.render(Q.props,Q.state,Q.context);return u(t)?h.addToQueue("\x3c!--!--\x3e",D):s(t)?h.addToQueue(p(t),D):a(t)?h.addToQueue(t+"",D):h.renderVNodeToQueue(t,Q.context,D),setTimeout(h.pushQueue,0),D})),n)}Q.props=d(Q.props,_)}}b&&(Q.state=T(Q,y,Q.state));var N=Q.render(Q.props,Q.state,Q.context);u(N)?this.addToQueue("\x3c!--!--\x3e",n):s(N)?this.addToQueue(p(N),n):a(N)?this.addToQueue(N+"",n):this.renderVNodeToQueue(N,r,n)}else{var $=m(y,r);u($)?this.addToQueue("\x3c!--!--\x3e",n):s($)?this.addToQueue(p($),n):a($)?this.addToQueue($+"",n):this.renderVNodeToQueue($,r,n)}else if((481&v)>0){var w,B="<"+m,M=g.has(m),R=e.className;if(s(R)?B+=' class="'+p(R)+'"':a(R)&&(B+=' class="'+R+'"'),!l(y))for(var E in y){var I=y[E];switch(E){case"dangerouslySetInnerHTML":w=I.__html;break;case"style":o(y.style)||(B+=' style="'+f(y.style)+'"');break;case"children":case"className":break;case"defaultValue":y.value||(B+=' value="'+(s(I)?p(I):I)+'"');break;case"defaultChecked":y.checked||(B+=' checked="'+I+'"');break;default:F(E)&&(s(I)?B+=" "+E+'="'+p(I)+'"':a(I)?B+=" "+E+'="'+I+'"':!0===I&&(B+=" "+E))}}if(B+=">",String(m).match(/[\s\n\/='"\0<>]/))throw B;if(M)this.addToQueue(B,n);else{var V=e.childFlags;if(2===V)return this.addToQueue(B,n),this.renderVNodeToQueue(S,r,n),void this.addToQueue("</"+m+">",n);if(16===V)return this.addToQueue(B,n),this.addToQueue(""===S?" ":p(S+""),n),void this.addToQueue("</"+m+">",n);if(12&V){this.addToQueue(B,n);for(var A=0,O=S.length;A<O;++A)this.renderVNodeToQueue(S[A],r,n);return void this.addToQueue("</"+m+">",n)}if(w)return void this.addToQueue(B+w+"</"+m+">",n);M||this.addToQueue(B+"</"+m+">",n)}}else(16&v)>0?this.addToQueue(""===S?" ":p(S),n):c()},r}(r.Readable);function Q(e){return new x(e)}var b=Promise.resolve(),k=function(e){function t(t){e.call(this),this.started=!1,this.initNode=t}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._read=function(){var e=this;if(this.started)return;this.started=!0,b.then((function(){return e.renderNode(e.initNode,null)})).then((function(){e.push(null)})).catch((function(t){e.emit("error",t)}))},t.prototype.renderNode=function(e,t){var r=e.flags;if((14&r)>0)return this.renderComponent(e,t,4&r);if((481&r)>0)return this.renderElement(e,t);return this.renderText(e)},t.prototype.renderComponent=function(e,t,r){var n=this,l=e.type,c=e.props;if(!r){var f=l(c,t);if(u(f))return this.push("\x3c!--!--\x3e");if(s(f))return this.push(p(f));if(a(f))return this.push(f+"");return this.renderNode(f,t)}var h,v=new l(c,t),m=Boolean(l.getDerivedStateFromProps);return v.$BS=!1,v.$SSR=!0,i(v.getChildContext)&&(h=v.getChildContext()),o(h)||(t=d(t,h)),v.context=t,v.$BR=!0,Promise.resolve(!m&&v.componentWillMount&&v.componentWillMount()).then((function(){var e=v.$PS;if(e){var r=v.state;if(null===r)v.state=e;else for(var o in e)r[o]=e[o];v.$PS=null}v.$BR=!1,m&&(v.state=T(v,c,v.state));var i=v.render(v.props,v.state,v.context);if(u(i))return n.push("\x3c!--!--\x3e");if(s(i))return n.push(p(i));if(a(i))return n.push(i+"");return n.renderNode(i,t)}))},t.prototype.renderChildren=function(e,t,r){var n=this;if(2===r)return this.renderNode(e,t);if(16===r)return this.push(""===e?" ":p(e+""));if(12&r)return e.reduce((function(e,r){return e.then((function(){return Promise.resolve(n.renderNode(r,t)).then((function(){return!!(16&r.flags)}))}))}),Promise.resolve(!1))},t.prototype.renderText=function(e){this.push(""===e.children?" ":p(e.children))},t.prototype.renderElement=function(e,t){var r,n=this,u=e.type,i=e.props,c="<"+u,d=g.has(u),h=e.className;if(s(h)?c+=' class="'+p(h)+'"':a(h)&&(c+=' class="'+h+'"'),!l(i))for(var v in i){var m=i[v];switch(v){case"dangerouslySetInnerHTML":r=m.__html;break;case"style":o(i.style)||(c+=' style="'+f(i.style)+'"');break;case"children":case"className":break;case"defaultValue":i.value||(c+=' value="'+(s(m)?p(m):m)+'"');break;case"defaultChecked":i.checked||(c+=' checked="'+m+'"');break;default:if(F(v)){s(m)?c+=" "+v+'="'+p(m)+'"':a(m)?c+=" "+v+'="'+m+'"':!0===m&&(c+=" "+v);break}}}if(c+=">",this.push(c),String(u).match(/[\s\n\/='"\0<>]/))throw c;if(d)return;if(r)return this.push(r),void this.push("</"+u+">");var y=e.childFlags;if(1===y)return void this.push("</"+u+">");return Promise.resolve(this.renderChildren(e.children,t,y)).then((function(){n.push("</"+u+">")}))},t}(r.Readable);function C(e){return new k(e)}e.RenderQueueStream=x,e.RenderStream=k,e.renderToStaticMarkup=S,e.renderToString=S,e.streamAsStaticMarkup=C,e.streamAsString=C,e.streamQueueAsStaticMarkup=Q,e.streamQueueAsString=Q,Object.defineProperty(e,"__esModule",{value:!0})}));
